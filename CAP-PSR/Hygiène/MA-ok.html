<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Marche en Avant - Formation Hygiène Cuisine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ... Styles CSS existants (inchangés, sauf si ajustements mineurs nécessaires) ... */
        .learning-section { display: block; }
        .arrow { stroke-width: 2.5; marker-end: url(#arrowhead); opacity: 0; transition: opacity 0.3s ease-in-out; fill: none; }
        .arrow.visible { opacity: 1; }
        .personnel-arrow { stroke: #3b82f6; } .personnel-arrow-souille { stroke: #3b82f6; stroke-dasharray: 4,4; }
        .denrees-arrow { stroke: #22c55e; } .denrees-arrow-souille { stroke: #22c55e; stroke-dasharray: 4,4; }
        .vaisselle-arrow { stroke: #f97316; } .vaisselle-arrow-souille { stroke: #f97316; stroke-dasharray: 4,4; }
        .dechets-arrow { stroke: #8b5cf6; } .dechets-arrow-souille { stroke: #8b5cf6; stroke-dasharray: 4,4; }
        #kitchenPlan text { font-family: sans-serif; pointer-events: none; }
        #kitchenPlan rect[data-zone-type]:hover { stroke: #f59e0b; stroke-width: 1.5px; cursor: default; }

        .svg-legend { margin-top: 10px; font-size: 0.8rem; display: flex; flex-wrap: wrap; gap: 10px; gap-y-2; justify-content: center; }
        .legend-item { display: flex; align-items: center; }
        .legend-line { height: 2px; width: 25px; margin-right: 5px; }
        .legend-line-dashed { border-top-style: dashed; }

        .game-scenario-container { background: #f0f4f8; border-radius: 15px; padding: 20px; margin-top: 20px; border: 1px solid #d1d9e6; }
        .steps-pool-game { background: #e0e6ed; border-radius: 10px; padding: 15px; margin-bottom: 20px; min-height: 80px; border: 2px dashed #b0b9c6; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: center; }
        .step-item-game { background: linear-gradient(135deg, #42a5f5, #1e88e5); color: white; padding: 8px 12px; border-radius: 8px; cursor: grab; display: inline-block; transition: all 0.3s ease; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;}
        .step-item-game:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .step-item-game.dragging { opacity: 0.7; transform: rotate(3deg); }
        .timeline-game { background: #e8f5e8; border-radius: 10px; padding: 15px; border: 2px solid #4caf50; }
        .timeline-game h4 { color: #2e7d32; margin-bottom: 15px; }
        .timeline-slots-game { display: flex; flex-direction: column; gap: 8px; }
        .timeline-slot-game { background: white; border: 2px dashed #4caf50; border-radius: 8px; padding: 10px; min-height: 45px; display: flex; align-items: center; transition: all 0.3s ease; position: relative; }
        .timeline-slot-game::before { content: attr(data-step); position: absolute; left: -30px; top: 50%; transform: translateY(-50%); background: #4caf50; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; }
        .timeline-slot-game.drag-over { background: #c8e6c9; border-color: #2e7d32; }
        .timeline-slot-game .step-item-game { margin: 0; width: 100%; }
        .game-controls button { margin-right: 8px; margin-top:8px; padding: 8px 12px; font-size: 0.9rem; }
        .feedback-game-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .feedback-game-content { background: white; border-radius: 15px; padding: 25px; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .feedback-game-icon { font-size: 2.5rem; margin-bottom: 10px; }
        .feedback-game-text { font-size: 1.2rem; font-weight: bold; margin-bottom: 8px; }
        .feedback-game-explanation { font-size: 0.9rem; color: #555; line-height: 1.4; }
        .scenario-progress-bar-container { width: 100%; background-color: #e0e0e0; border-radius: 0.25rem; margin-bottom: 1rem; height: 12px; overflow: hidden; }
        .scenario-progress-bar { height: 100%; width: 0%; background-color: #4caf50; border-radius: 0.25rem 0 0 0.25rem; transition: width 0.5s ease-in-out; text-align: center; color: white; font-size: 0.7rem; line-height:12px; }

        .progress-bar { transition: width 0.5s ease; }
        .flip-card { perspective: 1000px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; top: 0; left: 0; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 0.75rem; }
        .flip-card-back { transform: rotateY(180deg); }
        .flip-card-back > h3 { margin-bottom: 0.75rem; }
        .flip-card-back > ul { text-align: left; width: 90%; margin-left: auto; margin-right: auto; padding-left: 1rem; }
        .flip-card-back > ul > li { font-size: 0.875rem; }

        .section-title { font-size: 2rem; font-weight: 700; color: #1e293b; margin-bottom: 1.5rem; text-align: center; padding-top: 2rem; border-top: 1px solid #e2e8f0; margin-top: 2.5rem; }
        .section-title:first-of-type { border-top: none; margin-top: 0; }
        .content-box { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); padding: 1.5rem; margin-bottom: 3rem; }
        details summary { cursor: pointer; font-weight: 600; padding: 0.75rem; background-color: #f1f5f9; border-radius: 0.375rem; margin-bottom: 0.5rem; }
        details summary:hover { background-color: #e2e8f0; }
        details[open] summary { background-color: #cbd5e1; }
        details p, details ul { padding: 0.75rem; border: 1px solid #e2e8f0; border-top: none; border-radius: 0 0 0.375rem 0.375rem; }
    
        .video-container { position: relative; padding-bottom: 56.25%; /* 16:9 aspect ratio */ height: 0; overflow: hidden; max-width: 100%; background: #000; border-radius: 0.5rem; /* rounded-lg */ }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .audio-player-container audio { width: 100%; margin-top: 0.5rem; /* mt-2 */ }

    </style>
</head>
<body class="bg-slate-100 font-sans">
    <header class="bg-red-600 text-white shadow-lg">
        <!-- ... Header HTML ... -->
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <div class="text-center sm:text-left mb-4 sm:mb-0">
                    <h1 class="text-3xl font-bold">La Marche en Avant <i class="fas fa-shoe-prints ml-2"></i></h1>
                    <p class="text-red-100">Principe d'hygiène essentiel en cuisine professionnelle</p>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="bg-white text-red-600 px-3 py-1 rounded-full font-bold text-sm">HACCP</div>
                    <div class="bg-white text-red-600 px-3 py-1 rounded-full font-bold text-sm">Formation Cuisine</div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">

        <!-- Section 0.1: Objectifs Pédagogiques -->
        <section id="learning-objectives" class="learning-section content-box">
            <h2 class="text-2xl font-bold text-slate-800 mb-4"><i class="fas fa-bullseye mr-2 text-red-500"></i>Objectifs Pédagogiques de cette Formation</h2>
            <p class="text-slate-600 mb-4">À la fin de cette formation sur la Marche en Avant, vous serez en mesure de :</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm">
                <div class="bg-sky-50 p-4 rounded-lg border border-sky-200">
                    <h3 class="font-semibold text-sky-700 mb-2"><i class="fas fa-brain mr-1"></i>Savoirs (Cognitifs)</h3>
                    <ul class="list-disc list-inside space-y-1 text-slate-600">
                        <li>Définir le principe de la marche en avant et son importance.</li>
                        <li>Identifier les circuits "propres" et "souillés".</li>
                        <li>Expliquer son application aux flux (personnel, denrées, etc.).</li>
                        <li>Reconnaître les différentes zones et leur rôle.</li>
                        <li>Comprendre les risques de contamination et leur prévention.</li>
                        <li>Citer les solutions en l'absence de sectorisation physique.</li>
                    </ul>
                </div>
                <div class="bg-lime-50 p-4 rounded-lg border border-lime-200">
                    <h3 class="font-semibold text-lime-700 mb-2"><i class="fas fa-tools mr-1"></i>Savoir-faire (Opérationnels)</h3>
                    <ul class="list-disc list-inside space-y-1 text-slate-600">
                        <li>Analyser un plan de cuisine pour les flux.</li>
                        <li>Appliquer la marche en avant dans des scénarios pratiques.</li>
                        <li>Organiser un poste de travail de manière hygiénique.</li>
                        <li>Prendre des décisions pour éviter les contaminations.</li>
                    </ul>
                </div>
                <div class="bg-fuchsia-50 p-4 rounded-lg border border-fuchsia-200">
                    <h3 class="font-semibold text-fuchsia-700 mb-2"><i class="fas fa-users mr-1"></i>Savoir-être (Comportementaux)</h3>
                    <ul class="list-disc list-inside space-y-1 text-slate-600">
                        <li>Adopter une vigilance constante face aux risques.</li>
                        <li>Développer une rigueur professionnelle en hygiène.</li>
                        <li>Comprendre sa responsabilité dans la sécurité alimentaire.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 0.2: Vidéo Explicative -->
        <section id="video-section" class="learning-section content-box">
            <h2 class="text-2xl font-bold text-slate-800 mb-4"><i class="fas fa-video mr-2 text-red-500"></i>Vidéo : La Marche en Avant en Action</h2>
            <p class="text-slate-600 mb-4">Visualisez le concept en pratique.</p>
            <div class="video-container bg-slate-300 flex items-center justify-center">
                <!-- Exemple de placeholder pour iframe YouTube -->
                <!-- <iframe width="560" height="315" src="https://youtu.be/c1HgwAi6vWc" title="LES CIRCUITS DE LA MARCHE-EN-AVANT EN RESTAURATION" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe> -->
                <div class="text-center text-slate-500">
                    <i class="fas fa-play-circle text-6xl mb-2"></i>
                    <p>Votre vidéo explicative ici.</p>
                    <p class="text-xs">(Ex: Intégrer une iframe YouTube)</p>
                </div>
            </div>
        </section>

        <!-- Section 0.3: Podcast -->
        <section id="podcast-section" class="learning-section content-box">
            <h2 class="text-2xl font-bold text-slate-800 mb-4"><i class="fas fa-podcast mr-2 text-red-500"></i>Podcast : Approfondir la Marche en Avant</h2>
            <p class="text-slate-600 mb-4">Écoutez pour renforcer votre compréhension.</p>
            <div class="audio-player-container bg-slate-100 p-4 rounded-lg">
                <audio controls src="VOTRE_LIEN_AUDIO.mp3" class="w-full">
                    Votre navigateur ne supporte pas l'élément audio.
                </audio>
                 <p class="text-xs text-slate-500 mt-2 text-center">(Assurez-vous que le fichier audio est accessible ou utilisez un service d'hébergement de podcast)</p>
            </div>
        </section>
         <main class="container mx-auto px-4 py-8">

        <!-- Section 1: Introduction (Contenu HTML identique) -->
        <section id="introduction" class="learning-section content-box">
            <h2 class="text-2xl font-bold text-slate-800 mb-4"><i class="fas fa-info-circle mr-2 text-red-500"></i>Qu'est-ce que la Marche en Avant ?</h2>
            <p class="text-slate-600 mb-4">La "marche en avant" est un principe fondamental d'organisation dans les cuisines professionnelles. Son objectif principal est de <strong class="text-red-600">limiter le risque de contamination</strong> des aliments. Ces contaminations peuvent être de nature physique (ex: un bout de plastique), chimique (ex: résidu de détergent) ou biologique (ex: bactéries, virus).</p>
            <p class="text-slate-600 mb-6">Ce principe s'inscrit dans le cadre du système HACCP (Hazard Analysis Critical Control Point) et est essentiel pour garantir la sécurité alimentaire. Il concerne non seulement les aliments, mais aussi <strong class="text-slate-700">la vaisselle, les déchets et le personnel</strong>.</p>
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-md">
                <p class="text-yellow-700 font-medium"><i class="fas fa-exclamation-triangle mr-2"></i>Le principe clé : progresser toujours du "sale" vers le "propre", sans jamais revenir en arrière ni croiser les flux pour éviter les contaminations croisées.</p>
            </div>
        </section>

        <!-- Section 2: Terminologie (Contenu HTML identique) -->
        <section id="terminology" class="learning-section content-box">
            <h2 class="text-2xl font-bold text-slate-800 mb-6"><i class="fas fa-tags mr-2 text-red-500"></i>Terminologie Essentielle</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                    <h3 class="text-xl font-medium mb-2 text-green-700"><i class="fas fa-soap mr-2"></i>Circuits « Propres »</h3>
                    <p class="text-slate-600">Désigne tout ce qui a été nettoyé, décontaminé, ou qui est sensible à la contamination et ne doit pas être recontaminé. Exemples : aliments prêts à cuire/servir, vaisselle propre, personnel en tenue de travail propre.</p>
                </div>
                <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                    <h3 class="text-xl font-medium mb-2 text-red-700"><i class="fas fa-biohazard mr-2"></i>Circuits « Souillés »</h3>
                    <p class="text-slate-600">Désigne tout ce qui est potentiellement contaminant. Exemples : aliments bruts terreux, emballages, vaisselle sale, déchets, personnel en tenue de ville.</p>
                </div>
            </div>
        </section>

        <!-- Section 3: Plan de Cuisine Interactif (Contenu HTML identique) -->
         <section id="interactive-plan" class="learning-section content-box">
            <h2 class="text-2xl font-bold text-slate-800 mb-4 text-center"><i class="fas fa-map-marked-alt mr-2 text-red-500"></i>Visualisation des Flux : Plan d'une Cuisine</h2>
            <p class="text-slate-600 mb-6 text-center">Cliquez sur les boutons pour visualiser les circuits. Survolez les zones pour plus d'informations. Les flèches sont stylisées pour refléter les flux (voir légende).</p>
             <div class="flex flex-wrap justify-center gap-2 mb-4">
                <button class="diagram-btn bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded text-white text-sm" data-circuit="personnel">Personnel</button>
                <button class="diagram-btn bg-green-500 hover:bg-green-600 px-3 py-1 rounded text-white text-sm" data-circuit="denrees">Denrées</button>
                <button class="diagram-btn bg-orange-500 hover:bg-orange-600 px-3 py-1 rounded text-white text-sm" data-circuit="vaisselle">Vaisselle</button>
                <button class="diagram-btn bg-purple-500 hover:bg-purple-600 px-3 py-1 rounded text-white text-sm" data-circuit="dechets">Déchets</button>
                <button class="diagram-btn bg-gray-500 hover:bg-gray-600 px-3 py-1 rounded text-white text-sm" data-circuit="all">Tout Afficher</button>
                <button id="resetDiagram" class="bg-red-700 hover:bg-red-800 px-3 py-1 rounded text-white text-sm">Réinitialiser</button>
            </div>
            <div id="kitchenDiagramContainer" class="w-full h-auto flex-grow flex flex-col justify-center items-center bg-slate-200 p-2 rounded-lg shadow-inner">
                <svg id="kitchenPlan" viewBox="0 0 800 600" class="max-w-full max-h-[75vh] rounded-md">
                    <defs>
                        <marker id="arrowhead" markerWidth="8" markerHeight="6" 
                                refX="7.5" refY="3" orient="auto" fill="currentColor"> 
                            <polygon points="0 0, 8 3, 0 6" />
                        </marker>
                    </defs>
                    <rect width="100%" height="100%" fill="#f8fafc"/>
                    <g id="zones">
                        <rect x="20" y="20" width="150" height="100" fill="#718096" stroke="#CBD5E0" data-zone-name="Déchets (Ext.)" data-zone-type="souille"/> 
                        <text x="95" y="70" text-anchor="middle" fill="white" font-size="12">Déchets (Ext.)</text>
                        <rect x="20" y="130" width="150" height="80" fill="#718096" stroke="#CBD5E0" data-zone-name="Quai de réception" data-zone-type="souille"/>
                        <text x="95" y="170" text-anchor="middle" fill="white" font-size="12">Quai de réception</text>
                        <rect x="180" y="20" width="100" height="70" fill="#718096" stroke="#CBD5E0" data-zone-name="Vestiaires Hommes" data-zone-type="transition"/><text x="230" y="55" text-anchor="middle" fill="white" font-size="12">Vestiaires H.</text>
                        <rect x="180" y="100" width="100" height="70" fill="#718096" stroke="#CBD5E0" data-zone-name="Vestiaires Femmes" data-zone-type="transition"/><text x="230" y="135" text-anchor="middle" fill="white" font-size="12">Vestiaires F.</text>
                        <rect x="180" y="180" width="100" height="50" fill="#718096" stroke="#CBD5E0" data-zone-name="Produits d'entretien" data-zone-type="souille"/><text x="230" y="205" text-anchor="middle" fill="white" font-size="10">Produits entretien</text>
                        <rect x="180" y="240" width="100" height="50" fill="#a0aec0" stroke="#CBD5E0" data-zone-name="Entrée Cuisine" data-zone-type="transition"/><text x="230" y="265" text-anchor="middle" fill="black" font-size="11" style="font-weight:bold;">Entrée Cuisine</text>
                        <rect x="290" y="100" width="100" height="70" fill="#718096" stroke="#CBD5E0" data-zone-name="Réserve Sèche" data-zone-type="souille"/><text x="340" y="135" text-anchor="middle" fill="white" font-size="12">Réserve Sèche</text>
                        <rect x="290" y="240" width="100" height="50" fill="#a0aec0" stroke="#CBD5E0" data-zone-name="Couloir" data-zone-type="transition"/><text x="340" y="265" text-anchor="middle" fill="black" font-size="12">Couloir</text>
                        <rect x="20" y="300" width="150" height="80" fill="#718096" stroke="#CBD5E0" data-zone-name="Bureau" data-zone-type="propre"/><text x="95" y="340" text-anchor="middle" fill="white" font-size="12">Bureau</text>
                        <rect x="180" y="300" width="210" height="80" fill="#718096" stroke="#CBD5E0" data-zone-name="Chambres Froides" data-zone-type="souille"/><text x="285" y="340" text-anchor="middle" fill="white" font-size="12">Chambres Froides</text>
                        <rect x="180" y="390" width="210" height="80" fill="#d1fae5" stroke="#6ee7b7" data-zone-name="Déconditionnement/Légumerie" data-zone-type="transition"/><text x="285" y="420" text-anchor="middle" fill="black" font-size="12">Déconditionnement/</text><text x="285" y="440" text-anchor="middle" fill="black" font-size="12">Légumerie</text>
                        <rect x="400" y="100" width="200" height="150" fill="#fed7aa" stroke="#fb923c" data-zone-name="Préparations Chaudes" data-zone-type="propre"/><text x="500" y="175" text-anchor="middle" fill="black" font-size="12">Préparations Chaudes</text>
                        <rect x="400" y="320" width="200" height="150" fill="#bfdbfe" stroke="#60a5fa" data-zone-name="Préparations Froides" data-zone-type="propre"/><text x="500" y="395" text-anchor="middle" fill="black" font-size="12">Préparations Froides</text>
                        <rect x="610" y="20" width="100" height="150" fill="#fed7aa" stroke="#fb923c" data-zone-name="Plonge Batterie" data-zone-type="propre"/><text x="660" y="95" text-anchor="middle" fill="black" font-size="12">Plonge Batterie</text>
                        <rect x="610" y="180" width="100" height="100" fill="#a5f3fc" stroke="#22d3ee" data-zone-name="Distribution" data-zone-type="transition"/><text x="660" y="230" text-anchor="middle" fill="black" font-size="12">Distribution</text>
                        <rect x="610" y="290" width="100" height="150" fill="#fecaca" stroke="#f87171" data-zone-name="Plonge Laverie" data-zone-type="souille"/><text x="660" y="365" text-anchor="middle" fill="black" font-size="12">Plonge Laverie</text>
                        <rect x="720" y="80" width="60" height="360" fill="#718096" stroke="#CBD5E0" data-zone-name="Salle Restaurant" data-zone-type="souille"/><text x="750" y="260" text-anchor="middle" fill="white" font-size="12" transform="rotate(-90 750 260)">Salle Restaurant</text>
                        <rect x="610" y="450" width="170" height="100" fill="#718096" stroke="#CBD5E0" data-zone-name="Déchets (Salle)" data-zone-type="souille"/><text x="695" y="500" text-anchor="middle" fill="white" font-size="12">Déchets (Salle)</text>
                    </g>
                    <g id="circuit-personnel"><polyline class="arrow personnel-arrow-souille" points="95,210 95,135 175,135"/><polyline class="arrow personnel-arrow" points="285,135 395,135 395,175"/><path class="arrow personnel-arrow" d="M500,115 A60 60 0 1 1 499.9,115.1 Z" /><line class="arrow personnel-arrow" x1="500" y1="255" x2="500" y2="315"/><path class="arrow personnel-arrow" d="M500,335 A60 60 0 1 1 499.9,335.1 Z" /><polyline class="arrow personnel-arrow" points="395,395 395,430 285,430"/><polyline class="arrow personnel-arrow" points="595,175 605,175 605,230"/></g>
                    <g id="circuit-denrees"><polyline class="arrow denrees-arrow-souille" points="95,210 95,340 175,340"/><polyline class="arrow denrees-arrow-souille" points="95,210 285,210 285,135"/><line class="arrow denrees-arrow-souille" x1="285" y1="380" x2="285" y2="390"/><polyline class="arrow denrees-arrow" points="385,430 395,430 395,175 "/><polyline class="arrow denrees-arrow" points="385,430 395,430 395,395 "/><polyline class="arrow denrees-arrow" points="595,175 605,175 605,220"/><polyline class="arrow denrees-arrow" points="595,395 605,395 605,240"/></g>
                    <g id="circuit-vaisselle"><polyline class="arrow vaisselle-arrow" points="605,95 405,95 405,175"/><polyline class="arrow vaisselle-arrow" points="605,95 405,95 405,395"/><line class="arrow vaisselle-arrow-souille" x1="715" y1="365" x2="695" y2="365"/><polyline class="arrow vaisselle-arrow" points="660,285 660,275 655,275 655,230"/></g>
                    <g id="circuit-dechets"><line class="arrow dechets-arrow-souille" x1="95" y1="125" x2="95" y2="70"/><polyline class="arrow dechets-arrow-souille" points="285,470 285,265 175,265 175,70"/><polyline class="arrow dechets-arrow" points="395,175 395,265"/><polyline class="arrow dechets-arrow" points="395,395 395,265"/><polyline class="arrow dechets-arrow" points="285,265 175,265 175,70"/><line class="arrow dechets-arrow-souille" x1="660" y1="445" x2="660" y2="490"/></g>
                </svg>
                <div class="svg-legend">
                    <div class="legend-item"><div class="legend-line" style="background-color: #3b82f6;"></div>Personnel Propre</div>
                    <div class="legend-item"><div class="legend-line legend-line-dashed" style="border-top-color: #3b82f6; border-top-width:2px;"></div>Personnel Souillé</div>
                    <div class="legend-item"><div class="legend-line" style="background-color: #22c55e;"></div>Denrées Propres</div>
                    <div class="legend-item"><div class="legend-line legend-line-dashed" style="border-top-color: #22c55e; border-top-width:2px;"></div>Denrées Souillées</div>
                    <div class="legend-item"><div class="legend-line" style="background-color: #f97316;"></div>Vaisselle Propre</div>
                    <div class="legend-item"><div class="legend-line legend-line-dashed" style="border-top-color: #f97316; border-top-width:2px;"></div>Vaisselle Souillée</div>
                    <div class="legend-item"><div class="legend-line" style="background-color: #8b5cf6;"></div>Déchets (circuit propre)</div>
                    <div class="legend-item"><div class="legend-line legend-line-dashed" style="border-top-color: #8b5cf6; border-top-width:2px;"></div>Déchets (circuit souillé)</div>
                </div>
            </div>
             <p class="text-xs text-center text-slate-500 w-full mt-2">Ce plan est un exemple simplifié. Les tracés des flèches s'inspirent des flux idéaux.</p>
        </section>

        <!-- Section 4: Application Pratique - Jeu de Scénarios (Contenu HTML identique) -->
        <section id="practical-game" class="learning-section">
             <h2 class="section-title"><i class="fas fa-gamepad mr-2 text-red-500"></i>Mise en Pratique : Scénarios Interactifs</h2>
            <div class="game-scenario-container content-box">
                <div class="scenario-progress-bar-container">
                    <div id="scenario-progress-bar" class="scenario-progress-bar"></div>
                </div>
                <div id="scenario-counter" class="text-sm text-slate-600 mb-3 text-center">Scénario 1 / 12</div>

                <div id="scenario-card-game" class="mb-4 p-4 bg-blue-100 border border-blue-300 rounded-md">
                    <h3 class="text-lg font-semibold text-blue-800">Chargement du scénario...</h3>
                    <p class="text-blue-700 text-sm">Suivez les instructions pour organiser les étapes.</p>
                </div>
                <div class="steps-container-game mb-4">
                    <h4 class="font-semibold text-slate-700 mb-2 text-center">Étapes à placer :</h4>
                    <div class="steps-pool-game" id="steps-pool-game"></div>
                </div>
                <div class="timeline-game">
                    <h4 class="text-center"><i class="fas fa-stream mr-1"></i>Votre Séquence :</h4>
                    <div class="timeline-slots-game" id="timeline-slots-game"></div>
                </div>
                <div class="game-controls mt-6 text-center">
                    <button id="validate-btn-game" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded"><i class="fas fa-check"></i> Valider</button>
                    <button id="reset-btn-game" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded"><i class="fas fa-undo"></i> Recommencer</button>
                    <button id="hint-btn-game" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"><i class="fas fa-lightbulb"></i> Indice</button>
                    <button id="next-scenario-btn-game" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded" style="display: none;">Scénario Suivant <i class="fas fa-arrow-right"></i></button>
                </div>
                 <div class="mt-4 text-sm text-slate-500 text-center">
                    <strong>Score Global:</strong> <span id="score-game">0</span>
                </div>
            </div>
            <div class="feedback-game-container" id="feedback-game-container">
                <div class="feedback-game-content">
                    <div class="feedback-game-icon"></div>
                    <div class="feedback-game-text font-semibold"></div>
                    <div class="feedback-game-explanation mt-2"></div>
                    <button id="close-feedback-game-btn" class="mt-4 bg-slate-500 hover:bg-slate-600 text-white py-2 px-4 rounded">Fermer</button>
                </div>
            </div>
        </section>
        
        <!-- Section 5: Détail des Secteurs (Contenu HTML identique) -->
        <section id="zones-detail" class="learning-section content-box">
            <h2 class="text-2xl font-bold text-slate-800 mb-6"><i class="fas fa-door-open mr-2 text-red-500"></i>Comprendre les Zones et Secteurs</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                 <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                    <h3 class="text-lg font-semibold text-red-700 mb-2"><i class="fas fa-bacteria mr-1"></i>Secteurs Souillés (Zones à Risque)</h3>
                    <ul class="list-disc list-inside text-slate-600 space-y-1 text-sm">
                        <li>Quai de réception</li><li>Zone de déconditionnement / Légumerie (entrée)</li>
                        <li>Zones de stockage initial (Réserve sèche, CF brutes)</li><li>Couloirs de circulation des produits bruts</li>
                        <li>Salle de restaurant</li><li>Plonge vaisselle (laverie)</li><li>Local déchets</li><li>Vestiaires (côté ville)</li>
                    </ul>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <h3 class="text-lg font-semibold text-green-700 mb-2"><i class="fas fa-shield-alt mr-1"></i>Secteurs Propres (Zones Protégées)</h3>
                    <ul class="list-disc list-inside text-slate-600 space-y-1 text-sm">
                        <li>Secteur cuisson</li><li>Secteur préparations froides</li><li>Plonge batterie</li>
                        <li>Secteurs conditionnement (si cuisine centrale)</li><li>Zone de stockage vaisselle propre</li>
                        <li>Vestiaires (côté travail)</li> <li>Zone de distribution (côté cuisine)</li>
                    </ul>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h3 class="text-lg font-semibold text-blue-700 mb-2"><i class="fas fa-exchange-alt mr-1"></i>Zones de Transition Essentielles</h3>
                    <ul class="list-disc list-inside text-slate-600 space-y-1 text-sm">
                        <li><strong>Vestiaires :</strong> Ville (souillé) <i class="fas fa-arrow-right text-xs"></i> Travail (propre).</li>
                        <li><strong>Légumerie :</strong> Brut (souillé) <i class="fas fa-arrow-right text-xs"></i> Lavé (propre).</li>
                        <li><strong>Distribution :</strong> Fini (propre) <i class="fas fa-arrow-right text-xs"></i> Service (souillé).</li>
                    </ul>
                     <p class="mt-2 text-xs text-slate-500">Organisation rigoureuse nécessaire.</p>
                </div>
            </div>
            <div class="mt-6 bg-amber-50 p-4 rounded-lg border border-amber-300">
                 <h4 class="font-semibold text-amber-700 mb-2"><i class="fas fa-lightbulb mr-1"></i> Point d'Attention : Sectorisation</h4>
                 <p class="text-slate-600 text-sm">Idéalement, cuisine divisée par murs (<strong class="text-slate-700">sectorisation physique</strong>). Si ce n'est pas possible, il faut impérativement <strong class="text-slate-700">séparer les tâches dans l'espace</strong> (ex: plans de travail distincts) <strong class="text-slate-700">et/ou dans le temps</strong> (ex: nettoyer après une tâche souillée avant de commencer une tâche propre).</p>
            </div>
        </section>

        <!-- Section 6: Quiz (Contenu HTML identique) -->
        <section id="quiz-section" class="learning-section">
            <h2 class="section-title"><i class="fas fa-question-circle mr-2 text-red-500"></i>Testez Vos Connaissances</h2>
            <div class="bg-white rounded-xl shadow-md overflow-hidden content-box">
                <div class="bg-gray-200 h-2">
                    <div id="quiz-progress" class="progress-bar bg-blue-600 h-2" style="width: 0%"></div>
                </div>
                <div class="p-6">
                    <div id="quiz-container"></div>
                </div>
            </div>
        </section>

        <!-- Section 7: Cartes Mémos HACCP & Hygiène -->
         <section id="flashcards-section" class="learning-section">
            <h2 class="section-title"><i class="far fa-sticky-note mr-2 text-red-500"></i>Cartes Mémos HACCP & Hygiène</h2>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="flip-card h-64 content-box !p-0 !mb-0"> <!-- Retiré cursor-pointer, JS gère le clic -->
                    <div class="flip-card-inner h-full rounded-xl">
                        <div class="flip-card-front bg-white p-6 rounded-xl"> <!-- Classes de centrage Tailwind via CSS global -->
                            <div class="bg-blue-100 p-4 rounded-full mb-4"><i class="fas fa-users text-blue-500 text-3xl"></i></div>
                            <h3 class="text-xl font-semibold text-slate-700 mb-2">Personnel</h3>
                            <p class="text-slate-500 text-sm">Cliquez pour voir les règles</p>
                        </div>
                        <div class="flip-card-back bg-blue-50 p-6 rounded-xl">
                            <h3 class="text-xl font-semibold text-blue-700">Hygiène du Personnel</h3>
                            <ul class="text-sm text-slate-700 space-y-1">
                                <li><i class="fas fa-check text-blue-500 mr-2"></i>Tenue professionnelle propre et complète</li>
                                <li><i class="fas fa-check text-blue-500 mr-2"></i>Lavage des mains fréquent et correct</li>
                                <li><i class="fas fa-check text-blue-500 mr-2"></i>Pas de bijoux, ongles courts et propres</li>
                                <li><i class="fas fa-check text-blue-500 mr-2"></i>Cheveux attachés, port de coiffe</li>
                                <li><i class="fas fa-check text-blue-500 mr-2"></i>Déclaration de maladie (gastro-entérite, etc.)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                 <div class="flip-card h-64 content-box !p-0 !mb-0">
                    <div class="flip-card-inner h-full rounded-xl">
                        <div class="flip-card-front bg-white p-6 rounded-xl">
                            <div class="bg-green-100 p-4 rounded-full mb-4"><i class="fas fa-tools text-green-500 text-3xl"></i></div>
                            <h3 class="text-xl font-semibold text-slate-700 mb-2">Matériel</h3>
                            <p class="text-slate-500 text-sm">Cliquez pour voir les règles</p>
                        </div>
                        <div class="flip-card-back bg-green-50 p-6 rounded-xl">
                            <h3 class="text-xl font-semibold text-green-700">Hygiène du Matériel</h3>
                            <ul class="text-sm text-slate-700 space-y-1">
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Nettoyage ET désinfection après chaque usage</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Matériel dédié par zone (ex: planches à découper de couleurs)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Plan de nettoyage et désinfection (PND) affiché et suivi</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Contrôle de l'état (pas de fissures, rouille)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Rangement propre et sec</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="flip-card h-64 content-box !p-0 !mb-0">
                    <div class="flip-card-inner h-full rounded-xl">
                        <div class="flip-card-front bg-white p-6 rounded-xl">
                            <div class="bg-red-100 p-4 rounded-full mb-4"><i class="fas fa-carrot text-red-500 text-3xl"></i></div>
                            <h3 class="text-xl font-semibold text-slate-700 mb-2">Denrées</h3>
                            <p class="text-slate-500 text-sm">Cliquez pour voir les règles</p>
                        </div>
                        <div class="flip-card-back bg-red-50 p-6 rounded-xl">
                            <h3 class="text-xl font-semibold text-red-700">Hygiène des Denrées</h3>
                            <ul class="text-sm text-slate-700 space-y-1">
                                <li><i class="fas fa-check text-red-500 mr-2"></i>Contrôle à réception (température, DLC/DDM, aspect)</li>
                                <li><i class="fas fa-check text-red-500 mr-2"></i>Respect de la chaîne du froid/chaud</li>
                                <li><i class="fas fa-check text-red-500 mr-2"></i>Stockage séparé cru/cuit, produits différents</li>
                                <li><i class="fas fa-check text-red-500 mr-2"></i>Étiquetage (date ouverture, DLC secondaire)</li>
                                <li><i class="fas fa-check text-red-500 mr-2"></i>Cuisson suffisante (température à cœur)</li>
                                <li><i class="fas fa-check text-red-500 mr-2"></i>Refroidissement rapide si besoin</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 8: FAQ (Contenu HTML identique) -->
        <section id="faq-section" class="learning-section">
            <h2 class="section-title"><i class="fas fa-question-circle mr-2 text-red-500"></i>Foire Aux Questions (FAQ)</h2>
            <div class="space-y-4 content-box">
                <details><summary>1. Qu'est-ce que la "Marche en Avant" en cuisine ?</summary><p>C'est une méthode d'organisation pour gérer tous les flux (personnel, aliments, vaisselle, déchets) dans une cuisine professionnelle. Son but principal est de limiter les risques de contamination.</p></details>
                <details><summary>2. Pourquoi la "Marche en Avant" est-elle si importante ?</summary><p>Elle permet de prévenir différents types de contamination : physique, chimique et surtout biologique (par des germes). C'est l'un des meilleurs principes pour assurer l'hygiène et la sécurité alimentaire en cuisine.</p></details>
                <details><summary>3. Quel est le principe fondamental de la "Marche en Avant" ?</summary><p>Le principe de base est la séparation stricte entre ce qu'on appelle les "circuits propres" et les "circuits souillés". L'idée est de toujours progresser du "sale" vers le "propre" sans jamais revenir en arrière ni croiser les chemins.</p></details>
                <details><summary>4. Comment définir "Circuit Propre" et "Circuit Souillé" ?</summary><ul class="list-disc pl-5"><li>Un <strong>circuit propre</strong> est une zone ou un parcours qui ne doit absolument pas être contaminé.</li><li>Un <strong>circuit souillé</strong> est une zone ou un parcours qui est contaminé ou qui pourrait l'être.</li></ul></details>
                <details><summary>5. Comment la "Marche en Avant" s'applique-t-elle au personnel ?</summary><p>Quand vous arrivez au travail en tenue de ville, vous êtes considéré comme "souillé". Pour devenir "propre", vous vous changez dans les vestiaires (zone de transition). En tenue de travail, vous êtes "propre" et travaillez dans les secteurs propres. Le personnel de service (serveurs) venant de la salle est "souillé" et ne doit pas entrer dans vos zones de préparation propres.</p></details>
                <details><summary>6. Et pour les aliments (denrées) ?</summary><p>Les aliments arrivent "souillés" (réception, stockage initial). La zone de déconditionnement/légumerie est une transition clé où ils deviennent "propres" (après déballage, lavage, décontamination). Ils circulent ensuite dans les secteurs propres pour la préparation.</p></details>
                <details><summary>7. Qu'en est-il de la vaisselle et de l'équipement ?</summary><ul class="list-disc pl-5"><li><strong>Vaisselle de salle :</strong> Revient "souillée", lavée en plonge laverie (secteur souillé), puis devient "propre".</li><li><strong>Équipement de cuisine ("batterie") :</strong> Utilisé en zone propre, lavé en plonge batterie (secteur propre), reste "propre".</li></ul></details>
                <details><summary>8. Comment gérer les déchets ?</summary><p>Tous les déchets (emballages, restes) sont "souillés" et doivent être évacués loin des zones propres, idéalement via un local déchets dédié. Si un déchet doit traverser une zone propre, cela se fait "dans le temps", c'est-à-dire après la fin de la production et avant le nettoyage complet.</p></details>
                <details><summary>9. Qu'est-ce qu'une "Zone de Transition" ?</summary><p>C'est un secteur qui fait le lien entre un circuit souillé et un circuit propre (ex: vestiaires, légumerie, distribution). L'organisation y est cruciale pour éviter les croisements contaminant.</p></details>
                <details><summary>10. Que faire si la cuisine n'a pas de murs pour séparer les zones ?</summary><p>L'idéal est la sectorisation physique. Sinon, il faut obligatoirement séparer les tâches <strong>dans l'espace</strong> (ex: plans de travail différents pour le cru et le cuit) et/ou <strong>dans le temps</strong> (ex: préparer le cru, nettoyer, puis préparer le cuit sur le même plan).</p></details>
            </div>
        </section>

        <!-- Section 9: Lexique (Contenu HTML identique) -->
        <section id="lexicon-section" class="learning-section">
            <h2 class="section-title"><i class="fas fa-book-open mr-2 text-red-500"></i>Lexique des Termes Clés</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 content-box">
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Circuit Propre :</strong> Zone/flux non contaminé.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Circuit Souillé :</strong> Zone/flux (potentiellement) contaminé.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Déconditionnement/Légumerie :</strong> Zone de transition où les denrées brutes deviennent propres.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Distribution :</strong> Zone de transition entre cuisine (propre) et salle (souillé) pour les plats finis.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Marche en Avant :</strong> Organisation des flux du sale vers le propre.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Personnel Propre :</strong> Employés en tenue de travail dans les zones de préparation.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Personnel Souillé :</strong> Personnel en tenue de ville ou venant de la salle.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Plonge Batterie :</strong> Nettoyage équipement de cuisine (secteur propre).</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Plonge Laverie :</strong> Nettoyage vaisselle de salle (secteur souillé).</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Quai de Réception :</strong> Arrivée des denrées (secteur souillé).</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Réserve/Chambre Froide :</strong> Stockage initial des denrées (souillé).</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Sectorisation :</strong> Division physique de la cuisine en zones.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Séparation Espace/Temps :</strong> Alternative à la sectorisation physique.</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Vestiaires :</strong> Zone de transition pour le personnel (ville -> travail).</div>
                <div class="bg-slate-50 p-3 rounded-md border"><strong>Zone de Transition :</strong> Secteur reliant un circuit souillé à un propre (ex: légumerie).</div>
            </div>
        </section>

    </main>

    <div id="zone-tooltip" class="absolute text-white text-xs p-1.5 rounded-md shadow-lg pointer-events-none hidden z-50 transition-opacity duration-200">
        <strong id="tooltip-zone-name"></strong><br><span id="tooltip-zone-type" class="text-opacity-80"></span>
    </div>

    <footer class="bg-slate-800 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-slate-400">© 2025 Formation Hygiène Cuisine - d.d Amil | IRP.</p>
            <p class="text-slate-500 text-xs mt-1">Cette application est un outil pédagogique et ne remplace pas une formation certifiante complète.</p>
        </div>
    </footer>

    <script>
    // Le script JavaScript complet fourni dans la réponse précédente est ici.
    // Il inclut:
    // - L'interactivité du plan de cuisine SVG
    // - L'info-bulle pour les zones du plan
    // - L'interactivité des cartes mémos
    // - La logique du Quiz
    // - La logique du jeu de Scénarios Interactifs avec 12 scénarios et barre de progression
    document.addEventListener('DOMContentLoaded', () => {
        const diagramButtons = document.querySelectorAll('.diagram-btn');
        const resetDiagramBtn = document.getElementById('resetDiagram');
        const kitchenPlanSVG = document.getElementById('kitchenPlan');
        
        if (kitchenPlanSVG && diagramButtons.length > 0 && resetDiagramBtn) {
            const allArrows = kitchenPlanSVG.querySelectorAll('.arrow');
            function hideAllArrows() { allArrows.forEach(arrow => arrow.classList.remove('visible')); }
            function showCircuitArrows(circuitType) { hideAllArrows(); const circuitArrows = kitchenPlanSVG.querySelectorAll(`.arrow.${circuitType}-arrow, .arrow.${circuitType}-arrow-souille`); let delay = 0; circuitArrows.forEach(arrow => { setTimeout(() => arrow.classList.add('visible'), delay); delay += 50; });}
            function showAllCircuitArrows() { hideAllArrows(); let delay = 0; allArrows.forEach(arrow => { setTimeout(() => arrow.classList.add('visible'), delay); delay += 20; });}
            diagramButtons.forEach(button => { button.addEventListener('click', () => { const circuit = button.dataset.circuit; if (circuit === 'all') showAllCircuitArrows(); else showCircuitArrows(circuit); }); });
            resetDiagramBtn.addEventListener('click', hideAllArrows);
        } else {
            console.warn("Éléments du diagramme SVG (boutons ou SVG lui-même) non trouvés. L'interactivité du diagramme sera limitée.");
        }

        const svgElementForTooltip = document.getElementById('kitchenPlan');
        const zoneTooltip = document.getElementById('zone-tooltip');
        const tooltipZoneName = document.getElementById('tooltip-zone-name');
        const tooltipZoneTypeDisplay = document.getElementById('tooltip-zone-type');
        const zoneTypeToLabel = { "souille": "Secteur Souillé", "propre": "Secteur Propre", "transition": "Zone de Transition" };
        const zoneTypeToColorClass = { "souille": "bg-red-600", "propre": "bg-green-600", "transition": "bg-blue-600" };

        if (svgElementForTooltip && zoneTooltip && tooltipZoneName && tooltipZoneTypeDisplay) {
            svgElementForTooltip.addEventListener('mouseover', (event) => {
                const targetRect = event.target.closest('rect[data-zone-type]');
                if (targetRect) {
                    const zoneName = targetRect.dataset.zoneName || "Zone"; const zoneType = targetRect.dataset.zoneType;
                    tooltipZoneName.textContent = zoneName; tooltipZoneTypeDisplay.textContent = zoneTypeToLabel[zoneType] || "Type inconnu";
                    zoneTooltip.className = 'absolute text-white text-xs p-1.5 rounded-md shadow-lg pointer-events-none z-50 transition-opacity duration-200'; // Reset
                    zoneTooltip.classList.add(zoneTypeToColorClass[zoneType] || 'bg-gray-700');
                    let x = event.pageX + 15; let y = event.pageY - 35; 
                    if (y < 10) y = event.pageY + 15; 
                    if (x + zoneTooltip.offsetWidth +15 > window.innerWidth) x = window.innerWidth - zoneTooltip.offsetWidth - 15; 
                    zoneTooltip.style.left = `${x}px`; zoneTooltip.style.top = `${y}px`; zoneTooltip.classList.remove('hidden');
                }
            });
             svgElementForTooltip.addEventListener('mousemove', (event) => {
                if (!zoneTooltip.classList.contains('hidden')) { // Update position only if visible
                    let x = event.pageX + 15; let y = event.pageY - 35;
                    if (y < 10) y = event.pageY + 15;
                    if (x + zoneTooltip.offsetWidth + 15 > window.innerWidth) x = window.innerWidth - zoneTooltip.offsetWidth - 15;
                    zoneTooltip.style.left = `${x}px`; zoneTooltip.style.top = `${y}px`;
                }
            });
            svgElementForTooltip.addEventListener('mouseout', (event) => {
                const targetRect = event.target.closest('rect[data-zone-type]');
                 if (targetRect && (!event.relatedTarget || !targetRect.contains(event.relatedTarget))) { 
                    zoneTooltip.classList.add('hidden');
                } else if (!targetRect && !event.relatedTarget?.closest('rect[data-zone-type]')) { // Also hide if mouse moves out of SVG entirely or to a non-zone part
                     zoneTooltip.classList.add('hidden');
                }
            });
        } else { console.warn("Éléments pour l'info-bulle du plan de cuisine non trouvés."); }

        const flipCards = document.querySelectorAll('.flip-card');
        flipCards.forEach(card => { card.addEventListener('click', function() { this.classList.toggle('flipped'); }); });

        const quizQuestions = [ { question: "Quel est l'objectif principal de la marche en avant ?", options: ["Augmenter la productivité", "Éviter les contaminations croisées", "Réduire les coûts", "Simplifier le travail"], answer: 1 }, { question: "Un légume brut arrivant du fournisseur est considéré comme:", options: ["Propre", "Souillé", "Neutre", "Décontaminé"], answer: 1 }, { question: "Où le personnel passe-t-il de 'souillé' à 'propre' ?", options: ["En cuisine", "Dans les vestiaires", "À la réception", "En salle"], answer: 1 }, { question: "La plonge où l'on lave les casseroles (plonge batterie) est un secteur:", options: ["Propre", "Souillé", "De transition", "Extérieur"], answer: 0 }, { question: "Si une cuisine n'a pas de murs pour séparer les zones, que doit-on faire ?", options: ["Ignorer la marche en avant", "Travailler plus vite", "Séparer les tâches dans l'espace et/ou le temps", "Utiliser plus de désinfectant"], answer: 2 }, { question: "Le circuit des déchets est toujours considéré comme :", options: ["Propre", "Souillé", "Neutre", "Variable"], answer: 1}, { question: "La zone de 'déconditionnement' est typiquement une zone :", options: ["Totalement propre", "Totalement souillée", "De transition", "De stockage long terme"], answer: 2}, { question: "Le personnel de service (serveurs) est considéré comme faisant partie du circuit :", options: ["Propre", "Souillé", "De préparation", "De cuisson"], answer: 1}, { question: "Quel est le risque principal évité par la marche en avant ?", options: ["Les brûlures", "Les coupures", "La contamination croisée", "Le gaspillage alimentaire"], answer: 2}, { question: "La 'marche en avant dans le temps' signifie :", options: ["Travailler uniquement le matin", "Effectuer les tâches sales puis les tâches propres après nettoyage complet", "Utiliser un chronomètre pour chaque tâche", "Préparer tous les plats en même temps"], answer: 1} ];
        const quizContainer = document.getElementById('quiz-container'); const progressBarQuiz = document.getElementById('quiz-progress'); let currentQuizQuestion = 0; let quizScore = 0;
        function startQuiz() { currentQuizQuestion = 0; quizScore = 0; if(progressBarQuiz) progressBarQuiz.style.width = '0%'; showQuizQuestion(); }
        function showQuizQuestion() { if (!quizContainer) return; if(progressBarQuiz) progressBarQuiz.style.width = `${(currentQuizQuestion / quizQuestions.length) * 100}%`; if (currentQuizQuestion >= quizQuestions.length) { showQuizResults(); return; } const question = quizQuestions[currentQuizQuestion]; let optionsHtml = question.options.map((option, index) => `<button class="quiz-option w-full text-left bg-white hover:bg-slate-100 border border-slate-200 rounded-lg px-4 py-3 mb-2 transition" data-answer="${index}">${option}</button>`).join(''); quizContainer.innerHTML = `<div><div class="flex justify-between items-center mb-6"><span class="text-slate-500">Question ${currentQuizQuestion + 1}/${quizQuestions.length}</span><span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Score: ${quizScore}</span></div><h3 class="text-xl font-semibold text-slate-800 mb-6">${question.question}</h3><div class="space-y-3 mb-6">${optionsHtml}</div><div id="quiz-feedback" class="hidden"></div></div>`; quizContainer.querySelectorAll('.quiz-option').forEach(button => button.addEventListener('click', function() { checkQuizAnswer(parseInt(this.getAttribute('data-answer'))); })); }
        function checkQuizAnswer(selectedAnswer) { const question = quizQuestions[currentQuizQuestion]; const feedbackDiv = quizContainer.querySelector('#quiz-feedback'); if (selectedAnswer === question.answer) { feedbackDiv.innerHTML = `<div class="bg-green-100 text-green-800 p-3 rounded-lg"><i class="fas fa-check-circle mr-2"></i>Correct !</div>`; quizScore++; } else { feedbackDiv.innerHTML = `<div class="bg-red-100 text-red-800 p-3 rounded-lg"><i class="fas fa-times-circle mr-2"></i>Incorrect. La bonne réponse était: ${question.options[question.answer]}</div>`; } feedbackDiv.classList.remove('hidden'); quizContainer.querySelectorAll('.quiz-option').forEach(btn => btn.disabled = true); const nextButton = document.createElement('button'); nextButton.className = 'mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition'; nextButton.innerHTML = currentQuizQuestion < quizQuestions.length - 1 ? 'Question suivante <i class="fas fa-arrow-right ml-2"></i>' : 'Voir les résultats'; nextButton.addEventListener('click', () => { currentQuizQuestion++; showQuizQuestion(); }); feedbackDiv.appendChild(nextButton); }
        function showQuizResults() { if (!quizContainer) return; const percentage = Math.round((quizScore / quizQuestions.length) * 100); let message = percentage >= 80 ? 'Excellent ! Vous maîtrisez bien la Marche en Avant.' : percentage >= 50 ? 'Bien ! Quelques révisions sont utiles.' : 'Revoyez attentivement les sections précédentes.'; let emoji = percentage >= 80 ? '🏆' : percentage >= 50 ? '👍' : '📚'; if(progressBarQuiz) progressBarQuiz.style.width = '100%'; quizContainer.innerHTML = `<div class="text-center py-8"><div class="text-5xl mb-4">${emoji}</div><h3 class="text-2xl font-semibold text-slate-800 mb-2">Résultats du Quiz</h3><p class="text-xl font-bold text-blue-600 mb-4">${quizScore}/${quizQuestions.length} (${percentage}%)</p><p class="text-slate-600 mb-6 max-w-md mx-auto">${message}</p><button id="restart-quiz" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg text-lg font-medium transition"><i class="fas fa-redo mr-2"></i>Refaire le quiz</button></div>`; quizContainer.querySelector('#restart-quiz').addEventListener('click', startQuiz); }
        if (quizContainer) { quizContainer.innerHTML = `<div class="text-center py-8"><h3 class="text-xl font-semibold text-slate-700 mb-2">Quiz sur la Marche en Avant</h3><p class="text-slate-500 mb-6">Répondez à ${quizQuestions.length} questions pour valider vos connaissances.</p><button id="start-quiz-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg text-lg font-medium transition"><i class="fas fa-play mr-2"></i>Commencer le quiz</button></div>`; quizContainer.querySelector('#start-quiz-btn').addEventListener('click', startQuiz); }

        const gameScenarios = [ { id: 1, title: "🍅 Préparation d'une salade de tomates", description: "Ordre correct :", steps: [ { id: "reception_tom", text: "Réception tomates (carton)", order: 1 }, { id: "lavage_tom", text: "Lavage & désinfection", order: 2 }, { id: "decoupe_tom", text: "Découpe", order: 3 }, { id: "assaisonnement_tom", text: "Assaisonnement", order: 4 }, { id: "service_tom", text: "Dressage & envoi", order: 5 } ] }, { id: 2, title: "🍗 Déconditionnement Poulet Cru", description: "Ordre correct :", steps: [ { id: "reception_poulet", text: "Réception poulet cru emballé", order: 1 }, { id: "stockage_froid_poulet", text: "Stockage CF (+2°C)", order: 2 }, { id: "decond_poulet", text: "Déconditionnement (retrait emballage)", order: 3 }, { id: "prep_poulet", text: "Transfert zone prépa. viande", order: 4 } ] }, { id: 3, title: "🗑️ Évacuation des déchets de cuisine", description: "Ordre correct :", steps: [ { id: "collecte_dechets_prep", text: "Collecte déchets zone préparation", order: 1 }, { id: "transport_poubelle_couloir", text: "Transport poubelle via couloir dédié", order: 2 }, { id: "depot_local_dechet", text: "Dépôt dans local déchets extérieur", order: 3 } ] }, { id: 4, title: "🧼 Nettoyage Plan de Travail", description: "Ordre correct APRES préparation viande crue :", steps: [ { id: "debarrassage_gros", text: "Débarrasser les gros résidus", order: 1 }, { id: "nettoyage_detergent", text: "Nettoyer avec détergent", order: 2 }, { id: "rincage_eau_claire", text: "Rincer à l'eau claire", order: 3 }, { id: "desinfection_produit", text: "Appliquer désinfectant (temps de contact)", order: 4 }, { id: "rincage_final_si_besoin", text: "Rincer si désinfectant l'exige", order: 5 } ] }, { id: 5, title: "🍽️ Retour Vaisselle Sale de la Salle", description: "Ordre correct :", steps: [ { id: "arrivee_chariot_salle", text: "Arrivée chariot vaisselle sale", order: 1 }, { id: "tri_dechets_assiettes", text: "Tri et vidage des déchets d'assiettes", order: 2 }, { id: "prelavage_douchette", text: "Prélavage à la douchette", order: 3 }, { id: "passage_lave_vaisselle", text: "Passage en machine (lave-vaisselle)", order: 4 }, { id: "sechage_stockage_propre", text: "Séchage et stockage vaisselle propre", order: 5 } ] }, { id: 6, title: "👨‍🍳 Arrivée du Cuisinier", description: "Ordre correct :", steps: [ { id: "arrivee_exterieur", text: "Arrivée en tenue de ville", order: 1 }, { id: "passage_vestiaire", text: "Passage aux vestiaires", order: 2 }, { id: "changement_tenue_pro", text: "Mise de la tenue professionnelle propre", order: 3 }, { id: "lavage_mains_arrivee_poste", text: "Lavage des mains avant prise de poste", order: 4 } ] }, { id: 7, title: "🥕 Préparation Carottes Râpées", description: "Ordre correct :", steps: [ { id: "reception_carottes_vrac", text: "Réception carottes terreuses", order: 1 }, { id: "epluchage_lavage_legumerie", text: "Épluchage et lavage en légumerie", order: 2 }, { id: "transfert_zone_prep_froide", text: "Transfert vers zone prépa. froide", order: 3 }, { id: "rapage_carottes", text: "Râpage des carottes", order: 4 }, { id: "conditionnement_froid", text: "Conditionnement et stockage au froid", order: 5 } ] }, { id: 8, title: "📦 Réception Marchandises Sèches", description: "Ordre correct :", steps: [ { id: "livraison_quai", text: "Livraison cartons sur quai", order: 1 }, { id: "controle_qte_dlc", text: "Contrôle quantité et DLC", order: 2 }, { id: "transfert_reserve_seche", text: "Transfert vers réserve sèche", order: 3 }, { id: "rangement_etageres", text: "Rangement sur étagères (FIFO)", order: 4 } ] }, { id: 9, title: "🐟 Préparation Filet de Poisson", description: "Ordre correct :", steps: [ { id: "sortie_poisson_cf", text: "Sortie poisson de la chambre froide", order: 1 }, { id: "deconditionnement_poisson", text: "Déconditionnement sur plan dédié", order: 2 }, { id: "preparation_filets", text: "Levée des filets / parage", order: 3 }, { id: "cuisson_immediate_ou_stockage_froid", text: "Cuisson immédiate ou stockage froid (+film)", order: 4 } ] }, { id: 10, title: "🍰 Fin de Service Pâtisserie", description: "Ordre correct :", steps: [ { id: "debarrassage_invendus", text: "Débarrassage des invendus (gestion DLC)", order: 1 }, { id: "nettoyage_plans_travail_patisserie", text: "Nettoyage plans de travail et matériel", order: 2 }, { id: "rangement_propre", text: "Rangement du matériel propre et sec", order: 3 }, { id: "nettoyage_sol_patisserie", text: "Nettoyage du sol de la pâtisserie", order: 4 } ] }, { id: 11, title: "🥤 Service Boisson en Salle", description: "Ordre correct pour un serveur:", steps: [ {id: "prise_commande_salle", text: "Prise de commande en salle", order: 1}, {id: "passage_office_bar", text: "Passage à l'office/bar (zone de transition)", order: 2}, {id: "preparation_boisson_propre", text: "Préparation boisson (verre propre, etc.)", order: 3}, {id: "service_client_salle", text: "Service au client en salle", order: 4}]}, { id: 12, title: "🧊 Utilisation Glaçons", description: "Ordre correct :", steps: [ {id: "prise_bac_glacon_congel", text: "Prise bac à glaçons du congélateur", order: 1}, {id: "utilisation_pelle_specifique", text: "Utilisation d'une pelle à glaçons propre et dédiée", order: 2}, {id: "remplissage_verre_sans_contact", text: "Remplissage verre sans contact direct main/glaçon", order: 3}, {id: "retour_pelle_propre_ou_lavage", text: "Retour pelle à son emplacement propre (ou lavage)", order: 4}]} ];
        class MarcheEnAvantGame { constructor() { this.currentScenarioIdx = 0; this.globalScore = 0; this.playerSequence = []; this.draggedElement = null; this.scoreElement = document.getElementById('score-game'); this.stepsPool = document.getElementById('steps-pool-game'); this.timelineSlotsContainer = document.getElementById('timeline-slots-game'); this.scenarioCard = document.getElementById('scenario-card-game'); this.feedbackContainer = document.getElementById('feedback-game-container'); this.validateBtn = document.getElementById('validate-btn-game'); this.resetBtn = document.getElementById('reset-btn-game'); this.hintBtn = document.getElementById('hint-btn-game'); this.nextScenarioBtn = document.getElementById('next-scenario-btn-game'); this.scenarioProgressBar = document.getElementById('scenario-progress-bar'); this.scenarioCounterElement = document.getElementById('scenario-counter'); this.closeFeedbackBtn = document.getElementById('close-feedback-game-btn'); if(!this.stepsPool || !this.validateBtn) { console.error("Éléments du jeu de scénarios non trouvés. Jeu non initialisé."); return; } this.setupEventListeners(); this.loadScenario(); this.updateProgressBar(); }
            setupEventListeners() { this.validateBtn.addEventListener('click', () => this.validateSequence()); this.resetBtn.addEventListener('click', () => this.resetScenario()); this.hintBtn.addEventListener('click', () => this.showHint()); this.nextScenarioBtn.addEventListener('click', () => this.nextScenario()); if(this.closeFeedbackBtn) this.closeFeedbackBtn.addEventListener('click', () => this.feedbackContainer.style.display = 'none');}
            updateProgressBar() { const percentage = ((this.currentScenarioIdx) / gameScenarios.length) * 100; if (this.scenarioProgressBar) { this.scenarioProgressBar.style.width = `${percentage}%`; this.scenarioProgressBar.textContent = this.currentScenarioIdx > 0 ? `${Math.round(percentage)}%` : "";} if (this.scenarioCounterElement) { this.scenarioCounterElement.textContent = `Scénario ${this.currentScenarioIdx + 1} / ${gameScenarios.length}`;}}
            loadScenario() { if (this.currentScenarioIdx >= gameScenarios.length) { this.showFinalResults(); return; } this.updateProgressBar(); const scenario = gameScenarios[this.currentScenarioIdx]; this.scenarioCard.innerHTML = `<h3 class="text-lg font-semibold text-blue-800">${scenario.title}</h3><p class="text-blue-700 text-sm">${scenario.description}</p>`; const shuffledSteps = [...scenario.steps].sort(() => Math.random() - 0.5); this.stepsPool.innerHTML = ''; shuffledSteps.forEach(step => this.stepsPool.appendChild(this.createStepElement(step))); this.timelineSlotsContainer.innerHTML = ''; for (let i = 0; i < scenario.steps.length; i++) { this.timelineSlotsContainer.appendChild(this.createTimelineSlot(i + 1)); } this.playerSequence = []; this.nextScenarioBtn.style.display = 'none'; this.validateBtn.disabled = false; this.resetBtn.disabled = false; this.hintBtn.disabled = false; this.updateDisplay(); }
            createStepElement(step) { const el = document.createElement('div'); el.className = 'step-item-game'; el.textContent = step.text; el.draggable = true; el.dataset.stepId = step.id; el.dataset.order = step.order; el.addEventListener('dragstart', (e) => { this.draggedElement = el; el.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; }); el.addEventListener('dragend', () => { el.classList.remove('dragging'); this.draggedElement = null; }); return el; }
            createTimelineSlot(stepNumber) { const slot = document.createElement('div'); slot.className = 'timeline-slot-game'; slot.dataset.step = stepNumber; slot.addEventListener('dragover', (e) => { e.preventDefault(); slot.classList.add('drag-over'); }); slot.addEventListener('dragleave', () => slot.classList.remove('drag-over')); slot.addEventListener('drop', (e) => { e.preventDefault(); slot.classList.remove('drag-over'); if (this.draggedElement) this.handleDrop(slot, this.draggedElement); }); return slot; }
            handleDrop(slot, stepElement) { const existingStep = slot.querySelector('.step-item-game'); if (existingStep) { this.stepsPool.appendChild(existingStep); this.playerSequence = this.playerSequence.filter(s => s.element !== existingStep); } slot.appendChild(stepElement); this.playerSequence.push({ element: stepElement, stepId: stepElement.dataset.stepId, order: parseInt(stepElement.dataset.order), position: parseInt(slot.dataset.step) }); }
            validateSequence() { const scenario = gameScenarios[this.currentScenarioIdx]; if (this.playerSequence.length !== scenario.steps.length) { this.showFeedback(false, "Séquence incomplète", "Veuillez placer toutes les étapes."); return; } let isCorrect = true; let scenarioScore = scenario.steps.length * 10; this.timelineSlotsContainer.querySelectorAll('.timeline-slot-game').forEach((slot, index) => { const stepInSlot = slot.querySelector('.step-item-game'); if (stepInSlot) { if (parseInt(stepInSlot.dataset.order) !== (index + 1)) { isCorrect = false; scenarioScore = 0; } } else { isCorrect = false; scenarioScore = 0; } }); if (isCorrect) { this.globalScore += scenarioScore; this.showFeedback(true, "Excellent !", `Marche en avant respectée ! Vous gagnez ${scenarioScore} points.`); this.nextScenarioBtn.style.display = 'inline-block'; this.validateBtn.disabled = true; this.resetBtn.disabled = true; this.hintBtn.disabled = true; } else { this.showFeedback(false, "Pas tout à fait...", "L'ordre n'est pas correct. Aucun point pour ce scénario."); } this.updateDisplay(); }
            showHint() { this.showFeedback(true, "💡 Indice", "Pensez au trajet logique : Réception (sale) -> Traitement (légumerie) -> Préparation (propre) -> Service (propre). Ne revenez jamais en arrière !");}
            resetScenario() { this.timelineSlotsContainer.querySelectorAll('.timeline-slot-game .step-item-game').forEach(step => { this.stepsPool.appendChild(step); }); this.playerSequence = []; this.nextScenarioBtn.style.display = 'none'; this.validateBtn.disabled = false; this.resetBtn.disabled = false; this.hintBtn.disabled = false; }
            nextScenario() { this.currentScenarioIdx++; this.loadScenario(); }
            showFinalResults() { this.scenarioCard.innerHTML = `<h3 class="text-xl font-semibold text-green-700 text-center">🎉 Tous les scénarios terminés ! 🎉</h3><p class="text-slate-700 text-lg text-center mt-4">Votre score global est de : <strong>${this.globalScore} points</strong>.</p><p class="text-slate-600 text-center mt-2">Continuez à pratiquer !</p>`; this.stepsPool.innerHTML = ''; this.timelineSlotsContainer.innerHTML = ''; this.validateBtn.style.display = 'none'; this.resetBtn.textContent = 'Recommencer Tous les Scénarios'; this.resetBtn.onclick = () => {this.currentScenarioIdx = 0; this.globalScore = 0; this.validateBtn.style.display = 'inline-block'; this.resetBtn.textContent = 'Recommencer'; this.hintBtn.style.display = 'inline-block'; this.setupEventListeners(); this.loadScenario();}; this.hintBtn.style.display = 'none'; this.nextScenarioBtn.style.display = 'none'; if (this.scenarioProgressBar) {this.scenarioProgressBar.style.width = `100%`; this.scenarioProgressBar.textContent = "100%";} if (this.scenarioCounterElement) this.scenarioCounterElement.textContent = `Terminé ! ${gameScenarios.length}/${gameScenarios.length}`; }
            showFeedback(isSuccess, title, message) { const iconEl = this.feedbackContainer.querySelector('.feedback-game-icon'); const textEl = this.feedbackContainer.querySelector('.feedback-game-text'); const explEl = this.feedbackContainer.querySelector('.feedback-game-explanation'); iconEl.textContent = isSuccess ? '🎉' : '🤔'; textEl.textContent = title; explEl.innerHTML = message.replace(/\n/g, '<br>'); this.feedbackContainer.style.display = 'flex'; }
            updateDisplay() { if(this.scoreElement) this.scoreElement.textContent = this.globalScore; }
        }
        if (document.getElementById('steps-pool-game')) { new MarcheEnAvantGame(); }
    });
    </script>
</body>
</html>