<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base de Donn√©es Op√©rationnelle Qualiopi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate & Sky -->
    <!-- Application Structure Plan: An interactive database designed for self-assessment. The top of the page features a comprehensive filter panel allowing users to select their specific context (typology, modality, size, etc.). A new visual dashboard with a Donut chart shows the impact of typology filters. The main content is an accordion of the 7 Qualiopi criteria. Each indicator is a card containing an expert analysis and a dynamic checklist of potential evidence. Each indicator now has a status dropdown for progress tracking. The core interaction is the filtering: selecting filters instantly hides/shows evidence items based on data-tags, personalizing the checklist. A lexicon modal is added for clarity. Export functions for filtered content are also included. -->
    <!-- Visualization & Content Choices:
        - Report Info: Qualiopi Criteria & Indicators -> Goal: Organize, Inform, Self-Assess -> Viz/Method: Interactive Accordion & Dynamic Checklist with Statuses -> Interaction: Filtering by context, checking items, setting status, exporting -> Justification: Breaks down complex info, personalizes content for high relevance, and provides an actionable checklist format as requested. -> Library: Vanilla JS.
        - Report Info: Situational variables (typology, modality) -> Goal: Filter & Personalize -> Viz/Method: Checkbox-based filter panel & Donut Chart -> Interaction: Clicking checkboxes updates the main view and the chart -> Justification: Empower users to create their own view of the database, making the vast amount of information manageable and directly applicable. -> Library: Vanilla JS, Chart.js.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        .accordion-header.open .accordion-icon { transform: rotate(180deg); }
        .accordion-icon { transition: transform 0.3s ease; }
        .evidence-item, .indicator-card { transition: opacity 0.3s, max-height 0.3s, padding 0.3s, margin 0.3s, background-color 0.3s; opacity: 1; max-height: 1000px; overflow: hidden; }
        .evidence-item.hidden, .indicator-card.hidden { opacity: 0; max-height: 0; pointer-events: none; margin: 0; padding: 0; border: none; }
        .filter-checkbox:checked + label { background-color: #0284c7; color: white; border-color: #0284c7; }
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-container { transition: transform 0.3s ease; }
        .chart-container { position: relative; width: 100%; max-width: 250px; margin-left: auto; margin-right: auto; height: 250px; }
        #back-to-top-btn { transition: opacity 0.3s, transform 0.3s; }
        .status-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); transition: background-color 0.3s, color 0.3s; }
        
        .status-not-treated { background-color: #f1f5f9; border-left-color: #64748b; }
        .status-todo { background-color: #fef2f2; border-left-color: #ef4444; }
        .status-in-progress { background-color: #fefce8; border-left-color: #eab308; }
        .status-done { background-color: #f0fdf4; border-left-color: #22c55e; }

        .select-not-treated { background-color: #e2e8f0; color: #334155; }
        .select-todo { background-color: #fecaca; color: #991b1b; font-weight: 500; }
        .select-in-progress { background-color: #fde68a; color: #854d0e; font-weight: 500; }
        .select-done { background-color: #bbf7d0; color: #166534; font-weight: 500; }

        /* Styles for Toolkit Tabs */
        .tab-button.active { border-color: #0284c7; color: #0284c7; background-color: #f0f9ff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Styles for KPI Cards in Audit Cycle */
        .kpi-card { transition: all 0.3s ease-in-out; }
        .kpi-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }

        /* Styles for Toolkit Accordion (distinct from main accordion) */
        .toolkit-accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }
        .toolkit-accordion-header .toolkit-accordion-icon { transition: transform 0.3s ease; }
        .toolkit-accordion-header.open .toolkit-accordion-icon { transform: rotate(90deg); } /* Rotates right for triangle icon */

        /* Styles for Quiz */
        .quiz-option:disabled { cursor: not-allowed; }
        .quiz-option.correct { background-color: #dcfce7; border-color: #22c55e; }
        .quiz-option.incorrect { background-color: #fee2e2; border-color: #ef4444; }
        .hint-box { display: none; }
        
        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            /* Hide interactive and non-essential elements for printing */
            header, #filters, footer, #open-lexicon-btn, .accordion-icon, input[type="checkbox"], #lexicon-modal, #visual-dashboard, #back-to-top-btn, .status-select, #podcast-section, #toolkit, #quiz-section { display: none !important; }
            
            main, #criteria-accordion, .accordion-content, .indicator-card, .evidence-item { display: block !important; box-shadow: none !important; border: none !important; max-height: none !important; overflow: visible !important; }
            .accordion-header { background-color: #f1f5f9 !important; border-bottom: 1px solid #ccc !important; page-break-after: avoid; }
            .indicator-card { page-break-inside: avoid; border-left: 4px solid; }
            .evidence-item.hidden, .indicator-card.hidden { display: none !important; }
            .container { max-width: 100% !important; padding: 0 !important; margin: 0 !important; }
            .print-status::before { content: "Statut : " attr(data-print-status); font-weight: bold; display: block; margin-bottom: 0.5rem; color: black; }
            .print-checkbox { display: inline-block; width: 1em; height: 1em; border: 1px solid #000; margin-right: 0.5em; vertical-align: middle; }
            .print-checkbox.checked::after { content: '‚úî'; display: block; text-align: center; line-height: 1; }
            .evidence-item > label::before { content: '[ ] '; font-family: monospace; }
            .evidence-item > label > input:checked + span::before { content: '[x] '; font-family: monospace; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8 relative">
             <div class="flex justify-center items-center gap-4 mb-2">
                <div class="flex-shrink-0 w-16 h-16 bg-sky-600 rounded-2xl flex items-center justify-center shadow-lg">
                    <span class="text-white text-4xl font-bold">Q</span>
                </div>
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-sky-600">Base de Donn√©es Op√©rationnelle</h1>
                    <p class="text-lg text-slate-600">Qualiopi</p>
                </div>
            </div>
            <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Un outil de brainstorming interactif pour explorer un large √©ventail d'exemples de preuves et pr√©parer votre audit.</p>
            <button id="open-lexicon-btn" class="absolute top-0 right-0 bg-sky-100 text-sky-700 font-semibold py-2 px-4 rounded-lg hover:bg-sky-200 transition-colors">Lexique</button>
        </header>

        <section id="podcast-section" class="mb-8 bg-sky-600 p-6 rounded-xl shadow-lg">
            <div class="flex items-center gap-4">
                <div class="flex-shrink-0 w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                    <div class="flex flex-col items-center">
                        <div class="w-4 h-6 bg-white rounded-full"></div>
                        <div class="w-1 h-2 bg-white"></div>
                    </div>
                </div>
                <div>
                    <h2 class="font-semibold text-lg text-white">Le Podcast Qualiopi</h2>
                    <p class="text-sm text-sky-100">Comprendre l'essentiel en quelques minutes.</p>
                </div>
            </div>
            <div class="mt-4">
                <audio controls class="w-full">
                    <source src="https://ddeamil.github.io/e-format.github.io/Qualiopi/Qualiopi%20_%20Cultiver-l-Excellence.mp3" type="audio/mpeg">
                    Votre navigateur ne supporte pas l'√©l√©ment audio.
                </audio>
                <p class="text-xs text-center text-sky-200 mt-2">√âcouter le fichier audio de pr√©sentation.</p>
            </div>
        </section>

        <!-- START OF NEW SECTIONS FROM Qualiopi4.html -->

        <!-- Section 2: Compliance Toolkit -->
        <section id="toolkit" class="bg-white p-6 rounded-xl shadow-md border border-slate-200 mb-10">
            <h2 class="text-2xl font-semibold text-slate-900 mb-1">Bo√Æte √† Outils de Conformit√©</h2>
            <p class="text-slate-600 mb-6">Explorez les ressources pratiques pour pr√©parer votre audit et maintenir votre syst√®me qualit√©.</p>

            <div class="border-b border-slate-200 mb-6">
                <nav id="toolkit-tabs" class="flex flex-wrap -mb-px" aria-label="Tabs">
                    <!-- Tabs will be inserted here by JS -->
                </nav>
            </div>
            
            <div id="toolkit-content">
                <!-- Tab content will be inserted here by JS -->
            </div>

        </section>
        
        <!-- Section 3: Quiz -->
        <section id="quiz-section" class="bg-white p-6 rounded-xl shadow-md border border-slate-200 mb-8">
            <h2 class="text-2xl font-semibold text-slate-900 mb-1">Testez vos Connaissances</h2>
            <p class="text-slate-600 mb-6">Validez votre compr√©hension des points cl√©s du r√©f√©rentiel Qualiopi.</p>

            <div id="quiz-container" class="max-w-2xl mx-auto">
                <div id="quiz-start-screen">
                    <p class="text-center mb-4">Pr√™t √† tester vos connaissances sur Qualiopi ? Le quiz comporte 15 questions.</p>
                    <button id="start-quiz-btn" class="w-full bg-sky-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-700 transition-colors">Commencer le Quiz</button>
                </div>

                <div id="quiz-main-screen" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <div id="quiz-progress" class="text-sm font-medium text-slate-600"></div>
                        <button id="hint-btn" class="flex items-center gap-2 text-sm text-amber-600 hover:text-amber-700 font-semibold">
                            <span>üí°</span>
                            <span>Indice</span>
                        </button>
                    </div>
                    <div id="hint-box" class="p-3 mb-4 bg-amber-100 border-l-4 border-amber-500 text-amber-800 rounded-r-lg text-sm"></div>
                    <h3 id="question-text" class="text-lg font-semibold mb-4 text-slate-800"></h3>
                    <div id="answer-options" class="grid grid-cols-1 gap-3"></div>
                    <div id="feedback-area" class="mt-4"></div>
                    <button id="next-question-btn" class="mt-6 w-full bg-sky-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-700 transition-colors hidden">Question Suivante</button>
                </div>

                <div id="quiz-end-screen" class="hidden text-center">
                    <h3 class="text-xl font-bold mb-2">Quiz Termin√© !</h3>
                    <p id="quiz-score" class="text-lg mb-4"></p>
                    <p id="quiz-summary-text" class="text-slate-600 mb-6"></p>
                    <button id="restart-quiz-btn" class="w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-900 transition-colors">Recommencer le Quiz</button>
                </div>
            </div>
        </section>

        <!-- END OF NEW SECTIONS FROM Qualiopi4.html -->

        <section id="filters" class="bg-white p-4 rounded-xl shadow-lg mb-8 border-b-4 border-slate-200">
            <h2 class="text-xl font-semibold mb-4 text-slate-800">Filtrez les exemples de preuves selon votre contexte</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div>
                    <h3 class="font-semibold text-slate-700 mb-2">1. Cat√©gories d'Actions</h3>
                    <div id="filter-typology" class="flex flex-col space-y-2"></div>
                </div>
                <div>
                    <h3 class="font-semibold text-slate-700 mb-2">2. Modalit√©s P√©dagogiques</h3>
                    <div id="filter-modality" class="flex flex-col space-y-2"></div>
                </div>
                <div>
                    <h3 class="font-semibold text-slate-700 mb-2">3. Taille & Structure</h3>
                    <div id="filter-size" class="flex flex-col space-y-2"></div>
                </div>
                <div>
                    <h3 class="font-semibold text-slate-700 mb-2">4. Contextes Sp√©cifiques</h3>
                    <div id="filter-context" class="flex flex-col space-y-2"></div>
                </div>
            </div>
             <div class="mt-4 text-center">
                <button id="reset-filters" class="text-sm font-semibold text-sky-600 hover:text-sky-800">R√©initialiser les filtres</button>
            </div>
            <div class="mt-6 pt-4 border-t border-slate-200 flex flex-col sm:flex-row items-center justify-center gap-4">
                <h3 class="font-semibold text-slate-700">Exporter la s√©lection :</h3>
                <div class="flex flex-wrap justify-center gap-2">
                    <button id="export-csv-btn" class="bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-700 transition-colors text-sm">CSV (.csv)</button>
                    <button id="export-md-btn" class="bg-sky-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-sky-700 transition-colors text-sm">Markdown (.md)</button>
                    <button id="export-pdf-btn" class="bg-slate-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-700 transition-colors text-sm">PDF (via Impression)</button>
                </div>
            </div>
        </section>

        <section id="visual-dashboard" class="bg-white p-6 rounded-xl shadow-md mb-8">
             <h2 class="text-xl font-semibold mb-4 text-slate-800 text-center">Indicateurs Applicables √† votre Profil</h2>
             <div class="chart-container">
                <canvas id="indicator-chart"></canvas>
             </div>
        </section>

        <main id="criteria-accordion" class="space-y-4">
            <!-- Accordion will be generated by JS -->
        </main>
        
        <footer class="text-center mt-12 text-slate-200 bg-slate-800 p-6 rounded-lg">
             <p class="text-sm text-slate-400">Cet outil est une ressource de brainstorming et ne remplace pas une analyse de conformit√© personnalis√©e.</p>
             <p class="mt-4 text-sm text-slate-400">d.de Amil | IRP - 2025</p>
        </footer>
    </div>

    <!-- Lexicon Modal -->
    <div id="lexicon-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay hidden opacity-0">
        <div class="modal-container bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-bold text-slate-800">Lexique Qualiopi</h2>
                <button id="close-lexicon-btn" class="text-2xl text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto space-y-4">
                <div class="term">
                    <h3 class="font-semibold text-sky-700">AF (Actions de Formation)</h3>
                    <p class="text-sm text-slate-600">Cat√©gorie d'action principale visant √† permettre √† toute personne d'acqu√©rir et d'actualiser un socle de connaissances et de comp√©tences favorisant son √©volution professionnelle.</p>
                </div>
                 <div class="term">
                    <h3 class="font-semibold text-sky-700">AFEST (Action de Formation En Situation de Travail)</h3>
                    <p class="text-sm text-slate-600">Modalit√© de formation qui utilise la situation de travail comme lieu et moyen d'apprentissage, structur√©e par des phases r√©flexives.</p>
                </div>
                <div class="term">
                    <h3 class="font-semibold text-sky-700">BC (Bilans de Comp√©tences)</h3>
                    <p class="text-sm text-slate-600">Prestation permettant d'analyser ses comp√©tences professionnelles et personnelles ainsi ainsi que ses aptitudes et ses motivations en appui d'un projet d'√©volution professionnelle.</p>
                </div>
                <div class="term">
                    <h3 class="font-semibold text-sky-700">CFA (Centre de Formation d'Apprentis)</h3>
                    <p class="text-sm text-slate-600">√âtablissement de formation qui dispense des enseignements en alternance dans le cadre d'un contrat d'apprentissage.</p>
                </div>
                 <div class="term">
                    <h3 class="font-semibold text-sky-700">CPF (Compte Personnel de Formation)</h3>
                    <p class="text-sm text-slate-600">Dispositif de financement public de la formation continue qui permet √† toute personne active d'acqu√©rir des droits √† la formation mobilisables tout au long de sa vie professionnelle.</p>
                </div>
                <div class="term">
                    <h3 class="font-semibold text-sky-700">FOAD (Formation Ouverte et/ou √† Distance)</h3>
                    <p class="text-sm text-slate-600">Modalit√© p√©dagogique qui permet de se former sans se rendre dans un lieu de formation physique, via des ressources en ligne, des classes virtuelles, etc.</p>
                </div>
                 <div class="term">
                    <h3 class="font-semibold text-sky-700">Grand OF (>10)</h3>
                    <p class="text-sm text-slate-600">Terme conventionnel d√©signant un Organisme de Formation (OF) d'une certaine taille, g√©n√©ralement avec un effectif de plus de 10 salari√©s en √âquivalent Temps Plein (ETP).</p>
                </div>
                <div class="term">
                    <h3 class="font-semibold text-sky-700">Ind√©pendant</h3>
                    <p class="text-sm text-slate-600">Prestataire de formation exer√ßant en nom propre (entreprise individuelle, micro-entrepreneur) ou en soci√©t√© unipersonnelle (EURL, SASU), sans salari√©.</p>
                </div>
                 <div class="term">
                    <h3 class="font-semibold text-sky-700">Nouvel Entrant</h3>
                    <p class="text-sm text-slate-600">Prestataire dans sa premi√®re ann√©e d'activit√© ou qui d√©bute une nouvelle cat√©gorie d'action (AF, BC, VAE, CFA). B√©n√©ficie de modalit√©s d'audit initial adapt√©es sur certains indicateurs.</p>
                </div>
                 <div class="term">
                    <h3 class="font-semibold text-sky-700">Petit OF (<10)</h3>
                    <p class="text-sm text-slate-600">Terme conventionnel d√©signant un Organisme de Formation (OF) de petite taille, g√©n√©ralement avec un effectif de moins de 10 salari√©s en √âquivalent Temps Plein (ETP).</p>
                </div>
                <div class="term">
                    <h3 class="font-semibold text-sky-700">PSH (Public en Situation de Handicap)</h3>
                    <p class="text-sm text-slate-600">D√©signe les personnes b√©n√©ficiant d'une Reconnaissance de la Qualit√© de Travailleur Handicap√© (RQTH) ou pr√©sentant des besoins d'adaptation sp√©cifiques li√©s √† un handicap.</p>
                </div>
                 <div class="term">
                    <h3 class="font-semibold text-sky-700">RNCP (R√©pertoire National des Certifications Professionnelles)</h3>
                    <p class="text-sm text-slate-600">Liste officielle des certifications √† finalit√© professionnelle reconnues par l'√âtat, class√©es par niveau de qualification.</p>
                </div>
                <div class="term">
                    <h3 class="font-semibold text-sky-700">VAE (Validation des Acquis de l'Exp√©rience)</h3>
                    <p class="text-sm text-slate-600">D√©marche qui permet de faire reconna√Ætre son exp√©rience professionnelle afin d'obtenir tout ou partie d'une certification (dipl√¥me, titre, etc.).</p>
                </div>
            </div>
        </div>
    </div>
    
    <button id="back-to-top-btn" class="hidden fixed bottom-8 right-8 bg-sky-600 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transform hover:scale-110">
        <span class="text-2xl">‚Üë</span>
    </button>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const db = [
        {
            criterionId: 1,
            criterionTitle: "Information du public",
            indicators: [
                { id: 1, title: "Information d√©taill√©e, v√©rifiable et accessible", analysis: "L'auditeur v√©rifie la pr√©sence des 9 items obligatoires sur au moins un support accessible avant contractualisation, et la coh√©rence entre tous les supports.", evidence: [ { text: "Page de formation d√©taill√©e sur le site web", tags: ['all'] }, { text: "Plaquette commerciale / Flyer par formation", tags: ['all'] }, { text: "Fiche programme d√©taill√©e (PDF t√©l√©chargeable)", tags: ['all'] }, { text: "Catalogue de formation (papier ou num√©rique)", tags: ['all'] }, { text: "Devis / Proposition commerciale claire et compl√®te", tags: ['all'] }, { text: "Conditions G√©n√©rales de Vente (CGV) √† jour", tags: ['all'] }, { text: "R√®glement int√©rieur de l'organisme", tags: ['all'] }, { text: "Page d√©di√©e √† la politique handicap sur le site", tags: ['psh'] }, { text: "Mention explicite du contact du R√©f√©rent Handicap", tags: ['psh'] }, { text: "Publication des 9 items sur le portail EDOF (pour CPF)", tags: ['cpf'] }, { text: "Mention explicite de l'absence de pr√©requis si applicable", tags: ['all'] }, { text: "Processus d'inscription et d√©lais moyens d'acc√®s clairement d√©crits", tags: ['all'] }, { text: "Tarifs ou m√©thode de calcul du prix (ex: taux horaire)", tags: ['all'] }, { text: "Fiche France Comp√©tences pour les formations certifiantes", tags: ['certif'] }, { text: "Modalit√©s d'√©valuation (formative, sommative) d√©crites", tags: ['all'] }, ] },
                { id: 2, title: "Indicateurs de r√©sultats", analysis: "L'auditeur cherche des donn√©es chiffr√©es, pertinentes et √† jour, diffus√©es publiquement. Pour les nouveaux entrants, la formalisation du choix des indicateurs suffit.", evidence: [ { text: "Page web 'Nos chiffres cl√©s' ou 'Nos r√©sultats'", tags: ['all'] }, { text: "Taux de satisfaction global des stagiaires (chiffr√©)", tags: ['all'] }, { text: "Taux d'abandon et analyse des causes (si pertinent)", tags: ['all'] }, { text: "Taux de r√©ussite aux √©valuations finales", tags: ['all'] }, { text: "Taux d'insertion dans l'emploi post-formation (pour formations m√©tiers)", tags: ['af', 'cfa'] }, { text: "Taux de poursuite d'√©tudes", tags: ['af', 'cfa'] }, { text: "Taux de rupture des contrats (pour CFA)", tags: ['cfa'] }, { text: "Taux de r√©alisation des entretiens de suivi √† 6 mois (pour BC)", tags: ['bc'] }, { text: "Tableau de bord de suivi des indicateurs (vierge pour 'nouveau')", tags: ['nouveau'] }, { text: "Publication des indicateurs obligatoires sur InserJeunes (pour CFA)", tags: ['cfa'] }, ] },
                { id: 3, title: "Informations sur les certifications (RNCP)", analysis: "Pour les formations RNCP, l'auditeur v√©rifie la communication sur le taux d'obtention, les blocs de comp√©tences, les passerelles et d√©bouch√©s, en se basant sur la fiche France Comp√©tences.", evidence: [ { text: "Taux d'obtention de la certification communiqu√© publiquement", tags: ['certif'] }, { text: "Description des blocs de comp√©tences validables sur la fiche programme", tags: ['certif'] }, { text: "Lien vers la fiche France Comp√©tences sur la page de la formation", tags: ['certif'] }, { text: "Information claire sur les √©quivalences et passerelles possibles", tags: ['certif'] }, { text: "Description des suites de parcours et des d√©bouch√©s m√©tiers", tags: ['certif'] }, ] }
            ]
        },
        {
            criterionId: 2,
            criterionTitle: "Identification des objectifs et adaptation",
            indicators: [
                { id: 4, title: "Analyse du besoin", analysis: "NC Majeure si manquement. L'auditeur veut la preuve d'un diagnostic r√©el et trac√©, men√© avant la contractualisation et liant b√©n√©ficiaire, entreprise et/ou financeur.", evidence: [ { text: "Grille d'analyse du besoin remplie et archiv√©e par b√©n√©ficiaire", tags: ['all'] }, { text: "Compte-rendu d'entretien de d√©couverte (t√©l√©phonique ou physique)", tags: ['all'] }, { text: "√âchanges de mails formalisant l'analyse du besoin avec le client", tags: ['all'] }, { text: "Section 'Analyse du besoin' dans la proposition commerciale personnalis√©e", tags: ['all'] }, { text: "Questionnaire de besoins en ligne (pr√©-inscription)", tags: ['all'] }, { text: "Analyse des besoins sp√©cifiques en compensation du handicap", tags: ['psh'] }, { text: "V√©rification de l'ad√©quation missions/r√©f√©rentiel (pour alternance)", tags: ['cfa', 'alternance'] }, { text: "CR d'√©change avec le financeur (ex: P√¥le Emploi) sur le projet du b√©n√©ficiaire", tags: ['all'] }, ] },
                { id: 5, title: "D√©finition des objectifs op√©rationnels et √©valuables", analysis: "NC Majeure si manquement. Les objectifs doivent d√©couler du besoin (Ind. 4) et √™tre formul√©s en termes de comp√©tences observables ('√™tre capable de...') pour √™tre √©valuables (Ind. 11).", evidence: [ { text: "Fiche programme listant les objectifs en verbes d'action", tags: ['all'] }, { text: "Convention de formation d√©taillant les objectifs vis√©s", tags: ['all'] }, { text: "R√©f√©rentiel de comp√©tences interne √† la formation", tags: ['grand_of'] }, { text: "Objectifs conformes au r√©f√©rentiel de la certification (pour RNCP/RS)", tags: ['certif'] }, { text: "Objectifs co-construits avec le b√©n√©ficiaire (pour BC)", tags: ['bc'] }, { text: "Tableau de correspondance Objectifs P√©dagogiques / Comp√©tences du r√©f√©rentiel", tags: ['certif', 'grand_of'] }, ] },
                { id: 6, title: "√âtablissement des contenus et modalit√©s", analysis: "NC Majeure si manquement. L'auditeur veut voir un parcours p√©dagogique coh√©rent qui aligne contenus, modalit√©s et objectifs. La justification des choix p√©dagogiques est cl√©.", evidence: [ { text: "D√©roul√© / Sc√©nario p√©dagogique d√©taill√© par s√©quence", tags: ['all'] }, { text: "Supports de cours (diaporamas, manuels, etc.)", tags: ['presentiel', 'distanciel'] }, { text: "Vid√©os, modules e-learning, quiz interactifs (pour FOAD)", tags: ['distanciel'] }, { text: "Tableau de correspondance Contenus / Objectifs / √âvaluations", tags: ['grand_of'] }, { text: "Guide de l'apprenant pour les parcours √† distance", tags: ['distanciel'] }, { text: "Modalit√©s p√©dagogiques adapt√©es pour PSH (supports en FALC, etc.)", tags: ['psh'] }, ] },
                { id: 7, title: "Ad√©quation contenus/exigences de la certification (RNCP)", analysis: "NC Majeure si manquement. Sp√©cifique AF/CFA pour RNCP. Le tableau crois√© est la preuve reine d√©montrant que 100% du r√©f√©rentiel est couvert.", evidence: [ { text: "Tableau de correspondance (crois√©) R√©f√©rentiel certificateur / Contenus de formation / Modalit√©s d'√©valuation", tags: ['certif', 'af', 'cfa'] }, { text: "Convention de partenariat ou habilitation de l'organisme certificateur", tags: ['certif', 'af', 'cfa'] }, ] },
                { id: 8, title: "Positionnement √† l'entr√©e", analysis: "Sp√©cifique AF/CFA. L'auditeur v√©rifie l'existence et l'application d'une proc√©dure pour √©valuer le niveau de d√©part et adapter le parcours si besoin.", evidence: [ { text: "Proc√©dure formalis√©e de positionnement", tags: ['af', 'cfa'] }, { text: "Test de connaissances / QCM en ligne ou papier", tags: ['af', 'cfa'] }, { text: "Grille d'entretien de positionnement", tags: ['af', 'cfa'] }, { text: "Outil d'auto-positionnement (grille √† remplir par le b√©n√©ficiaire)", tags: ['af', 'cfa'] }, { text: "Mise en situation ou √©tude de cas √† l'entr√©e", tags: ['af', 'cfa'] }, { text: "R√©sultats des tests archiv√©s dans les dossiers des b√©n√©ficiaires", tags: ['af', 'cfa'] }, { text: "Preuve de l'adaptation du parcours suite au positionnement (ex: module de remise √† niveau)", tags: ['af', 'cfa'] }, ] }
            ]
        },
        {
            criterionId: 3,
            criterionTitle: "Mise en ≈ìuvre des prestations",
            indicators: [
                { id: 9, title: "Conditions de d√©roulement de la prestation", analysis: "L'auditeur v√©rifie que les informations op√©rationnelles (r√®gles, contacts, d√©roul√©) sont bien communiqu√©es au b√©n√©ficiaire une fois qu'il est engag√© dans la prestation.", evidence: [ { text: "Livret d'accueil", tags: ['all'] }, { text: "R√®glement int√©rieur communiqu√© et √©marg√©", tags: ['all'] }, { text: "Convocation d√©taill√©e", tags: ['all'] }, { text: "Contacts des r√©f√©rents (p√©dagogique, administratif, handicap)", tags: ['all'] }, ] },
                { id: 10, title: "Adaptation de la prestation, du suivi et de l'accompagnement", analysis: "L'auditeur v√©rifie que la personnalisation n'est pas qu'un concept mais une r√©alit√©, avec des preuves d'adaptation du rythme, des contenus ou de l'accompagnement.", evidence: [ { text: "Dossier de suivi p√©dagogique individualis√©", tags: ['all'] }, { text: "Comptes-rendus d'entretiens de suivi", tags: ['all'] }, { text: "Exemples de contenus ou d'exercices adapt√©s", tags: ['all'] }, { text: "Plans individuels de compensation (pour PSH)", tags: ['psh'] }, ] },
                { id: 11, title: "√âvaluation de l'atteinte des objectifs", analysis: "NC Majeure si manquement. L'auditeur v√©rifie l'existence d'un processus d'√©valuation des acquis (et non de la satisfaction), coh√©rent avec les objectifs (Ind. 5), et dont les r√©sultats sont trac√©s.", evidence: [ { text: "Grilles d'√©valuation formative (en cours de parcours)", tags: ['all'] }, { text: "√âvaluation sommative finale (QCM, √©tude de cas, projet)", tags: ['all'] }, { text: "Productions des apprenants, corrig√©es et comment√©es", tags: ['all'] }, { text: "Proc√®s-verbal de jury ou de d√©lib√©ration", tags: ['certif'] }, { text: "Livret de comp√©tences ou portefeuille de preuves", tags: ['all'] }, { text: "Attestation de fin de formation mentionnant l'atteinte des objectifs", tags: ['all'] }, ] },
                { id: 12, title: "Pr√©vention des ruptures de parcours", analysis: "L'organisme doit prouver une d√©marche proactive pour maintenir l'engagement et pr√©venir les abandons, via des outils et des proc√©dures de relance.", evidence: [ { text: "Proc√©dure de gestion des absences et des abandons", tags: ['all'] }, { text: "Outils p√©dagogiques favorisant l'interactivit√©", tags: ['all'] }, { text: "Listing de relances (mails, appels)", tags: ['all'] }, { text: "Entretiens de rem√©diation trac√©s", tags: ['all'] }, ] },
                { id: 13, title: "Coordination pour les formations en alternance", analysis: "L'auditeur cherche la preuve d'un dialogue structur√© entre le centre, l'entreprise et l'apprenant, via un outil de liaison.", evidence: [ { text: "Livret d'apprentissage / Carnet de suivi (rempli et sign√©)", tags: ['alternance', 'cfa'] }, { text: "Comptes-rendus de visites en entreprise", tags: ['alternance', 'cfa'] }, { text: "Preuves d'√©changes avec le tuteur/ma√Ætre d'apprentissage", tags: ['alternance', 'cfa'] }, ] },
                { id: 14, title: "Accompagnement √† l'exercice de la citoyennet√©", analysis: "Sp√©cifique aux CFA. L'auditeur attend des actions concr√®tes et planifi√©es qui touchent au d√©veloppement personnel, √† la culture, √† la sant√©, √† la citoyennet√©.", evidence: [ { text: "Programme d'ateliers th√©matiques (la√Øcit√©, mixit√©, etc.)", tags: ['cfa'] }, { text: "Supports d'information sur les aides financi√®res", tags: ['cfa'] }, { text: "Photos ou CR d'√©v√©nements culturels ou sportifs", tags: ['cfa'] }, ] },
                { id: 15, title: "Droits et devoirs des apprentis", analysis: "Sp√©cifique aux CFA. Il faut prouver que l'apprenti est bien inform√© de son double statut (apprenant/salari√©) et des r√®gles associ√©es.", evidence: [ { text: "Section d√©di√©e dans le livret d'accueil", tags: ['cfa'] }, { text: "Compte-rendu √©marg√© de la r√©union d'information de rentr√©e", tags: ['cfa'] }, { text: "Supports de pr√©sentation sur le droit du travail et la sant√©/s√©curit√©", tags: ['cfa'] }, ] },
                { id: 16, title: "Pr√©sentation √† la certification", analysis: "L'organisme doit prouver qu'il conna√Æt et applique scrupuleusement les r√®gles de l'examen fix√©es par l'autorit√© de certification.", evidence: [ { text: "Document de r√©f√©rence du certificateur (modalit√©s d'√©valuation)", tags: ['certif'] }, { text: "Preuves d'inscription des candidats √† l'examen", tags: ['certif'] }, { text: "Convocation des candidats mentionnant les r√®gles", tags: ['certif'] }, { text: "Preuves d'am√©nagement des examens pour les PSH", tags: ['certif', 'psh'] }, ] }
            ]
        },
        {
            criterionId: 4,
            criterionTitle: "L'ad√©quation des moyens p√©dagogiques, techniques et d'encadrement",
            indicators: [
                { id: 17, title: "Mise √† disposition de moyens humains et techniques adapt√©s", analysis: "L'auditeur s'assure que les moyens (locaux, √©quipements, formateurs) sont coh√©rents avec la prestation vendue. Il ne s'agit pas d'exiger le luxe, mais l'ad√©quation et la s√©curit√©. Pour les formations √† distance, cela inclut la plateforme et l'assistance technique.", evidence: [ { text: "Bail de location ou titre de propri√©t√© des locaux", tags: ['presentiel'] }, { text: "Photos dat√©es des salles et plateaux techniques", tags: ['presentiel'] }, { text: "Liste des √©quipements et mat√©riels p√©dagogiques", tags: ['all'] }, { text: "Contrat de location ou mise √† disposition de mat√©riel/locaux", tags: ['presentiel'] }, { text: "Pr√©sentation de la plateforme LMS et de ses fonctionnalit√©s", tags: ['distanciel'] }, { text: "Proc√©dure et contacts de l'assistance technique (pour FOAD)", tags: ['distanciel'] }, { text: "Document Unique d'√âvaluation des Risques Professionnels (DUERP)", tags: ['all'] }, { text: "CV et contrats des formateurs et du personnel d'encadrement", tags: ['all'] }, { text: "Convention de formation pr√©cisant les moyens mis √† disposition (pour intra-entreprise)", tags: ['all'] }, { text: "Environnement garantissant la confidentialit√© des √©changes (pour BC)", tags: ['bc'] } ] },
                { id: 18, title: "Coordination des diff√©rents intervenants", analysis: "L'auditeur √©value la fluidit√© de l'organisation. 'Qui fait quoi ?' doit √™tre clair pour √©viter les 'silos' et garantir une exp√©rience sans couture pour le client, qu'il s'agisse d'intervenants internes ou externes.", evidence: [ { text: "Organigramme fonctionnel et nominatif", tags: ['all'] }, { text: "Fiches de poste ou descriptifs de fonction d√©taill√©s", tags: ['grand_of'] }, { text: "Comptes-rendus de r√©unions de coordination p√©dagogique ou administrative", tags: ['all'] }, { text: "Planning partag√© des interventions", tags: ['grand_of'] }, { text: "Proc√©dure de transmission des informations entre les services (commercial, administratif, p√©dagogique)", tags: ['grand_of'] }, { text: "√âchanges de mails ou captures d'√©cran d'outils collaboratifs (ex: Trello, Slack)", tags: ['all'] } ] },
                { id: 19, title: "Mise √† disposition et appropriation des ressources p√©dagogiques", analysis: "Au-del√† de la simple fourniture de supports, l'auditeur v√©rifie comment l'organisme aide l'apprenant √† utiliser les ressources (tutoriels, guides, activit√©s d√©di√©es). L'existence d'un processus de mise √† jour de ces ressources est un plus.", evidence: [ { text: "Supports de cours (PDF, diaporamas, etc.)", tags: ['all'] }, { text: "Acc√®s √† un centre de ressources en ligne ou une plateforme LMS", tags: ['distanciel', 'blended'] }, { text: "Bibliographie, webographie, liste d'outils", tags: ['all'] }, { text: "Guide d'utilisation des ressources ou de la plateforme", tags: ['distanciel'] }, { text: "Tutoriel vid√©o de prise en main des outils", tags: ['distanciel'] }, { text: "S√©quence d'accueil d√©di√©e √† la pr√©sentation des ressources", tags: ['all'] }, { text: "Preuves de l'actualisation des ressources (lien avec veille Ind. 25)", tags: ['all'] }, { text: "Supports adapt√©s pour les PSH", tags: ['psh'] } ] },
                { id: 20, title: "Personnel d√©di√© (mobilit√©, handicap, conseil de perfectionnement)", analysis: "Sp√©cifique aux CFA. L'auditeur attend des preuves formelles de nomination de ces trois fonctions cl√©s, mais aussi et surtout des preuves de leur activit√© r√©elle (comptes-rendus de r√©union, exemples d'actions men√©es).", evidence: [ { text: "Acte de nomination ou PV de r√©union nommant le r√©f√©rent handicap", tags: ['cfa'] }, { text: "Acte de nomination ou fiche de poste du r√©f√©rent mobilit√©", tags: ['cfa'] }, { text: "Statuts ou acte de cr√©ation du conseil de perfectionnement", tags: ['cfa'] }, { text: "Liste des membres du conseil de perfectionnement", tags: ['cfa'] }, { text: "Comptes-rendus des r√©unions du conseil de perfectionnement", tags: ['cfa'] }, { text: "Exemples d'actions men√©es par le r√©f√©rent handicap ou mobilit√©", tags: ['cfa'] } ] }
            ]
        },
        {
            criterionId: 5,
            criterionTitle: "Qualification et d√©veloppement des comp√©tences des personnels",
            indicators: [
                { id: 21, title: "√âvaluation des comp√©tences des intervenants", analysis: "NC Majeure si manquement. Le CV ne suffit pas. L'organisme doit prouver qu'il √©value activement les comp√©tences de ses intervenants (internes et externes) par un processus structur√© (grilles, entretiens) avant et pendant leur collaboration.", evidence: [ { text: "Processus de recrutement et de s√©lection des intervenants", tags: ['all'] }, { text: "Fiches de poste pr√©cisant les comp√©tences requises", tags: ['grand_of'] }, { text: "Dossiers des intervenants (CV, dipl√¥mes, certifications)", tags: ['all'] }, { text: "Grilles d'√©valuation remplies lors des recrutements", tags: ['all'] }, { text: "Comptes-rendus d'entretiens annuels ou professionnels", tags: ['grand_of'] }, { text: "Grilles d'observation en salle ou √† distance", tags: ['all'] }, { text: "Analyse des retours des b√©n√©ficiaires sur la qualit√© des intervenants", tags: ['all'] }, { text: "Preuves de la sensibilisation des personnels √† l'accueil des PSH", tags: ['psh'] }, { text: "Preuve de la formation des accompagnateurs √† la m√©thodologie VAE", tags: ['vae'] } ] },
                { id: 22, title: "D√©veloppement des comp√©tences des salari√©s", analysis: "NC Majeure si manquement. L'auditeur veut voir une politique active de formation continue pour tout le personnel (pas seulement les formateurs). L'ind√©pendant doit prouver qu'il se forme lui-m√™me. La d√©marche doit √™tre planifi√©e et trac√©e.", evidence: [ { text: "Plan de d√©veloppement des comp√©tences formalis√©", tags: ['grand_of', 'petit_of'] }, { text: "Comptes-rendus des entretiens professionnels mentionnant les besoins en formation", tags: ['grand_of', 'petit_of'] }, { text: "Attestations de formation suivies par le personnel", tags: ['all'] }, { text: "Preuves de participation √† des colloques, conf√©rences, webinaires", tags: ['all'] }, { text: "Preuves de participation √† des groupes d'analyse de pratiques", tags: ['all'] }, { text: "Pour un ind√©pendant : son propre plan de formation et les preuves associ√©es", tags: ['independant'] }, { text: "Pour un nouvel entrant : la formalisation du processus d'entretien et de plan de formation", tags: ['nouveau'] } ] }
            ]
        },
        {
            criterionId: 6,
            criterionTitle: "Environnement professionnel",
            indicators: [
                { id: 23, title: "Veille l√©gale et r√©glementaire", analysis: "La simple collecte ne suffit pas. L'auditeur veut la preuve de l'EXPLOITATION de la veille : comment une information a-t-elle conduit √† une action concr√®te ?", evidence: [ { text: "Tableau de suivi de la veille (source, date, info, action)", tags: ['all'] }, { text: "Abonnement √† des newsletters sp√©cialis√©es (ex: Centre Inffo)", tags: ['all'] }, { text: "Compte-rendu de r√©union d'√©quipe pr√©sentant une √©volution l√©gale", tags: ['grand_of'] }, { text: "Exemple de mise √† jour des CGV suite √† une nouvelle loi (avec dates)", tags: ['all'] }, ] },
                { id: 24, title: "Veille sur les √©volutions des comp√©tences, des m√©tiers et des emplois", analysis: "L'organisme doit prouver qu'il analyse les √©volutions du march√© du travail pour adapter ses formations et garantir leur pertinence.", evidence: [ { text: "Tableau de suivi de la veille m√©tier", tags: ['all'] }, { text: "Participation √† des conf√©rences de branche", tags: ['all'] }, { text: "Mise √† jour d'un programme suite √† une √©volution m√©tier", tags: ['all'] }, ] },
                { id: 25, title: "Veille sur les innovations p√©dagogiques et technologiques", analysis: "L'organisme doit d√©montrer sa curiosit√© et sa capacit√© √† faire √©voluer ses m√©thodes et outils p√©dagogiques.", evidence: [ { text: "Tableau de suivi de la veille p√©dagogique", tags: ['all'] }, { text: "Exp√©rimentation d'un nouvel outil ou d'une nouvelle m√©thode", tags: ['all'] }, { text: "Abonnements √† des revues ou blogs sp√©cialis√©s", tags: ['all'] }, ] },
                { id: 26, title: "Accueil des publics en situation de handicap", analysis: "NC Majeure si manquement. L'organisme doit avoir un r√©seau de partenaires sp√©cialis√©s mobilisable, AVANT m√™me d'accueillir un PSH. Le r√©f√©rent handicap doit √™tre identifi√© et ses contacts diffus√©s.", evidence: [ { text: "Liste de partenaires (Agefiph, Cap Emploi, MDPH, associations) avec contacts", tags: ['psh'] }, { text: "Preuves de contacts r√©guliers avec ce r√©seau (mails, CR de r√©union)", tags: ['psh'] }, { text: "Proc√©dure interne d'accueil et d'orientation des PSH", tags: ['psh'] }, { text: "Preuve de la formation ou de la mont√©e en comp√©tence du r√©f√©rent handicap", tags: ['psh'] }, ] },
                { id: 27, title: "Ma√Ætrise de la sous-traitance", analysis: "NC Majeure si manquement. Le donneur d'ordres est responsable. Il doit prouver un processus de s√©lection, de contractualisation et de contr√¥le du sous-traitant.", evidence: [ { text: "Proc√©dure de s√©lection et d'√©valuation des sous-traitants", tags: ['soustraitance'] }, { text: "Contrat de sous-traitance d√©taill√© et sign√©", tags: ['soustraitance'] }, { text: "Grille d'√©valuation remplie pour un sous-traitant", tags: ['soustraitance'] }, { text: "Preuves de contr√¥le de la prestation (observation, analyse des retours)", tags: ['soustraitance'] }, { text: "V√©rification de la certification Qualiopi du sous-traitant (pour CPF)", tags: ['soustraitance', 'cpf'] }, ] },
                { id: 28, title: "Partenariats pour la formation en situation de travail", analysis: "L'organisme doit prouver qu'il s'appuie sur un r√©seau d'entreprises partenaires pour concevoir et mettre en ≈ìuvre les p√©riodes de formation pratique (alternance, stages, AFEST).", evidence: [ { text: "Liste des entreprises partenaires", tags: ['alternance', 'cfa'] }, { text: "Conventions de partenariat", tags: ['alternance', 'cfa'] }, { text: "Comptes-rendus de r√©unions avec les partenaires", tags: ['alternance', 'cfa'] }, ] },
                { id: 29, title: "Aide √† l'insertion professionnelle", analysis: "Sp√©cifique aux CFA. L'organisme doit prouver qu'il accompagne activement ses apprentis vers l'emploi ou la poursuite d'√©tudes √† l'issue de leur parcours.", evidence: [ { text: "Organisation d'ateliers CV / pr√©paration aux entretiens", tags: ['cfa'] }, { text: "Mise en place d'un r√©seau d'anciens √©l√®ves", tags: ['cfa'] }, { text: "Diffusion d'offres d'emploi", tags: ['cfa'] }, ] }
            ]
        },
        {
            criterionId: 7,
            criterionTitle: "Am√©lioration continue",
            indicators: [
                 { id: 30, title: "Recueil des appr√©ciations des parties prenantes", analysis: "L'auditeur v√©rifie la collecte aupr√®s des 4 types de parties prenantes : b√©n√©ficiaires, financeurs, entreprises, √©quipes p√©dagogiques.", evidence: [ { text: "Questionnaires de satisfaction √† chaud et √† froid (b√©n√©ficiaires)", tags: ['all'] }, { text: "Comptes-rendus d'entretiens de bilan (b√©n√©ficiaires)", tags: ['all'] }, { text: "Enqu√™tes de satisfaction d√©di√©es (entreprises/financeurs)", tags: ['grand_of'] }, { text: "Comptes-rendus de r√©unions de bilan p√©dagogique (√©quipes)", tags: ['all'] }, { text: "Preuves de sollicitation des financeurs pour leur appr√©ciation", tags: ['all'] }, ] },
                { id: 31, title: "Traitement des r√©clamations et al√©as", analysis: "NC Majeure si manquement. Avoir une proc√©dure ne suffit pas, il faut un registre qui trace chaque r√©clamation (m√™me s'il est vide) et des preuves de traitement si des cas se sont pr√©sent√©s.", evidence: [ { text: "Proc√©dure formalis√©e de traitement des r√©clamations", tags: ['all'] }, { text: "Registre / Tableau de suivi des r√©clamations, difficult√©s et al√©as", tags: ['all'] }, { text: "Preuves de traitement d'une r√©clamation (mail initial, accus√© de r√©ception, analyse, r√©ponse finale)", tags: ['all'] }, ] },
                { id: 32, title: "Mise en ≈ìuvre de l'am√©lioration continue", analysis: "NC Majeure si manquement. C'est la synth√®se du crit√®re 7. L'auditeur veut voir la boucle : une analyse des donn√©es (Ind. 30 & 31) qui conduit √† un plan d'actions concr√®tes et suivies.", evidence: [ { text: "Plan d'am√©lioration continue formalis√©", tags: ['all'] }, { text: "Tableau de suivi des actions correctives et pr√©ventives", tags: ['all'] }, { text: "Comptes-rendus de revues qualit√© ou de comit√©s de pilotage", tags: ['grand_of'] }, { text: "Exemple concret : 'Suite aux retours de satisfaction sur le module X (analyse), nous avons mis √† jour le support Y (action) le JJ/MM/AA (tra√ßabilit√©)'", tags: ['all'] }, ] }
            ]
        }
    ];

    const indicatorApplicability = {
        1: ['af', 'bc', 'vae', 'cfa'], 2: ['af', 'bc', 'vae', 'cfa'], 3: ['af', 'vae', 'cfa', 'certif'],
        4: ['af', 'bc', 'vae', 'cfa'], 5: ['af', 'bc', 'vae', 'cfa'], 6: ['af', 'bc', 'vae', 'cfa'],
        7: ['af', 'cfa', 'certif'], 8: ['af', 'cfa'], 9: ['af', 'bc', 'vae', 'cfa'], 10: ['af', 'bc', 'vae', 'cfa'],
        11: ['af', 'bc', 'vae', 'cfa'], 12: ['af', 'bc', 'vae', 'cfa'], 13: ['af', 'cfa', 'alternance'], 14: ['cfa'],
        15: ['cfa'], 16: ['af', 'vae', 'cfa', 'certif'], 17: ['af', 'bc', 'vae', 'cfa'], 18: ['af', 'bc', 'vae', 'cfa'],
        19: ['af', 'bc', 'vae', 'cfa'], 20: ['cfa'], 21: ['af', 'bc', 'vae', 'cfa'], 22: ['af', 'bc', 'vae', 'cfa'],
        23: ['af', 'bc', 'vae', 'cfa'], 24: ['af', 'bc', 'vae', 'cfa'], 25: ['af', 'bc', 'vae', 'cfa'],
        26: ['af', 'bc', 'vae', 'cfa'], 27: ['af', 'bc', 'vae', 'cfa'], 28: ['af', 'cfa', 'alternance'], 29: ['cfa'],
        30: ['af', 'bc', 'vae', 'cfa'], 31: ['af', 'bc', 'vae', 'cfa'], 32: ['af', 'bc', 'vae', 'cfa']
    };

    const filters = {
        typology: [
            { id: 'af', label: 'Actions de Formation' },
            { id: 'bc', label: 'Bilans de Comp√©tences' },
            { id: 'vae', label: 'VAE' },
            { id: 'cfa', label: 'Apprentissage (CFA)' }
        ],
        modality: [
            { id: 'presentiel', label: 'Pr√©sentiel' },
            { id: 'distanciel', label: 'Distanciel (FOAD)' },
            { id: 'blended', label: 'Blended Learning' }
        ],
        size: [
            { id: 'independant', label: 'Ind√©pendant' },
            { id: 'petit_of', label: 'Petit OF (<10)' },
            { id: 'grand_of', label: 'Grand OF (>10)' }
        ],
        context: [
            { id: 'certif', label: 'Formations Certifiantes' },
            { id: 'psh', label: 'Accueil PSH' },
            { id: 'soustraitance', label: 'Sous-traitance' },
            { id: 'cpf', label: 'Financement CPF' },
            { id: 'nouveau', label: 'Nouvel Entrant' },
            { id: 'alternance', label: 'Alternance / AFEST' }
        ]
    };
    
    let indicatorChart;
    let indicatorStates = {};

    // --- New Data for Toolkit and Quiz ---
    const toolkitContent = {
        checklist: {
            title: "Check-list des Preuves",
            content: `
                <p class="mb-4 text-slate-600">Explorez les exemples de preuves pour chaque crit√®re. Cliquez sur un crit√®re pour d√©plier la liste des indicateurs correspondants.</p>
                <div class="space-y-2" id="checklist-accordion">
                    <!-- Crit√®re 1 -->
                    <div>
                        <button class="toolkit-accordion-header w-full flex justify-between items-center p-4 bg-slate-100 hover:bg-slate-200 rounded-lg text-left font-semibold">
                            <span>Crit√®re 1 : Information du public</span>
                            <span class="toolkit-accordion-icon transform">&#9654;</span>
                        </button>
                        <div class="toolkit-accordion-content">
                            <ul class="list-disc pl-5 space-y-2 py-4 px-6 bg-white border border-t-0 rounded-b-lg">
                                <li><strong>Ind. 1:</strong> Site web, plaquettes, fiches programmes, CGV, r√®glement int√©rieur, accessibilit√©.</li>
                                <li><strong>Ind. 2:</strong> Tableaux de bord de r√©sultats (satisfaction, insertion, etc.), publication sur le site.</li>
                                <li><strong>Ind. 3:</strong> Communication sur les taux d'obtention, comparaison programme/r√©f√©rentiel.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Crit√®re 2 -->
                    <div>
                        <button class="toolkit-accordion-header w-full flex justify-between items-center p-4 bg-slate-100 hover:bg-slate-200 rounded-lg text-left font-semibold">
                            <span>Crit√®re 2 : Identification des objectifs et adaptation</span>
                            <span class="toolkit-accordion-icon transform">&#9654;</span>
                        </button>
                        <div class="toolkit-accordion-content">
                            <ul class="list-disc pl-5 space-y-2 py-4 px-6 bg-white border border-t-0 rounded-b-lg">
                                <li><strong>Ind. 4:</strong> Grilles d'analyse de besoins, CR d'entretiens.</li>
                                <li><strong>Ind. 5:</strong> Programmes avec objectifs op√©rationnels et √©valuables.</li>
                                <li><strong>Ind. 6:</strong> D√©roul√©s p√©dagogiques, description des m√©thodes.</li>
                                <li><strong>Ind. 7:</strong> Tableau de correspondance contenus/comp√©tences du r√©f√©rentiel.</li>
                                <li><strong>Ind. 8:</strong> Tests de positionnement, grilles d'auto-√©valuation √† l'entr√©e.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Crit√®re 3 -->
                    <div>
                        <button class="toolkit-accordion-header w-full flex justify-between items-center p-4 bg-slate-100 hover:bg-slate-200 rounded-lg text-left font-semibold">
                            <span>Crit√®re 3 : Accueil, accompagnement, suivi et √©valuation</span>
                            <span class="toolkit-accordion-icon transform">&#9654;</span>
                        </button>
                        <div class="toolkit-accordion-content">
                            <ul class="list-disc pl-5 space-y-2 py-4 px-6 bg-white border border-t-0 rounded-b-lg">
                                <li><strong>Ind. 9:</strong> Livret d'accueil, convocation, contacts des r√©f√©rents.</li>
                                <li><strong>Ind. 10:</strong> Proc√©dure d'adaptation, plans individuels de compensation.</li>
                                <li><strong>Ind. 11:</strong> Grilles d'√©valuation (formative, sommative), √©tudes de cas, QCM.</li>
                                <li><strong>Ind. 12:</strong> Proc√©dure de suivi des absences/abandons, relances.</li>
                                <li><strong>Ind. 13:</strong> Livret de suivi alternant, CR de visites en entreprise.</li>
                                <li><strong>Ind. 14:</strong> Programme d'actions citoyennes, charte de la la√Øcit√©.</li>
                                <li><strong>Ind. 15:</strong> Supports d'info sur les droits/devoirs, sant√©/s√©curit√©.</li>
                                <li><strong>Ind. 16:</strong> Proc√©dure d'inscription √† l'examen, convocations.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Crit√®re 4 -->
                    <div>
                        <button class="toolkit-accordion-header w-full flex justify-between items-center p-4 bg-slate-100 hover:bg-slate-200 rounded-lg text-left font-semibold">
                            <span>Crit√®re 4 : Ad√©quation des moyens</span>
                            <span class="toolkit-accordion-icon transform">&#9654;</span>
                        </button>
                        <div class="toolkit-accordion-content">
                            <ul class="list-disc pl-5 space-y-2 py-4 px-6 bg-white border border-t-0 rounded-b-lg">
                                <li><strong>Ind. 17:</strong> Liste des √©quipements, CV des formateurs, baux des locaux.</li>
                                <li><strong>Ind. 18:</strong> Organigramme, fiches de poste, CR de r√©unions p√©dagogiques.</li>
                                <li><strong>Ind. 19:</strong> Catalogue de ressources, supports de cours, acc√®s plateforme.</li>
                                <li><strong>Ind. 20:</strong> Actes de nomination des r√©f√©rents, PV du conseil de perfectionnement.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Crit√®re 5 -->
                    <div>
                        <button class="toolkit-accordion-header w-full flex justify-between items-center p-4 bg-slate-100 hover:bg-slate-200 rounded-lg text-left font-semibold">
                            <span>Crit√®re 5 : Qualification des personnels</span>
                            <span class="toolkit-accordion-icon transform">&#9654;</span>
                        </button>
                        <div class="toolkit-accordion-content">
                            <ul class="list-disc pl-5 space-y-2 py-4 px-6 bg-white border border-t-0 rounded-b-lg">
                                <li><strong>Ind. 21:</strong> Grilles d'√©valuation des comp√©tences, CV, dipl√¥mes, CR d'entretiens.</li>
                                <li><strong>Ind. 22:</strong> Plan de d√©veloppement des comp√©tences, attestations de formation.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Crit√®re 6 -->
                    <div>
                        <button class="toolkit-accordion-header w-full flex justify-between items-center p-4 bg-slate-100 hover:bg-slate-200 rounded-lg text-left font-semibold">
                            <span>Crit√®re 6 : Inscription dans l'environnement professionnel</span>
                            <span class="toolkit-accordion-icon transform">&#9654;</span>
                        </button>
                        <div class="toolkit-accordion-content">
                            <ul class="list-disc pl-5 space-y-2 py-4 px-6 bg-white border border-t-0 rounded-b-lg">
                                <li><strong>Ind. 23:</strong> Proc√©dure et tableau de suivi de la veille l√©gale.</li>
                                <li><strong>Ind. 24:</strong> Proc√©dure et tableau de suivi de la veille m√©tiers.</li>
                                <li><strong>Ind. 25:</strong> Proc√©dure et tableau de suivi de la veille p√©dagogique.</li>
                                <li><strong>Ind. 26:</strong> Liste des partenaires handicap, proc√©dure d'accueil.</li>
                                <li><strong>Ind. 27:</strong> Contrat de sous-traitance, proc√©dure de s√©lection/contr√¥le.</li>
                                <li><strong>Ind. 28:</strong> Convention AFEST, livret de suivi, grille d'√©valuation.</li>
                                <li><strong>Ind. 29:</strong> Programme d'actions d'insertion, partenariats entreprises.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Crit√®re 7 -->
                    <div>
                        <button class="toolkit-accordion-header w-full flex justify-between items-center p-4 bg-slate-100 hover:bg-slate-200 rounded-lg text-left font-semibold">
                            <span>Crit√®re 7 : Am√©lioration continue</span>
                            <span class="toolkit-accordion-icon transform">&#9654;</span>
                        </button>
                        <div class="toolkit-accordion-content">
                            <ul class="list-disc pl-5 space-y-2 py-4 px-6 bg-white border border-t-0 rounded-b-lg">
                                <li><strong>Ind. 30:</strong> Mod√®les de questionnaires (√† chaud, √† froid), CR d'entretiens.</li>
                                <li><strong>Ind. 31:</strong> Proc√©dure et tableau de suivi des r√©clamations.</li>
                                <li><strong>Ind. 32:</strong> Plan d'am√©lioration continue, tableau de suivi des actions.</li>
                            </ul>
                        </div>
                    </div>

                </div>`
        },
        pitfalls: {
            title: "Pi√®ges √† √âviter",
            content: `
                <p class="mb-6 text-slate-600">Anticipez les non-conformit√©s les plus fr√©quentes pour s√©curiser votre audit. Cette section est essentielle pour une pr√©paration sereine.</p>
                <div class="space-y-6">
                    <div>
                        <h4 class="text-lg font-semibold text-slate-800 mb-2">1. Pr√©paration et Documentation</h4>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="p-4 border-l-4 border-amber-500 bg-amber-50 rounded-r-lg">
                                <h5 class="font-semibold">Pr√©paration de derni√®re minute</h5>
                                <p class="text-sm text-slate-600">Attendre la veille de l'audit pour rassembler les documents conduit √† des oublis, des incoh√©rences et un stress inutile.</p>
                            </div>
                            <div class="p-4 border-l-4 border-amber-500 bg-amber-50 rounded-r-lg">
                                <h5 class="font-semibold">Mod√®les non personnalis√©s</h5>
                                <p class="text-sm text-slate-600">Utiliser des mod√®les standards sans les adapter √† votre activit√© et votre logique interne est facilement d√©tectable.</p>
                            </div>
                            <div class="p-4 border-l-4 border-amber-500 bg-amber-50 rounded-r-lg">
                                <h5 class="font-semibold">Documentation mal organis√©e</h5>
                                <p class="text-sm text-slate-600">Une arborescence de fichiers confuse fait perdre du temps √† l'auditeur et donne une impression de manque de rigueur.</p>
                            </div>
                             <div class="p-4 border-l-4 border-amber-500 bg-amber-50 rounded-r-lg">
                                <h5 class="font-semibold">Absence de proc√©dures formalis√©es</h5>
                                <p class="text-sm text-slate-600">Les processus cl√©s (accueil, r√©clamations, etc.) doivent √™tre √©crits, dat√©s et versionn√©s. L'oral ne suffit pas.</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-800 mb-2">2. Processus et Suivi</h4>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="p-4 border-l-4 border-red-500 bg-red-50 rounded-r-lg">
                                <h5 class="font-semibold">Suivi et √©valuation des acquis insuffisants</h5>
                                <p class="text-sm text-slate-600">L'√©valuation doit √™tre tra√ßable et couvrir tout le parcours (avant, pendant, apr√®s). Une simple √©valuation finale est une NC majeure.</p>
                            </div>
                             <div class="p-4 border-l-4 border-red-500 bg-red-50 rounded-r-lg">
                                <h5 class="font-semibold">Manque de transparence envers les stagiaires</h5>
                                <p class="text-sm text-slate-600">Les informations communiqu√©es (objectifs, pr√©requis, etc.) doivent √™tre compl√®tes et prouvables (fiches programmes, site web).</p>
                            </div>
                            <div class="p-4 border-l-4 border-red-500 bg-red-50 rounded-r-lg">
                                <h5 class="font-semibold">Gestion des comp√©tences du personnel n√©glig√©e</h5>
                                <p class="text-sm text-slate-600">Les CV ne suffisent pas. Il faut des preuves d'√©valuation et de maintien des comp√©tences du personnel (entretiens, plan de formation).</p>
                            </div>
                            <div class="p-4 border-l-4 border-red-500 bg-red-50 rounded-r-lg">
                                <h5 class="font-semibold">Adaptation au handicap non d√©montr√©e</h5>
                                <p class="text-sm text-slate-600">Il faut un r√©f√©rent handicap form√© et des preuves de partenariats ou de solutions mobilisables (pas seulement une intention).</p>
                            </div>
                        </div>
                    </div>
                    <div>
                         <h4 class="text-lg font-semibold text-slate-800 mb-2">3. Pilotage et Am√©lioration Continue</h4>
                        <div class="grid md:grid-cols-2 gap-4">
                           <div class="p-4 border-l-4 border-purple-500 bg-purple-50 rounded-r-lg">
                                <h5 class="font-semibold">Veille non exploit√©e</h5>
                                <p class="text-sm text-slate-600">Il faut prouver que la veille (l√©gale, m√©tier, p√©dagogique) a un impact concret sur vos pratiques et vos contenus.</p>
                            </div>
                            <div class="p-4 border-l-4 border-purple-500 bg-purple-50 rounded-r-lg">
                                <h5 class="font-semibold">Am√©lioration continue non prouv√©e</h5>
                                <p class="text-sm text-slate-600">Collecter la satisfaction ne suffit pas. L'auditeur veut voir l'analyse des donn√©es et le plan d'action qui en d√©coule.</p>
                            </div>
                             <div class="p-4 border-l-4 border-purple-500 bg-purple-50 rounded-r-lg">
                                <h5 class="font-semibold">Oublier l'audit de surveillance</h5>
                                <p class="text-sm text-slate-600">L'audit de surveillance n'est pas une formalit√©. Les NC mineures non corrig√©es y deviennent majeures et bloquantes.</p>
                            </div>
                            <div class="p-4 border-l-4 border-purple-500 bg-purple-50 rounded-r-lg">
                                <h5 class="font-semibold">Mauvaise utilisation de la marque Qualiopi</h5>
                                <p class="text-sm text-slate-600">Le logo ne doit jamais figurer sur un support de formation (programme, attestation), mais sur des supports institutionnels.</p>
                            </div>
                        </div>
                    </div>
                </div>
                `
        },
        cycle: {
            title: "Le Cycle d'Audit",
            content: `
                <p class="mb-6 text-slate-600">La certification Qualiopi est un cycle de 3 ans, jalonn√© par 3 audits cl√©s.</p>
                <div class="flex flex-col md:flex-row justify-between space-y-6 md:space-y-0 md:space-x-4">
                    <div class="flex-1 text-center p-4 border rounded-lg kpi-card">
                        <div class="text-2xl font-bold text-sky-600">1</div>
                        <h4 class="font-semibold mt-2">Audit Initial</h4>
                        <p class="text-sm text-slate-500 mt-1">V√©rifie la conception et la formalisation du syst√®me. Peut √™tre r√©alis√© √† distance (sous conditions).</p>
                    </div>
                    <div class="flex items-center justify-center text-slate-400 text-2xl font-mono hidden md:flex">&rarr;</div>
                    <div class="flex-1 text-center p-4 border rounded-lg kpi-card">
                         <div class="text-2xl font-bold text-sky-600">2</div>
                        <h4 class="font-semibold mt-2">Audit de Surveillance</h4>
                        <p class="text-sm text-slate-500 mt-1">Entre le 14e et 22e mois. V√©rifie le maintien et l'am√©lioration du syst√®me. Obligatoirement sur site si l'initial √©tait √† distance.</p>
                    </div>
                     <div class="flex items-center justify-center text-slate-400 text-2xl font-mono hidden md:flex">&rarr;</div>
                    <div class="flex-1 text-center p-4 border rounded-lg kpi-card">
                         <div class="text-2xl font-bold text-sky-600">3</div>
                        <h4 class="font-semibold mt-2">Audit de Renouvellement</h4>
                        <p class="text-sm text-slate-500 mt-1">Avant la fin de la 3e ann√©e. Remet en jeu la certification. Audit complet et obligatoirement sur site.</p>
                    </div>
                </div>`
        },
        pdca: {
            title: "La D√©marche PDCA",
            content: `
                <p class="mb-6 text-slate-600">Le r√©f√©rentiel est structur√© autour de la roue de Deming, un cycle d'am√©lioration continue.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-blue-100 rounded-lg">
                        <h4 class="font-semibold text-blue-800">PLAN (Planifier)</h4>
                        <p class="text-sm text-blue-700">Concevoir la prestation : analyse des besoins, d√©finition des objectifs, communication (Crit√®res 1, 2, 6).</p>
                    </div>
                    <div class="p-4 bg-green-100 rounded-lg">
                        <h4 class="font-semibold text-green-800">DO (Faire)</h4>
                        <p class="text-sm text-green-700">R√©aliser la prestation : mobiliser les moyens, adapter l'accompagnement (Crit√®res 3, 4, 5).</p>
                    </div>
                    <div class="p-4 bg-yellow-100 rounded-lg">
                        <h4 class="font-semibold text-yellow-800">CHECK (V√©rifier)</h4>
                        <p class="text-sm text-yellow-700">√âvaluer et contr√¥ler : √©valuation des acquis, recueil des appr√©ciations et r√©clamations (Crit√®res 3, 7).</p>
                    </div>
                    <div class="p-4 bg-purple-100 rounded-lg">
                        <h4 class="font-semibold text-purple-800">ACT (Agir)</h4>
                        <p class="text-sm text-purple-700">Am√©liorer : analyser les donn√©es collect√©es et mettre en ≈ìuvre des actions correctives (Crit√®re 7).</p>
                    </div>
                </div>`
        }
    };

    const quizQuestions = [
        {
            question: "Quelle est la cons√©quence directe de l'accumulation de 5 non-conformit√©s mineures lors d'un audit ?",
            options: [
                { text: "L'organisme doit passer un nouvel audit complet.", isCorrect: false, rationale: "La requalification en majeure impose un plan d'action rapide, mais pas un audit complet imm√©diat." },
                { text: "L'audit est simplement prolong√© d'une journ√©e.", isCorrect: false, rationale: "La dur√©e de l'audit n'est pas modifi√©e, mais la nature du r√©sultat et ses cons√©quences le sont." },
                { text: "Elles sont requalifi√©es en une non-conformit√© majeure.", isCorrect: true, rationale: "C'est la r√®gle pr√©cise du r√©f√©rentiel : 5 NC mineures = 1 NC majeure, ce qui bloque la certification en attendant la lev√©e des actions correctives sous 3 mois." },
                { text: "L'organisme re√ßoit un simple avertissement sans suite.", isCorrect: false, rationale: "Loin d'√™tre un simple avertissement, cette situation bloque le processus de certification." }
            ],
            hint: "Pensez √† l'effet de seuil. Plusieurs petits probl√®mes peuvent former un grand."
        },
        {
            question: "Pour un organisme qui ne fait que des Bilans de Comp√©tences, quel indicateur suivant N'EST PAS applicable ?",
            options: [
                { text: "Indicateur 11 : √âvaluation de l'atteinte des objectifs.", isCorrect: false, rationale: "L'√©valuation est au c≈ìur du bilan de comp√©tences et est donc applicable." },
                { text: "Indicateur 8 : Positionnement √† l'entr√©e.", isCorrect: true, rationale: "Le positionnement √† l'entr√©e, tel que d√©fini dans le RNQ, est sp√©cifique aux Actions de Formation et √† l'Apprentissage, mais pas aux Bilans de Comp√©tences." },
                { text: "Indicateur 26 : Accueil des publics en situation de handicap.", isCorrect: false, rationale: "L'accessibilit√© et l'accueil des personnes en situation de handicap est une exigence transversale applicable √† toutes les cat√©gories." },
                { text: "Indicateur 32 : D√©marche d'am√©lioration continue.", isCorrect: false, rationale: "L'am√©lioration continue est le pilier du crit√®re 7 et s'applique √† tous les organismes." }
            ],
            hint: "Certains indicateurs sont tr√®s sp√©cifiques au parcours d'une formation 'classique'."
        },
        {
            question: "Lors d'un audit de surveillance, quel est le principal point de vigilance de l'auditeur ?",
            options: [
                { text: "La lev√©e des non-conformit√©s de l'audit initial et l'application r√©elle des processus.", isCorrect: true, rationale: "L'audit de surveillance vise √† v√©rifier que l'organisme a corrig√© ses √©carts et que son syst√®me qualit√© est r√©ellement op√©rationnel au quotidien." },
                { text: "Uniquement la situation administrative et financi√®re de l'organisme.", isCorrect: false, rationale: "Bien que la situation administrative soit v√©rifi√©e, le focus principal reste la mise en ≈ìuvre de la qualit√©." },
                { text: "La conception de nouveaux processus non pr√©sent√©s en initial.", isCorrect: false, rationale: "L'audit v√©rifie l'application des processus existants, pas la cr√©ation de nouveaux (sauf s'ils r√©pondent √† une NC)." },
                { text: "La satisfaction des 3 derniers clients uniquement.", isCorrect: false, rationale: "L'auditeur regarde un √©chantillon repr√©sentatif de l'activit√© depuis l'audit pr√©c√©dent, pas seulement quelques clients." }
            ],
            hint: "Cet audit n'est pas une r√©p√©tition de l'initial ; il v√©rifie la dynamique et la correction."
        },
        {
            question: "Quelle preuve est indispensable pour d√©montrer l'efficacit√© de la veille (Ind. 23, 24, 25) ?",
            options: [
                { text: "Une liste de sites web consult√©s.", isCorrect: false, rationale: "Avoir des sources est la premi√®re √©tape, mais ne prouve pas que l'information est utilis√©e." },
                { text: "Un abonnement √† une revue professionnelle.", isCorrect: false, rationale: "L'abonnement prouve l'acc√®s √† l'information, mais pas son exploitation." },
                { text: "La tra√ßabilit√© de l'impact de la veille sur une pratique ou un document.", isCorrect: true, rationale: "L'auditeur attend une preuve tangible, comme un programme de formation mis √† jour suite √† une veille m√©tier, avec la date et la raison de la modification." },
                { text: "Le CV du responsable de la veille.", isCorrect: false, rationale: "La comp√©tence de la personne est un moyen, mais la preuve attendue est le r√©sultat de son travail." }
            ],
            hint: "L'auditeur ne veut pas savoir ce que vous lisez, mais ce que vous en faites."
        },
        {
            question: "Un organisme 'nouvel entrant' passe son audit initial. Sur quel aspect de l'indicateur 32 (am√©lioration continue) sera-t-il principalement √©valu√© ?",
            options: [
                { text: "Sur la base des 10 derni√®res actions d'am√©lioration men√©es.", isCorrect: false, rationale: "En tant que nouvel entrant, l'organisme n'a pas encore l'historique n√©cessaire pour pr√©senter un grand nombre d'actions." },
                { text: "Sur la formalisation du processus d'am√©lioration continue.", isCorrect: true, rationale: "Pour un nouvel entrant, l'auditeur v√©rifie que la proc√©dure est bien con√ßue ('comment vous allez faire'), car la mise en ≈ìuvre effective sera v√©rifi√©e √† l'audit de surveillance." },
                { text: "Sur le budget allou√© √† l'am√©lioration continue.", isCorrect: false, rationale: "Le budget est un moyen, mais l'exigence porte sur le processus et sa mise en ≈ìuvre, pas sur le montant financier." },
                { text: "L'indicateur 32 n'est pas applicable aux nouveaux entrants.", isCorrect: false, rationale: "L'indicateur est bien applicable, mais son √©valuation est adapt√©e √† la situation de l'organisme." }
            ],
            hint: "Comment auditer quelque chose qui n'a pas encore eu le temps de se produire ?"
        },
        {
            question: "O√π est-il formellement interdit d'apposer le logo Qualiopi ?",
            options: [
                { text: "Sur le site internet de l'organisme.", isCorrect: false, rationale: "Le site internet est un support de communication institutionnel o√π le logo est autoris√©, √† condition de respecter la charte." },
                { text: "Sur une brochure pr√©sentant l'ensemble des formations.", isCorrect: false, rationale: "Une brochure institutionnelle est un support autoris√©." },
                { text: "Sur une attestation de fin de formation.", isCorrect: true, rationale: "Il est interdit d'apposer le logo sur un produit de formation. Cela laisserait croire que la formation est 'certifi√©e', alors que c'est l'organisme qui l'est." },
                { text: "Dans la signature de mail du dirigeant.", isCorrect: false, rationale: "La signature de mail est consid√©r√©e comme un support de communication de l'organisme, l'usage y est donc permis." }
            ],
            hint: "La certification porte sur l'organisme, pas sur un produit ou service sp√©cifique."
        },
        {
            question: "Quelle action correspond √† la phase 'Act' du cycle PDCA dans le contexte Qualiopi ?",
            options: [
                { text: "Envoyer un questionnaire de satisfaction aux apprenants.", isCorrect: false, rationale: "L'envoi et la collecte des questionnaires rel√®vent de la phase 'Check' (V√©rifier)." },
                { text: "Mettre √† jour un programme de formation suite √† des retours n√©gatifs.", isCorrect: true, rationale: "La phase 'Act' (Agir/Am√©liorer) consiste √† mettre en ≈ìuvre des actions correctives bas√©es sur l'analyse des donn√©es collect√©es." },
                { text: "D√©finir les objectifs p√©dagogiques d'une nouvelle formation.", isCorrect: false, rationale: "La d√©finition des objectifs fait partie de la phase 'Plan' (Planifier)." },
                { text: "Animer une session de formation.", isCorrect: false, rationale: "L'animation de la formation est le c≈ìur de la phase 'Do' (Faire)." }
            ],
            hint: "Cette phase est celle o√π l'on corrige le tir apr√®s avoir analys√© la situation."
        },
        {
            question: "Quelle est une exigence sp√©cifique √† un CFA pour l'indicateur 20 ?",
            options: [
                { text: "Avoir un formateur expert pour chaque mati√®re.", isCorrect: false, rationale: "Avoir des formateurs experts rel√®ve de l'indicateur 21, commun √† tous." },
                { text: "Mettre en place un conseil de perfectionnement.", isCorrect: true, rationale: "L'indicateur 20 impose sp√©cifiquement aux CFA (et par extension aux OFA) de nommer des personnels d√©di√©s, dont le conseil de perfectionnement, et de prouver son activit√©." },
                { text: "Disposer de salles de cours √©quip√©es de vid√©oprojecteurs.", isCorrect: false, rationale: "Les moyens techniques rel√®vent de l'indicateur 17, commun √† tous." },
                { text: "Organiser des r√©unions p√©dagogiques mensuelles.", isCorrect: false, rationale: "La coordination du personnel (Ind. 18) est commune √† tous, m√™me si la fr√©quence n'est pas impos√©e." }
            ],
            hint: "Les CFA ont des obligations de gouvernance sp√©cifiques pour piloter leur activit√©."
        },
        {
            question: "Pour l'indicateur 27 (Sous-traitance), qui porte la responsabilit√© finale de la qualit√© de la prestation ?",
            options: [
                { text: "Le sous-traitant, car il r√©alise la prestation.", isCorrect: false, rationale: "Le sous-traitant a une responsabilit√© contractuelle, mais face √† l'auditeur Qualiopi, le responsable est celui qui porte la certification." },
                { text: "Le donneur d'ordres, qui est le certifi√©.", isCorrect: true, rationale: "Le donneur d'ordres est le seul responsable aux yeux de l'auditeur. Il doit prouver qu'il s√©lectionne, pilote et contr√¥le son sous-traitant." },
                { text: "Le financeur (OPCO, P√¥le Emploi...).", isCorrect: false, rationale: "Le financeur exige la certification mais n'est pas responsable de la qualit√© de la prestation d√©livr√©e." },
                { text: "L'apprenant, qui doit se renseigner.", isCorrect: false, rationale: "L'apprenant est le b√©n√©ficiaire ; la responsabilit√© de la qualit√© ne peut lui √™tre imput√©e." }
            ],
            hint: "Pensez √† qui a sign√© le contrat de certification avec l'organisme certificateur."
        },
         {
            question: "Un audit de renouvellement doit obligatoirement se d√©rouler :",
            options: [
                { text: "√Ä distance si l'organisme n'a qu'un seul site.", isCorrect: false, rationale: "La modalit√© √† distance n'est pas une option pour cet audit, quel que soit le nombre de sites." },
                { text: "Sur un √©chantillon de 50% des indicateurs.", isCorrect: false, rationale: "L'audit de renouvellement est complet et couvre tous les indicateurs applicables, comme l'audit initial." },
                { text: "Sur site, m√™me pour un organisme sans locaux d√©di√©s.", isCorrect: true, rationale: "C'est une r√®gle imp√©rative. L'audit se d√©roule sur le lieu d'activit√©, qui peut √™tre le domicile du dirigeant si n√©cessaire." },
                { text: "Dans les 6 mois suivant l'expiration du certificat.", isCorrect: false, rationale: "Il doit imp√©rativement avoir lieu AVANT l'expiration du certificat pour √©viter toute rupture de certification." }
            ],
            hint: "Cet audit est le plus exigeant du cycle et n√©cessite un contr√¥le physique."
        },
         {
            question: "Pour un accompagnement VAE, quel est un point de vigilance majeur pour l'indicateur 21 (comp√©tences des personnels) ?",
            options: [
                { text: "La ponctualit√© des accompagnateurs.", isCorrect: false, rationale: "La ponctualit√© rel√®ve du savoir-√™tre g√©n√©ral mais n'est pas l'attendu sp√©cifique de cet indicateur." },
                { text: "La ma√Ætrise des outils bureautiques par les accompagnateurs.", isCorrect: false, rationale: "C'est une comp√©tence utile, mais pas le c≈ìur de l'exigence pour un accompagnateur VAE." },
                { text: "La preuve de leur expertise de la m√©thodologie VAE.", isCorrect: true, rationale: "L'auditeur attend des preuves que les accompagnateurs sont sp√©cifiquement form√©s et comp√©tents sur l'ing√©nierie de la VAE et l'analyse des r√©f√©rentiels." },
                { text: "Le nombre d'ann√©es d'exp√©rience g√©n√©rale des accompagnateurs.", isCorrect: false, rationale: "L'exp√©rience g√©n√©rale est un plus, mais l'expertise sp√©cifique √† la VAE est l'√©l√©ment cl√© √† d√©montrer." }
            ],
            hint: "L'accompagnement VAE est un m√©tier avec une m√©thodologie tr√®s sp√©cifique."
        },
        {
            question: "Que se passe-t-il si une non-conformit√© mineure d√©tect√©e √† l'audit initial n'est pas corrig√©e lors de l'audit de surveillance ?",
            options: [
                { text: "Elle est simplement not√©e de nouveau comme mineure.", isCorrect: false, rationale: "Le r√©f√©rentiel pr√©voit une sanction en cas de non-correction d'un √©cart constat√©." },
                { text: "Elle est requalifi√©e en non-conformit√© majeure.", isCorrect: true, rationale: "C'est une r√®gle de gestion stricte : une NC mineure non sold√©e se transforme en NC majeure, avec des cons√©quences bien plus graves (suspension possible)." },
                { text: "L'organisme dispose d'un nouveau d√©lai de 6 mois.", isCorrect: false, rationale: "Le d√©lai n'est pas reconduit ; l'absence d'action est sanctionn√©e par une requalification." },
                { text: "L'auditeur l'ignore si d'autres points ont √©t√© am√©lior√©s.", isCorrect: false, rationale: "L'auditeur ne peut ignorer un √©cart constat√© et non corrig√© ; il doit appliquer les r√®gles de gestion de la certification." }
            ],
            hint: "La persistance dans l'erreur est plus s√©v√®rement jug√©e."
        },
        {
            question: "Pour un bilan de comp√©tences, quel √©l√©ment est crucial pour prouver le respect de la m√©thodologie (Ind. 10) ?",
            options: [
                { text: "Un questionnaire de satisfaction final.", isCorrect: false, rationale: "Le questionnaire de satisfaction rel√®ve de l'indicateur 30, pas de la m√©thodologie du bilan elle-m√™me." },
                { text: "La preuve du respect des trois phases (pr√©liminaire, investigation, conclusions).", isCorrect: true, rationale: "Le Code du travail impose cette structuration en 3 phases. L'organisme doit le prouver via les documents remis au b√©n√©ficiaire (ex: document de synth√®se)." },
                { text: "Le CV de la personne qui a men√© le bilan.", isCorrect: false, rationale: "Le CV rel√®ve de l'indicateur 21 (comp√©tences), pas de la preuve du d√©roulement m√©thodologique pour un b√©n√©ficiaire donn√©." },
                { text: "Une facture d√©taill√©e de la prestation.", isCorrect: false, rationale: "La facture est un document comptable, pas une preuve de la mise en ≈ìuvre m√©thodologique." }
            ],
            hint: "Le Code du Travail d√©finit un cadre tr√®s pr√©cis pour cette prestation."
        },
        {
            question: "L'indicateur 1 'Information d√©taill√©e, v√©rifiable et accessible' concerne :",
            options: [
                { text: "Uniquement les informations tarifaires.", isCorrect: false, rationale: "Les tarifs sont une partie de l'information, mais l'indicateur est bien plus large." },
                { text: "Uniquement les informations accessibles aux personnes handicap√©es.", isCorrect: false, rationale: "L'accessibilit√© est un des points, mais pas le seul. L'information doit aussi √™tre claire, compl√®te et √† jour pour tous." },
                { text: "L'ensemble des informations pr√©contractuelles (objectifs, pr√©requis, dur√©e, modalit√©s, tarifs, etc.).", isCorrect: true, rationale: "Cet indicateur couvre toute l'information qui doit √™tre mise √† disposition du public avant toute contractualisation, pour permettre une d√©cision √©clair√©e." },
                { text: "Uniquement le contenu d√©taill√© du programme de formation.", isCorrect: false, rationale: "Le programme est un √©l√©ment cl√©, mais l'indicateur couvre aussi les aspects pratiques, logistiques et financiers." }
            ],
            hint: "Que doit savoir un client potentiel AVANT de s'engager ?"
        },
        {
            question: "L'absence totale de proc√©dure formalis√©e pour le traitement des r√©clamations (Ind. 31) est susceptible d'√™tre qualifi√©e de :",
            options: [
                { text: "Point de vigilance sans cons√©quence.", isCorrect: false, rationale: "La gestion des r√©clamations est un point fondamental de la relation client et de la d√©marche qualit√©." },
                { text: "Non-conformit√© mineure si aucune r√©clamation n'a √©t√© re√ßue.", isCorrect: false, rationale: "M√™me sans r√©clamation, l'absence de processus pour les g√©rer en cas de besoin est une d√©faillance majeure du syst√®me." },
                { text: "Non-conformit√© majeure.", isCorrect: true, rationale: "Ne pas avoir de processus pour traiter les difficult√©s et les r√©clamations est consid√©r√© comme une d√©faillance critique du syst√®me qualit√©, car cela prive l'organisme d'une source essentielle d'am√©lioration." },
                { text: "Recommandation d'am√©lioration.", isCorrect: false, rationale: "L'exigence de formalisation est explicite dans le guide de lecture ; son absence est un √©cart (une non-conformit√©), pas une simple suggestion." }
            ],
            hint: "Comment une entreprise peut-elle s'am√©liorer si elle n'a pas de syst√®me pour √©couter ses clients m√©contents ?"
        }
    ];

    function createFilterGroup(groupId, groupData) {
        const container = document.getElementById(groupId);
        groupData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'flex items-center';
            div.innerHTML = `
                <input type="checkbox" id="filter-${item.id}" name="${groupId}" value="${item.id}" class="filter-checkbox hidden">
                <label for="filter-${item.id}" class="w-full cursor-pointer rounded-md border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 transition-colors">${item.label}</label>
            `;
            container.appendChild(div);
        });
    }

    function generateAccordion() {
        const accordionContainer = document.getElementById('criteria-accordion');
        accordionContainer.innerHTML = ''; // Clear existing
        db.forEach(criterion => {
            const criterionDiv = document.createElement('div');
            criterionDiv.className = 'bg-white rounded-xl shadow-md';
            criterionDiv.innerHTML = `
                <div class="accordion-header cursor-pointer p-4 flex justify-between items-center border-b border-slate-200">
                    <h3 class="text-lg font-semibold text-slate-800">Crit√®re ${criterion.criterionId}: ${criterion.criterionTitle}</h3>
                    <span class="accordion-icon text-sky-600 text-2xl font-light transform">&#9660;</span>
                </div>
                <div class="accordion-content">
                    <div class="p-4 space-y-6">
                        ${criterion.indicators.map(indicator => `
                            <div class="indicator-card p-4 rounded-lg border-l-4 status-not-treated" data-indicator-id="${indicator.id}">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-md text-sky-700 pr-4">Indicateur ${indicator.id}: ${indicator.title}</h4>
                                    <select class="status-select select-not-treated text-sm rounded-md border-slate-300" data-indicator-id="${indicator.id}">
                                        <option value="not-treated">Non trait√©</option>
                                        <option value="todo">√Ä faire</option>
                                        <option value="in-progress">En cours</option>
                                        <option value="done">Conforme</option>
                                    </select>
                                </div>
                                <p class="text-sm text-slate-600 mt-1 mb-3 italic"><strong>Attendu :</strong> ${indicator.analysis}</p>
                                <div class="space-y-2">
                                    ${indicator.evidence.map((evi, index) => `
                                        <div class="evidence-item flex items-start" data-tags="${evi.tags.join(',')}" data-evidence-id="${indicator.id}-${index}">
                                            <label class="flex items-start text-sm text-slate-800 cursor-pointer">
                                                <input type="checkbox" class="evidence-checkbox h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500 mt-0.5 mr-3 flex-shrink-0" data-evidence-id="${indicator.id}-${index}">
                                                <span>${evi.text}</span>
                                            </label>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            accordionContainer.appendChild(criterionDiv);
        });
    }
    
    function addEventListeners() {
        const accordionContainer = document.getElementById('criteria-accordion');
        accordionContainer.addEventListener('click', function(e) {
            const header = e.target.closest('.accordion-header');
            if (header) {
                header.classList.toggle('open');
                const content = header.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            }
        });
        
        const filterSection = document.getElementById('filters');
        filterSection.addEventListener('change', applyFilters);

        document.getElementById('reset-filters').addEventListener('click', () => {
             filterSection.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
             applyFilters();
        });

        // Lexicon Modal Listeners
        const openBtn = document.getElementById('open-lexicon-btn');
        const closeBtn = document.getElementById('close-lexicon-btn');
        const modal = document.getElementById('lexicon-modal');
        const modalContainer = modal.querySelector('.modal-container');

        openBtn.addEventListener('click', () => {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContainer.classList.remove('scale-95');
            }, 10);
        });

        closeBtn.addEventListener('click', () => {
            modalContainer.classList.add('scale-95');
            modal.classList.add('opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        });
        
        // Export listeners
        document.getElementById('export-csv-btn').addEventListener('click', exportToCsv);
        document.getElementById('export-md-btn').addEventListener('click', exportToMarkdown);
        document.getElementById('export-pdf-btn').addEventListener('click', () => window.print());

        // Back to top button listener
        const backToTopBtn = document.getElementById('back-to-top-btn');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 200) {
                backToTopBtn.classList.remove('hidden');
            } else {
                backToTopBtn.classList.add('hidden');
            }
        });
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // State management listeners
        accordionContainer.addEventListener('change', e => {
            if (e.target.classList.contains('status-select')) {
                const selectElement = e.target;
                const indicatorId = selectElement.dataset.indicatorId;
                const status = selectElement.value;
                if (!indicatorStates[indicatorId]) indicatorStates[indicatorId] = {};
                indicatorStates[indicatorId].status = status;
                
                // Update card style
                const card = selectElement.closest('.indicator-card');
                card.classList.remove('status-not-treated', 'status-todo', 'status-in-progress', 'status-done');
                card.classList.add(`status-${status}`);
                card.dataset.printStatus = selectElement.options[selectElement.selectedIndex].text;

                // Update select style
                selectElement.classList.remove('select-not-treated', 'select-todo', 'select-in-progress', 'select-done');
                selectElement.classList.add(`select-${status}`);
            }
            if (e.target.classList.contains('evidence-checkbox')) {
                const evidenceId = e.target.dataset.evidenceId;
                if (!indicatorStates[evidenceId]) indicatorStates[evidenceId] = {};
                indicatorStates[evidenceId].checked = e.target.checked;
            }
        });
    }

    function getApplicableIndicatorIds() {
        const selectedTypologies = Array.from(document.querySelectorAll('#filter-typology input:checked')).map(cb => cb.value);
        const selectedContexts = Array.from(document.querySelectorAll('#filter-context input:checked')).map(cb => cb.value);
        
        let applicableIndicators = new Set();

        // If no typology is selected, show all indicators
        if (selectedTypologies.length === 0) {
            Object.keys(indicatorApplicability).forEach(id => applicableIndicators.add(id));
        } else {
             for (const [id, typologies] of Object.entries(indicatorApplicability)) {
                if (selectedTypologies.some(selected => typologies.includes(selected))) {
                    applicableIndicators.add(id);
                }
            }
        }
        
        // Add indicators based on context, which can add to any typology
        selectedContexts.forEach(context => {
            for (const [id, typologies] of Object.entries(indicatorApplicability)) {
                 if (typologies.includes(context)) {
                    applicableIndicators.add(id);
                }
            }
        });

        return applicableIndicators;
    }

    function applyFilters() {
        const applicableIndicatorIds = getApplicableIndicatorIds();
        
        // Show/hide indicator cards
        document.querySelectorAll('.indicator-card').forEach(card => {
            const indicatorId = card.dataset.indicatorId;
            if (applicableIndicatorIds.has(indicatorId)) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });

        // Filter evidence items within visible cards
        const activeFilters = Array.from(document.querySelectorAll('#filters input:checked')).map(cb => cb.value);
        document.querySelectorAll('.evidence-item').forEach(item => {
            const tags = item.dataset.tags.split(',');
            if (activeFilters.length === 0 || tags.includes('all') || activeFilters.some(filter => tags.includes(filter))) {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });

        // Re-calculate accordion heights
        document.querySelectorAll('.accordion-content').forEach(content => {
            if(content.style.maxHeight && content.style.maxHeight !== '0px'){
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });

        updateIndicatorChart(applicableIndicatorIds.size);
    }

    function escapeCsvField(field) {
        if (field === null || field === undefined) {
            return '';
        }
        const stringField = String(field);
        if (stringField.includes(';') || stringField.includes('"') || stringField.includes('\n')) {
            return `"${stringField.replace(/"/g, '""')}"`;
        }
        return stringField;
    }

    function exportToCsv() {
        const applicableIndicatorIds = getApplicableIndicatorIds();
        let csvContent = "Critere_ID;Critere_Titre;Indicateur_ID;Indicateur_Titre;Statut_Indicateur;Exemple_Preuve;Preuve_Cochee\n";
        
        db.forEach(criterion => {
            const relevantIndicators = criterion.indicators.filter(ind => applicableIndicatorIds.has(ind.id.toString()));
            
            if (relevantIndicators.length > 0) {
                relevantIndicators.forEach(indicator => {
                    const indicatorStatus = indicatorStates[indicator.id]?.status || 'not-treated';
                    const statusText = document.querySelector(`.status-select[data-indicator-id="${indicator.id}"] option[value="${indicatorStatus}"]`).textContent;

                     indicator.evidence.forEach((evi, index) => {
                         const evidenceId = `${indicator.id}-${index}`;
                         const evidenceItem = document.querySelector(`[data-evidence-id="${evidenceId}"]`);
                         if (evidenceItem && !evidenceItem.classList.contains('hidden')) {
                             const isChecked = indicatorStates[evidenceId]?.checked || false;
                             const row = [
                                 criterion.criterionId,
                                 criterion.criterionTitle,
                                 indicator.id,
                                 indicator.title,
                                 statusText,
                                 evi.text,
                                 isChecked ? 'Oui' : 'Non'
                             ].map(escapeCsvField).join(';');
                             csvContent += row + '\n';
                         }
                     });
                });
            }
        });

        const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'export-qualiopi.csv';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function exportToMarkdown() {
        let markdownContent = `# Base de Donn√©es Op√©rationnelle Qualiopi\n\n`;
        const activeFilters = Array.from(document.querySelectorAll('#filters input:checked')).map(cb => cb.labels[0].textContent);
        const applicableIndicatorIds = getApplicableIndicatorIds();

        if (activeFilters.length > 0) {
            markdownContent += `**Filtres actifs :** ${activeFilters.join(', ')}\n\n`;
        }

        db.forEach(criterion => {
            const relevantIndicators = criterion.indicators.filter(ind => applicableIndicatorIds.has(ind.id.toString()));
            
            if (relevantIndicators.length > 0) {
                markdownContent += `## Crit√®re ${criterion.criterionId}: ${criterion.criterionTitle}\n\n`;
                relevantIndicators.forEach(indicator => {
                     const indicatorStatus = indicatorStates[indicator.id]?.status || 'not-treated';
                     const statusText = document.querySelector(`.status-select[data-indicator-id="${indicator.id}"] option[value="${indicatorStatus}"]`).textContent;

                     markdownContent += `### Indicateur ${indicator.id}: ${indicator.title}\n`;
                     markdownContent += `**Statut :** ${statusText}\n`;
                     markdownContent += `**Attendu :** ${indicator.analysis}\n\n`;
                     indicator.evidence.forEach((evi, index) => {
                         const evidenceId = `${indicator.id}-${index}`;
                         const evidenceItem = document.querySelector(`[data-evidence-id="${evidenceId}"]`);
                         if (evidenceItem && !evidenceItem.classList.contains('hidden')) {
                             const isChecked = indicatorStates[evidenceId]?.checked || false;
                             markdownContent += `* [${isChecked ? 'x' : ' '}] ${evi.text}\n`;
                         }
                     });
                     markdownContent += `\n`;
                });
            }
        });
        
        const blob = new Blob([markdownContent], { type: 'text/markdown;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'export-qualiopi.md';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    const centerTextPlugin = {
        id: 'centerText',
        afterDraw: function(chart) {
            if (chart.options.plugins.centerText && chart.options.plugins.centerText.text) {
                let ctx = chart.ctx;
                ctx.save();
                let text = chart.options.plugins.centerText.text;
                let x = (chart.chartArea.left + chart.chartArea.right) / 2;
                let y = (chart.chartArea.top + chart.chartArea.bottom) / 2;
                
                ctx.font = 'bold 32px Inter';
                ctx.fillStyle = '#1e293b';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(text, x, y);
                ctx.restore();
            }
        }
    };
    
    Chart.register(centerTextPlugin);

    function initIndicatorChart() {
        const ctx = document.getElementById('indicator-chart').getContext('2d');
        indicatorChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Applicables', 'Non applicables'],
                datasets: [{
                    data: [32, 0], // Start with all shown
                    backgroundColor: ['#0ea5e9', '#e2e8f0'],
                    borderColor: '#ffffff',
                    borderWidth: 4,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: true },
                    centerText: { text: '32 / 32' }
                }
            }
        });
    }

    function updateIndicatorChart(applicableCount) {
        const totalCount = 32;
        indicatorChart.data.datasets[0].data = [applicableCount, totalCount - applicableCount];
        indicatorChart.options.plugins.centerText.text = `${applicableCount} / ${totalCount}`;
        indicatorChart.update();
    }

    // --- New Functions for Toolkit Tabs ---
    function setupTabs() {
        const tabsContainer = document.getElementById('toolkit-tabs');
        const contentContainer = document.getElementById('toolkit-content');
        
        Object.entries(toolkitContent).forEach(([key, value], index) => {
            const button = document.createElement('a');
            button.href = '#';
            button.dataset.tab = key;
            button.className = `tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${index === 0 ? 'active' : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300'}`;
            button.textContent = value.title;
            tabsContainer.appendChild(button);

            const contentDiv = document.createElement('div');
            contentDiv.id = `tab-content-${key}`;
            contentDiv.className = `tab-content p-2 ${index === 0 ? 'active' : ''}`;
            contentDiv.innerHTML = value.content;
            contentContainer.appendChild(contentDiv);
        });

        tabsContainer.addEventListener('click', (e) => {
            e.preventDefault();
            if (e.target.classList.contains('tab-button')) {
                const tabId = e.target.dataset.tab;
                
                tabsContainer.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                
                contentContainer.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                const activeContent = document.getElementById(`tab-content-${tabId}`);
                activeContent.classList.add('active');
                
                if (tabId === 'checklist') {
                    setupToolkitAccordion(); 
                }
            }
        });
        
        setupToolkitAccordion(); // Initial call for the first tab
    }

    // New function for Toolkit Accordion (distinct from main accordion)
    function setupToolkitAccordion() {
        const accordionContainer = document.getElementById('checklist-accordion');
        if (accordionContainer) {
            accordionContainer.addEventListener('click', (e) => {
                const header = e.target.closest('.toolkit-accordion-header');
                if (!header) return;

                const content = header.nextElementSibling;
                
                header.classList.toggle('open'); 
                
                if (content.style.maxHeight) {
                    content.style.maxHeight = null; // Close
                } else {
                    content.style.maxHeight = content.scrollHeight + "px"; // Open
                }
            });
        }
    }

    // --- New Functions for Quiz ---
    const quizContainer = document.getElementById('quiz-container');
    const startScreen = document.getElementById('quiz-start-screen');
    const mainScreen = document.getElementById('quiz-main-screen');
    const endScreen = document.getElementById('quiz-end-screen');
    const startBtn = document.getElementById('start-quiz-btn');
    const restartBtn = document.getElementById('restart-quiz-btn');
    const nextBtn = document.getElementById('next-question-btn');
    const hintBtn = document.getElementById('hint-btn');
    
    let currentQuestionIndex = 0;
    let score = 0;
    let questions = [];

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        questions = shuffleArray([...quizQuestions]); // Use the new quizQuestions constant
        startScreen.classList.add('hidden');
        endScreen.classList.add('hidden');
        mainScreen.classList.remove('hidden');
        nextBtn.classList.add('hidden');
        displayQuestion();
    }

    function displayQuestion() {
        const question = questions[currentQuestionIndex];
        document.getElementById('quiz-progress').textContent = `Question ${currentQuestionIndex + 1} / ${questions.length}`;
        document.getElementById('question-text').textContent = question.question;

        const answerOptionsContainer = document.getElementById('answer-options');
        answerOptionsContainer.innerHTML = '';
        shuffleArray(question.options).forEach(option => {
            const button = document.createElement('button');
            button.className = 'quiz-option w-full p-3 text-left bg-white border border-slate-300 rounded-lg hover:bg-slate-100 transition-colors';
            button.textContent = option.text;
            button.onclick = () => selectAnswer(button, option, question.options);
            answerOptionsContainer.appendChild(button);
        });

        const hintBox = document.getElementById('hint-box');
        hintBox.textContent = question.hint;
        hintBox.style.display = 'none';

        document.getElementById('feedback-area').innerHTML = '';
        nextBtn.classList.add('hidden');
    }

    function selectAnswer(selectedButton, selectedOption, allOptions) {
        document.querySelectorAll('.quiz-option').forEach(btn => {
            btn.disabled = true;
        });

        const feedbackArea = document.getElementById('feedback-area');
        feedbackArea.innerHTML = '';
        
        if (selectedOption.isCorrect) {
            score++;
            selectedButton.classList.add('correct');
        } else {
            selectedButton.classList.add('incorrect');
        }

        allOptions.forEach(opt => {
            const feedback = document.createElement('div');
            feedback.className = `p-3 mt-2 text-sm rounded-lg border-l-4 ${opt.isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`;
            feedback.innerHTML = `<strong>${opt.text}:</strong> ${opt.rationale}`;
            feedbackArea.appendChild(feedback);

            if(opt.isCorrect && !selectedOption.isCorrect){
                 document.querySelectorAll('.quiz-option').forEach(btn => {
                     if(btn.textContent === opt.text) {
                         btn.classList.add('correct');
                     }
                 });
            }
        });

        nextBtn.classList.remove('hidden');
    }

    function showNextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            displayQuestion();
        } else {
            showEndScreen();
        }
    }

    function showEndScreen() {
        mainScreen.classList.add('hidden');
        endScreen.classList.remove('hidden');
        document.getElementById('quiz-score').textContent = `Votre score : ${score} / ${questions.length}`;

        const percentage = (score / questions.length) * 100;
        let summaryText = "Continuez √† explorer l'application pour renforcer vos connaissances !";
        if (percentage >= 80) {
            summaryText = "Excellent ! Vous ma√Ætrisez les points cl√©s de Qualiopi.";
        } else if (percentage >= 50) {
            summaryText = "Bon score ! Quelques points sont encore √† approfondir.";
        }
        document.getElementById('quiz-summary-text').textContent = summaryText;
    }


    // Initialisation
    createFilterGroup('filter-typology', filters.typology);
    createFilterGroup('filter-modality', filters.modality);
    createFilterGroup('filter-size', filters.size);
    createFilterGroup('filter-context', filters.context);
    generateAccordion();
    addEventListeners();
    initIndicatorChart();
    applyFilters(); // Apply initial filter state

    // Call new setup functions after existing ones
    setupTabs();
    startBtn.addEventListener('click', startQuiz);
    restartBtn.addEventListener('click', startQuiz);
    nextBtn.addEventListener('click', showNextQuestion);
    hintBtn.addEventListener('click', () => {
        const hintBox = document.getElementById('hint-box');
        hintBox.style.display = hintBox.style.display === 'none' ? 'block' : 'none';
    });
});
</script>

</body>
</html>