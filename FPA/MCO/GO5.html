--- START OF FILE 10.html ---

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Pédagogique : Analyse de l'Équilibre Financier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .module-content h2 {
            /* MODIFICATION 1: Taille de police responsive pour les titres */
            font-size: 1.5rem; /* Taille par défaut pour mobile (équivalent à text-xl) */
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1a202c;
            border-bottom: 3px solid #14b8a6; /* Accent color */
            padding-bottom: 0.5rem;
        }
        @media (min-width: 768px) {
            .module-content h2 {
                font-size: 1.75rem; /* Taille originale pour les écrans md et plus (équivalent à text-2xl) */
            }
        }
        .module-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #2d3748;
        }
        .module-content p {
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        .module-content .concept-box {
            background-color: #f0f4f8; /* Lighter blue-gray */
            border-left: 4px solid #4a5568;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border-radius: 0.25rem;
        }
        .module-content .formula-box {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            text-align: center;
            font-size: 1.1rem;
        }
        .interactive-bilan tr:hover {
            background-color: #eff6ff;
            cursor: pointer;
        }
        /* MODIFICATION 2: Règle CSS du slider-container supprimée. La logique est maintenant gérée par les classes Tailwind. */
        .transition-box {
            background-color: #e6f4ea;
            border-left: 4px solid #38a169;
            padding: 1rem;
            margin-top: 2.5rem;
            border-radius: 0.25rem;
            font-style: italic;
        }
        .cta-button {
            background-color: #2563eb;
            color: white;
            font-weight: 500;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
        }
        .cta-button:hover {
            background-color: #1d4ed8;
        }
        .info-icon {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            margin-left: 0.5rem;
            opacity: 0.6;
        }
        
        /* FAQ accordion */
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary { color: #0f766e; }
        details[open] { border-color: #ccfbf1; }

        /* Quiz styles */
        .quiz-option {
            display: block;
            padding: 0.75rem 1.25rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quiz-option:hover {
            border-color: #14b8a6;
        }
        .quiz-option.selected {
            border-color: #0f766e;
            background-color: #ccfbf1;
        }
        .quiz-option.correct {
            border-color: #16a34a;
            background-color: #dcfce7;
        }
        .quiz-option.incorrect {
            border-color: #dc2626;
            background-color: #fee2e2;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div>
        <!-- Sidebar for mobile (hidden by default) and desktop (visible) -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 bg-gray-800 text-white p-6 flex flex-col shrink-0 w-64 md:w-64 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-40">
            <h1 class="text-2xl font-bold mb-8">Analyse Financière</h1>
            <nav id="navigation" class="flex flex-col space-y-2">
                <!-- Navigation links will be inserted here by JS -->
            </nav>
        </aside>

        <!-- Overlay for mobile menu -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>

        <div class="md:ml-64">
             <!-- Mobile Header -->
            <header class="md:hidden bg-gray-800 text-white p-4 flex items-center shadow-md">
                <button id="open-menu-btn" class="mr-4 p-2 rounded-md hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 18v-2h18v2H3Zm0-5v-2h18v2H3Zm0-5V6h18v2H3Z"/></svg>
                </button>
                <h1 class="text-xl font-semibold">Analyse Financière</h1>
            </header>

            <!-- Main content -->
            <main class="flex-1 p-4 md:p-8 overflow-y-auto">
                <div id="module-container" class="bg-white p-6 md:p-8 rounded-lg shadow-lg module-content">
                    <!-- Module content will be inserted here by JS -->
                </div>
            </main>
        </div>
    </div>

    <!-- Modal -->
    <div id="definitionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
            <h2 id="modalTitle" class="text-2xl font-bold mb-4">Définition</h2>
            <div id="modalContent" class="space-y-2"></div>
            <button onclick="closeModal()" class="mt-6 bg-gray-800 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition">Fermer</button>
        </div>
    </div>

<script>
    // --- DATA ---
    const courseData = {
        modules: [
            { id: 'video_intro', title: 'Introduction Vidéo' },
            { id: 'intro', title: 'Concepts Clés' },
            { id: 'bilan_comptable', title: 'Le Bilan Comptable' },
            { id: 'ratios', title: 'Les Ratios Clés' },
            { id: 'bilan_fonctionnel', title: 'Le Bilan Fonctionnel' },
            { id: 'agregats', title: 'FRNG, BFR & Trésorerie' },
            { id: 'simulateur', title: 'Simulateur d\'Équilibre' },
            { id: 'ressources', title: 'Glossaire & FAQ' },
            { id: 'quiz', title: 'Quiz d\'Évaluation' },
            { id: 'synthese', title: 'Synthèse (Carte Mentale)' }
        ],
        content: {
            video_intro: `
                <h2>Introduction Vidéo</h2>
                <p>Pour bien commencer, cette vidéo présente les concepts fondamentaux de l'analyse de l'équilibre financier, leur importance en gestion et leur application dans le cadre du BTS MCO.</p>
                <div class="mt-6 shadow-lg rounded-lg overflow-hidden" style="position: relative; width: 100%; padding-top: 56.25%;">
                    <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0; margin: 0;"
                        src="https://www.canva.com/design/DAGzKgqVKt8/THi7hLYCdHbkZhkRMgosMw/watch?embed" allowfullscreen="allowfullscreen" allow="fullscreen">
                    </iframe>
                </div>
            `,
            intro: `
                <h2>Pourquoi l'Équilibre Financier est le Nerf de la Guerre ?</h2>
                <p>La gestion d'une unité commerciale est complexe. Le succès commercial ne garantit pas toujours la pérennité. Une mauvaise gestion financière, une trésorerie mal maîtrisée ou des investissements mal calibrés sont souvent à l'origine de difficultés qui peuvent s'avérer fatales.</p>
                <p>Pour un manager, comprendre les mécanismes de l'équilibre financier est une nécessité stratégique. Chaque décision opérationnelle a une répercussion directe sur la santé financière de l'entreprise.</p>
                <h3>Approche Pédagogique : Du "Quoi" au "Pourquoi"</h3>
                <p>Ce parcours vous guidera pas à pas, du "Quoi" (Que possède l'entreprise ?) au "Comment" (Comment finance-t-elle son activité ?) et enfin au "Pourquoi" (Pourquoi sa situation est-elle saine ou précaire ?). En utilisant le cas de l'entreprise "Bel" comme fil rouge, vous apprendrez à transformer des chiffres bruts en décisions de gestion éclairées.</p>
            `,
            bilan_comptable: `
                <h2>Le Bilan Comptable : Photographie du Patrimoine</h2>
                <p>Le bilan comptable est le point de départ de toute analyse. Il répond à une question simple : <strong>"À date, que possède l'entreprise (Actif) et comment l'a-t-elle financé (Passif) ?"</strong>. C'est une vision légale et statique, une photographie du patrimoine à un instant T.</p>
                <h3>Schéma Interactif du Bilan de "Bel"</h3>
                <p class="mb-4">Cliquez sur une ligne pour obtenir une explication détaillée. <span class="text-blue-600 font-semibold">Les éléments interactifs sont mis en évidence.</span></p>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500 interactive-bilan">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr><th colspan="2" class="px-6 py-3 text-center text-lg font-bold text-gray-800">ACTIF (Emplois)</th><th colspan="2" class="px-6 py-3 text-center text-lg font-bold text-gray-800">PASSIF (Ressources)</th></tr>
                        </thead>
                        <tbody>
                            <tr class="bg-gray-200 font-bold"><td colspan="2" class="px-6 py-2">ACTIF IMMOBILISÉ</td><td colspan="2" class="px-6 py-2">CAPITAUX PROPRES</td></tr>
                            <tr onclick="showDefinition('Immobilisations', 'Ce sont les biens destinés à être utilisés durablement (plus d’un an). <br><strong>Exemple :</strong> les bâtiments, les machines, les logiciels. C’est le socle de l’outil de production.')"><td class="px-6 py-2 flex items-center">Immobilisations (net) <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">196 100 €</td><td onclick="showDefinition('Capital', 'Ce sont les apports initiaux et ultérieurs des associés ou actionnaires. <br><strong>Exemple :</strong> l’argent apporté par les créateurs de l’entreprise. C’est la ressource la plus stable.')">Capital <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">50 000 €</td></tr>
                            <tr onclick="showDefinition('Réserves', 'Ce sont les bénéfices des années précédentes qui n’ont pas été distribués aux actionnaires mais conservés dans l’entreprise. <br><strong>Objectif :</strong> financer la croissance future (autofinancement).')"><td></td><td></td><td>Réserves <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">9 200 €</td></tr>
                            <tr onclick="showDefinition('Résultat', 'C’est le bénéfice ou la perte de l’année en cours, avant sa répartition. S’il est positif, il viendra renforcer les capitaux propres.')"><td></td><td></td><td>Résultat <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">65 530 €</td></tr>
                             <tr class="bg-gray-200 font-bold"><td colspan="2" class="px-6 py-2">ACTIF CIRCULANT</td><td colspan="2" class="px-6 py-2">DETTES</td></tr>
                            <tr onclick="showDefinition('Stocks', 'Marchandises, matières premières ou produits finis en attente d’être vendus. <br><strong>Analyse :</strong> C’est de l’argent qui “dort” et qui représente un risque (dépréciation, invendus).')"><td class="px-6 py-2">Stocks <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">49 500 €</td><td onclick="showDefinition('Dettes Financières', 'Ce sont les emprunts contractés auprès des établissements de crédit. <br><strong>Analyse :</strong> Elles financent les investissements lourds mais doivent être remboursées avec intérêts.')">Dettes financières <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">113 500 €</td></tr>
                            <tr onclick="showDefinition('Créances Clients', 'Sommes dues par les clients à l’entreprise suite à des ventes avec délai de paiement. <br><strong>Analyse :</strong> C’est de l’argent que l’on attend, ce qui crée un besoin de trésorerie.')"><td class="px-6 py-2">Créances clients <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">32 500 €</td><td onclick="showDefinition('Dettes Fournisseurs', 'Sommes dues aux fournisseurs par l’entreprise. <br><strong>Analyse :</strong> C’est une source de financement à court terme gratuite. Plus ce délai est long, plus on préserve sa trésorerie.')">Dettes fournisseurs <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">62 800 €</td></tr>
                             <tr onclick="showDefinition('Disponibilités', 'Liquidités de l’entreprise (comptes bancaires, caisse). <br><strong>Analyse :</strong> C’est le cash immédiatement disponible pour faire face aux dépenses.')"><td class="px-6 py-2">Disponibilités <img src="https://api.iconify.design/heroicons/information-circle-20-solid.svg?color=%236b7280" class="info-icon"/></td><td class="text-right px-6 py-2">22 700 €</td><td>Autres dettes</td><td class="text-right px-6 py-2">7 400 €</td></tr>
                            <tr class="bg-gray-800 text-white font-bold"><td class="px-6 py-3">TOTAL ACTIF</td><td class="text-right px-6 py-3">308 430 €</td><td class="px-6 py-3">TOTAL PASSIF</td><td class="text-right px-6 py-3">308 430 €</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="transition-box">
                    <p><strong>Transition :</strong> Cette vue "photographique" est essentielle, mais elle ne nous dit pas si l'entreprise est performante ou si sa structure est saine. Pour cela, nous devons faire parler les chiffres en les comparant. C'est le rôle des ratios, que nous allons explorer dans le prochain module.</p>
                </div>
            `,
            ratios: `
                <h2>Les Ratios Clés : Premiers Indicateurs de Performance</h2>
                <p>Les ratios transforment les données brutes du bilan en indicateurs de gestion pertinents. Ils permettent de répondre à des questions managériales précises et de réaliser un premier diagnostic rapide.</p>
                <h3>Calculateur de Ratios Interactif</h3>
                <p>Utilisez les calculateurs ci-dessous pour analyser la situation de "Bel" ou simuler d'autres scénarios.</p>
                <div class="grid md:grid-cols-2 gap-8 mt-6">
                    <div class="bg-gray-50 p-6 rounded-lg shadow">
                        <h4 class="font-bold text-lg mb-2">Ratio d'Indépendance Financière</h4>
                        <p class="text-sm mb-4 italic">Répond à la question : "L'entreprise est-elle trop dépendante de ses banquiers ?"</p>
                        <div class="formula-box">Dettes financières / Capitaux propres</div>
                        <div class="concept-box !bg-blue-50 !border-blue-400">
                            <h5 class="font-semibold mb-2">Comment interpréter ce ratio ?</h5>
                            <ul class="list-disc list-inside text-sm space-y-1">
                                <li><strong class="text-green-600">&lt; 1 :</strong> Situation saine. L'entreprise est indépendante.</li>
                                <li><strong class="text-yellow-600">Entre 1 et 1.5 :</strong> Zone de vigilance. L'endettement est significatif.</li>
                                <li><strong class="text-red-600">&gt; 1.5 :</strong> Risque élevé. L'entreprise dépend fortement des banques.</li>
                            </ul>
                        </div>
                        <p class="text-sm mb-4"><strong>Exemple "Bel" :</strong> Avec 113 500 € de dettes et 124 730 € de capitaux propres, son ratio est de 0.91, ce qui est un signe de bonne santé.</p>
                        <label class="block mb-2 text-sm font-medium">Dettes financières (€)</label>
                        <input type="number" id="dettes_fin" value="113500" class="w-full p-2 border rounded mb-4">
                        <label class="block mb-2 text-sm font-medium">Capitaux propres (€)</label>
                        <input type="number" id="capitaux" value="124730" class="w-full p-2 border rounded mb-4">
                        <button onclick="calculateIndependance()" class="cta-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6M6 20V4h7v5h5v11H6Z"/></svg>Calculer</button>
                        <div class="mt-4">Résultat: <span id="result_independance" class="font-bold"></span><p id="interp_independance" class="text-sm mt-1"></p></div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow">
                        <h4 class="font-bold text-lg mb-2">Délai de Rotation des Stocks</h4>
                        <p class="text-sm mb-4 italic">Répond à la question : "Combien de jours l'argent reste-t-il immobilisé dans les stocks ?"</p>
                        <div class="formula-box">(Stock moyen / Achats HT annuels) * 360</div>
                        <div class="concept-box !bg-blue-50 !border-blue-400">
                             <h5 class="font-semibold mb-2">Comment interpréter ce ratio ?</h5>
                             <p class="text-sm">Ce ratio dépend fortement du secteur d'activité. L'objectif est généralement d'avoir le délai le plus court possible sans risquer la rupture de stock.</p>
                             <ul class="list-disc list-inside text-sm space-y-1 mt-2">
                                <li><strong class="text-green-600">&lt; 45 jours :</strong> Rotation rapide (généralement positif).</li>
                                <li><strong class="text-yellow-600">45-90 jours :</strong> Zone de vigilance.</li>
                                <li><strong class="text-red-600">&gt; 90 jours :</strong> Rotation lente (risque pour la trésorerie).</li>
                            </ul>
                        </div>
                         <p class="text-sm mb-4"><strong>Exemple "Bel" :</strong> Avec un stock de 49 500 € et des achats de 456 098 €, le délai est d'environ 39 jours. C'est le temps moyen avant qu'un produit ne soit vendu.</p>
                        <label class="block mb-2 text-sm font-medium">Stock moyen (€)</label>
                        <input type="number" id="stock_moyen" value="49500" class="w-full p-2 border rounded mb-4">
                        <label class="block mb-2 text-sm font-medium">Achats HT annuels (€)</label>
                        <input type="number" id="achats_ht" value="456098" class="w-full p-2 border rounded mb-4">
                        <button onclick="calculateRotationStock()" class="cta-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6M6 20V4h7v5h5v11H6Z"/></svg>Calculer</button>
                        <div class="mt-4">Résultat: <span id="result_stock" class="font-bold"></span><p id="interp_stock" class="text-sm mt-1"></p></div>
                    </div>
                </div>
                 <div class="transition-box">
                    <p><strong>Transition :</strong> Les ratios sont d'excellents "flashs" d'information. Cependant, pour comprendre la <strong>dynamique</strong> de l'entreprise et comment elle génère (ou consomme) de la trésorerie au quotidien, nous devons changer de perspective. Il faut passer d'une vision comptable à une vision économique : c'est le rôle du bilan fonctionnel.</p>
                </div>
            `,
            bilan_fonctionnel: `
                <h2>Le Bilan Fonctionnel : Vision Économique des Cycles</h2>
                <p>L'objectif du bilan fonctionnel est de répondre à la question : <strong>"Comment l'entreprise finance-t-elle ses investissements et son cycle d'exploitation ?"</strong>. Pour cela, on réorganise le bilan non plus par nature juridique (comptable) mais par fonction économique, ou <strong>cycle</strong> :</p>
                <ul>
                    <li class="list-disc ml-5"><strong>Le cycle de financement et d'investissement (long terme)</strong></li>
                    <li class="list-disc ml-5"><strong>Le cycle d'exploitation (court terme)</strong></li>
                </ul>
                <h3>Structure du Bilan Fonctionnel de "Bel"</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                         <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr><th colspan="2" class="px-6 py-3 text-center text-lg font-bold text-gray-800">EMPLOIS (Comment l'argent est utilisé)</th><th colspan="2" class="px-6 py-3 text-center text-lg font-bold text-gray-800">RESSOURCES (D'où vient l'argent)</th></tr>
                        </thead>
                        <tbody>
                            <tr class="bg-gray-200 font-bold"><td class="px-6 py-2">EMPLOIS STABLES (Investissement)</td><td class="text-right px-6 py-2">267 600 €</td><td class="px-6 py-2">RESSOURCES STABLES (Financement)</td><td class="text-right px-6 py-2">305 900 €</td></tr>
                            <tr class="bg-gray-200 font-bold"><td class="px-6 py-2">ACTIF CIRCULANT D'EXPLOITATION</td><td class="text-right px-6 py-2">93 700 €</td><td class="px-6 py-2">PASSIF CIRCULANT D'EXPLOITATION</td><td class="text-right px-6 py-2">70 200 €</td></tr>
                             <tr class="bg-gray-200 font-bold"><td class="px-6 py-2">TRÉSORERIE ACTIVE</td><td class="text-right px-6 py-2">23 300 €</td><td class="px-6 py-2">TRÉSORERIE PASSIVE</td><td class="text-right px-6 py-2">8 500 €</td></tr>
                            <tr class="bg-gray-800 text-white font-bold"><td class="px-6 py-3">TOTAL GÉNÉRAL</td><td class="text-right px-6 py-3">384 600 €</td><td class="px-6 py-3">TOTAL GÉNÉRAL</td><td class="text-right px-6 py-3">384 600 €</td></tr>
                        </tbody>
                    </table>
                </div>
                 <div class="concept-box mt-6">
                    <strong>Retraitement clé :</strong> Pour passer du comptable au fonctionnel, on considère que les amortissements (76 170 € pour Bel) sont une <strong>ressource de financement interne</strong>. En effet, un amortissement est une charge comptable, mais elle est "non décaissée" : l'argent ne sort pas réellement. Cette "épargne forcée" constitue une ressource stable pour l'entreprise (autofinancement).
                </div>
                <div class="transition-box">
                    <p><strong>Transition :</strong> Maintenant que le bilan est organisé par cycles, nous pouvons calculer les 3 indicateurs les plus importants de l'analyse financière : le FRNG, le BFR et la Trésorerie. Ce sont les piliers qui expliquent la santé financière de l'entreprise.</p>
                </div>
            `,
            agregats: `
                <h2>FRNG, BFR et Trésorerie Nette : Les Piliers de l'Équilibre</h2>
                <p>Ces trois indicateurs (ou agrégats) sont la finalité de l'analyse fonctionnelle. Ils sont liés par une relation fondamentale que tout manager doit maîtriser : <strong>Trésorerie = FRNG - BFR</strong>.</p>
                <div class="space-y-4">
                    <div class="concept-box">
                        <h3>Fonds de Roulement Net Global (FRNG)</h3>
                        <p><strong>Analogie :</strong> C'est l'<strong>épargne de précaution</strong> de l'entreprise. C'est l'excédent des ressources stables qui reste disponible une fois que tous les investissements à long terme sont financés.</p>
                        <div class="formula-box">FRNG = Ressources Stables - Emplois Stables</div>
                        <p><strong>Pour Bel :</strong> 305 900 € - 267 600 € = <strong class="text-green-600">38 300 €</strong>. Bel a une marge de sécurité financière de 38 300 € pour financer son activité quotidienne. C'est un excellent signe de solidité.</p>
                    </div>
                    <div class="concept-box">
                        <h3>Besoin en Fonds de Roulement (BFR)</h3>
                        <p><strong>Analogie :</strong> C'est le <strong>découvert permanent</strong> nécessaire pour faire tourner l'activité. Il naît du décalage inévitable : l'entreprise paie ses stocks et ses charges (décaissements) AVANT d'être payée par ses clients (encaissements).</p>
                        <div class="formula-box">BFR = Actif Circulant d'Exploitation - Passif Circulant d'Exploitation</div>
                         <p><strong>Pour Bel :</strong> 93 700 € - 70 200 € = <strong class="text-orange-600">23 500 €</strong>. L'activité de Bel génère un besoin de financement constant de 23 500 €.</p>
                    </div>
                    <div class="concept-box">
                        <h3>Trésorerie Nette (TN)</h3>
                        <p><strong>Analogie :</strong> C'est le <strong>solde du compte en banque</strong> à la fin du mois. C'est le juge de paix : l'épargne de précaution (FRNG) a-t-elle été suffisante pour couvrir le découvert permanent (BFR) ?</p>
                        <div class="formula-box">TN = FRNG - BFR</div>
                         <p><strong>Pour Bel :</strong> 38 300 € (FRNG) - 23 500 € (BFR) = <strong class="text-blue-600">14 800 €</strong>. La marge de sécurité est suffisante, il reste donc un excédent de trésorerie de 14 800 €. La situation est saine.</p>
                    </div>
                </div>
                 <div class="transition-box">
                    <p><strong>Transition :</strong> Vous avez maintenant compris la théorie et le cas de l'entreprise Bel. Le dernier module vous permet de prendre les commandes et de devenir le manager : manipulez vous-même ces agrégats pour voir leur impact en temps réel grâce à notre simulateur.</p>
                </div>
            `,
            simulateur: `
                <h2>Simulateur d'Équilibre Financier</h2>
                <p>Vous êtes maintenant le Directeur Financier. Manipulez les curseurs du FRNG et du BFR pour visualiser leur impact direct sur la trésorerie. L'équation <strong>TN = FRNG - BFR</strong> est le véritable tableau de bord du manager.</p>
                
                <!-- Sliders -->
                <div class="bg-gray-50 p-6 rounded-lg shadow mt-6">
                    <div class="space-y-6">
                        <!-- MODIFICATION 3: La classe 'slider-container' est remplacée par des classes Tailwind responsives -->
                        <div class="flex flex-col md:grid md:grid-cols-[1fr_3fr_1fr] items-center gap-2 md:gap-4">
                            <label for="frng_slider" class="font-medium w-full md:w-auto">FRNG (€)</label>
                            <input type="range" id="frng_slider" min="-50000" max="100000" value="38300" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="frng_value" class="font-mono text-center p-2 bg-white border rounded w-full md:w-auto">38300</span>
                        </div>
                        <div class="flex flex-col md:grid md:grid-cols-[1fr_3fr_1fr] items-center gap-2 md:gap-4">
                            <label for="bfr_slider" class="font-medium w-full md:w-auto">BFR (€)</label>
                            <input type="range" id="bfr_slider" min="-50000" max="100000" value="23500" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="bfr_value" class="font-mono text-center p-2 bg-white border rounded w-full md:w-auto">23500</span>
                        </div>
                    </div>
                </div>

                <!-- Visual Representation -->
                <div class="mt-8 pt-6 border-t">
                    <h3 class="text-center font-bold text-xl mb-6">Visualisation de l'Équilibre</h3>
                    <div class="space-y-4 max-w-2xl mx-auto">
                        <!-- FRNG Bar -->
                        <div>
                            <div class="flex justify-between text-sm font-medium text-gray-600 mb-1"><span>Fonds de Roulement (Marge de sécurité)</span><span id="frng_bar_value"></span></div>
                            <div class="w-full bg-gray-200 rounded-full h-6">
                                <div id="frng_bar" class="h-6 rounded-full transition-all duration-300 ease-in-out"></div>
                            </div>
                        </div>
                        <!-- BFR Bar -->
                        <div>
                            <div class="flex justify-between text-sm font-medium text-gray-600 mb-1"><span>Besoin en Fonds de Roulement (Besoin à financer)</span><span id="bfr_bar_value"></span></div>
                            <div class="w-full bg-gray-200 rounded-full h-6">
                                <div id="bfr_bar" class="h-6 rounded-full transition-all duration-300 ease-in-out"></div>
                            </div>
                        </div>
                        <!-- TN Bar -->
                        <div>
                            <div class="flex justify-between text-sm font-bold mb-1"><span>Trésorerie Nette (Résultat)</span><span id="tn_bar_value"></span></div>
                            <div class="w-full bg-gray-200 rounded-full h-8 relative overflow-hidden">
                                <div class="absolute w-full h-full border-l-2 border-gray-400 border-dashed" style="left: 50%;"></div>
                                <div id="tn_bar" class="h-8 rounded-full transition-all duration-300 ease-in-out"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Diagnostic Text -->
                <div class="mt-8">
                    <h3 class="text-center font-bold text-xl">Diagnostic</h3>
                    <div id="diagnostic_box" class="mt-4 p-4 rounded-md text-center text-white font-medium">
                        <p id="diagnostic_text"></p>
                    </div>
                </div>
            `,
            ressources: `
                <h2>Glossaire & FAQ</h2>
                <p>Retrouvez ici les définitions des termes clés et les réponses aux questions les plus fréquentes pour approfondir votre compréhension.</p>
                
                <h3 class="mt-6">Glossaire des Termes Clés</h3>
                <div class="space-y-4">
                    <details class="bg-gray-50 p-4 rounded-lg border border-gray-200 transition duration-300">
                        <summary class="font-semibold">Actif Immobilisé</summary>
                        <p class="mt-2 text-sm text-gray-700">Biens destinés à être utilisés durablement (plus d’un an) par l'entreprise, comme les bâtiments, les machines, ou les logiciels. C’est le socle de l’outil de production.</p>
                    </details>
                    <details class="bg-gray-50 p-4 rounded-lg border border-gray-200 transition duration-300">
                        <summary class="font-semibold">Capitaux Propres</summary>
                        <p class="mt-2 text-sm text-gray-700">Ressources stables appartenant aux propriétaires de l'entreprise (actionnaires/associés). Ils comprennent le capital social, les réserves (bénéfices non distribués) et le résultat de l'année. C'est l'argent qui n'a pas à être remboursé.</p>
                    </details>
                    <details class="bg-gray-50 p-4 rounded-lg border border-gray-200 transition duration-300">
                        <summary class="font-semibold">Fonds de Roulement Net Global (FRNG)</summary>
                        <p class="mt-2 text-sm text-gray-700">C'est l'excédent des ressources stables (capitaux propres + dettes à long terme) après avoir financé tous les emplois stables (les immobilisations). C'est une marge de sécurité financière pour financer l'activité quotidienne.</p>
                    </details>
                    <details class="bg-gray-50 p-4 rounded-lg border border-gray-200 transition duration-300">
                        <summary class="font-semibold">Besoin en Fonds de Roulement (BFR)</summary>
                        <p class="mt-2 text-sm text-gray-700">C'est le montant d'argent nécessaire pour financer le décalage de trésorerie lié au cycle d'exploitation. Concrètement, c'est l'argent "dehors" (stocks, créances clients) moins l'argent que l'on doit à court terme (dettes fournisseurs).</p>
                    </details>
                    <details class="bg-gray-50 p-4 rounded-lg border border-gray-200 transition duration-300">
                        <summary class="font-semibold">Trésorerie Nette (TN)</summary>
                        <p class="mt-2 text-sm text-gray-700">C'est le solde final, l'argent réellement disponible sur les comptes en banque de l'entreprise. Elle est le résultat de la confrontation entre le FRNG et le BFR (TN = FRNG - BFR).</p>
                    </details>
                </div>

                <h3 class="mt-8">Foire Aux Questions (FAQ)</h3>
                <div class="space-y-4">
                    <details class="bg-gray-50 p-4 rounded-lg border border-gray-200 transition duration-300">
                        <summary class="font-semibold">Pourquoi mon entreprise peut-elle être rentable mais avoir des problèmes de trésorerie ?</summary>
                        <p class="mt-2 text-sm text-gray-700">C'est une situation classique liée à un <strong>BFR élevé</strong>. Vous pouvez vendre beaucoup (rentabilité), mais si vos clients vous paient à 60 jours alors que vous payez vos fournisseurs à 30 jours, vous avez un besoin de financement de 30 jours à combler. Une forte croissance mal financée peut ainsi "brûler" la trésorerie et mettre en danger une entreprise pourtant rentable.</p>
                    </details>
                    <details class="bg-gray-50 p-4 rounded-lg border border-gray-200 transition duration-300">
                        <summary class="font-semibold">Un BFR négatif, est-ce toujours une bonne chose ?</summary>
                        <p class="mt-2 text-sm text-gray-700">Oui, c'est un modèle économique très vertueux. Un BFR négatif (ou une Ressource en Fonds de Roulement) signifie que votre cycle d'exploitation génère de la trésorerie. C'est typique de la grande distribution : le client paie comptant, les stocks tournent très vite et les fournisseurs sont payés avec un long délai. L'activité finance non seulement elle-même, mais aussi potentiellement les investissements.</p>
                    </details>
                    <details class="bg-gray-50 p-4 rounded-lg border border-gray-200 transition duration-300">
                        <summary class="font-semibold">Quelle est la première chose à regarder dans un bilan ?</summary>
                        <p class="mt-2 text-sm text-gray-700">Pour un diagnostic rapide, regardez deux choses : <strong>1. Le niveau des capitaux propres :</strong> sont-ils positifs et significatifs ? C'est le signe de la solidité de base. <strong>2. La trésorerie nette (Disponibilités) :</strong> est-elle positive ? Une trésorerie négative est un signal d'alarme immédiat. Ensuite, l'analyse du FRNG et du BFR permet de comprendre le "pourquoi" de cette situation.</p>
                    </details>
                </div>
            `,
            quiz: `
                <h2>Quiz d'Évaluation</h2>
                <p>Testez vos connaissances et validez votre compréhension des concepts clés. Vous devez obtenir au moins 75% de bonnes réponses pour réussir.</p>
                <div id="quiz-container" class="mt-6"></div>
            `,
            synthese: `
                <h2>Synthèse - Carte Mentale</h2>
                <p>Cette carte mentale interactive résume les points essentiels de l'analyse de l'équilibre financier. Naviguez à travers les différentes branches pour réviser les définitions, les formules et les liens entre les concepts.</p>
                <!-- MODIFICATION 4: Hauteur fixe remplacée par des classes d'aspect-ratio responsives -->
                <div class="w-full aspect-[4/3] md:aspect-video max-h-[750px] border border-gray-200 rounded-lg overflow-hidden mt-6 shadow-lg">
                    <iframe class="w-full h-full" src='https://www.xmind.app/embed/pDBNbt/' frameborder='0' scrolling='no' allowfullscreen="true"></iframe>
                </div>
            `
        }
    };
            
    const quizData = [
        {
            question: "L'Actif d'un bilan représente ce que l'entreprise doit à ses partenaires.",
            type: "tf",
            options: ["Vrai", "Faux"],
            correctAnswer: 1,
            hint: "Pensez à la signification du mot 'Actif'. Est-ce quelque chose que l'on possède ou que l'on doit ?",
            feedback: {
                correct: "Exact ! L'Actif représente ce que l'entreprise possède (ses biens, ses créances), tandis que le Passif représente ce qu'elle doit (ses dettes et ses capitaux propres).",
                incorrect: "Incorrect. L'Actif représente ce que l'entreprise POSSÈDE (ses emplois). C'est le Passif qui représente l'origine des fonds, c'est-à-dire ce que l'entreprise doit (ses ressources)."
            }
        },
        {
            question: "Quelle est la formule fondamentale de l'équilibre financier ?",
            type: "mc",
            options: ["TN = FRNG + BFR", "BFR = TN - FRNG", "TN = FRNG - BFR", "FRNG = BFR - TN"],
            correctAnswer: 2,
            hint: "La trésorerie est ce qu'il reste de la marge de sécurité (FRNG) une fois que le besoin de l'activité (BFR) a été couvert.",
            feedback: {
                correct: "Bravo ! La Trésorerie Nette est bien le résultat de la soustraction entre le Fonds de Roulement Net Global et le Besoin en Fonds de Roulement. C'est l'équation clé de l'analyse.",
                incorrect: "Attention, la Trésorerie Nette (TN) est le surplus qui reste du FRNG après avoir financé le BFR. La bonne formule est donc TN = FRNG - BFR."
            }
        },
        {
            question: "Un BFR (Besoin en Fonds de Roulement) négatif est toujours un signe de mauvaise gestion.",
            type: "tf",
            options: ["Vrai", "Faux"],
            correctAnswer: 1,
            hint: "Pensez au modèle de la grande distribution : ils sont payés par les clients avant de payer leurs fournisseurs.",
            feedback: {
                correct: "Tout à fait ! Un BFR négatif est un modèle très vertueux. Cela signifie que le cycle d'exploitation génère de la trésorerie au lieu d'en consommer. C'est une Ressource en Fonds de Roulement.",
                incorrect: "C'est l'inverse ! Un BFR négatif est un excellent signe. Cela signifie que l'entreprise encaisse l'argent de ses clients avant de devoir payer ses fournisseurs, ce qui génère un excédent de trésorerie."
            }
        },
        {
            question: "Lequel de ces éléments n'appartient PAS à l'Actif Immobilisé ?",
            type: "mc",
            options: ["Un bâtiment", "Un stock de marchandises", "Un logiciel", "Une machine-outil"],
            correctAnswer: 1,
            hint: "L'actif immobilisé est destiné à rester durablement dans l'entreprise. Un de ces éléments est destiné à être vendu rapidement.",
            feedback: {
                correct: "Parfait ! Les stocks de marchandises font partie de l'Actif Circulant car ils sont destinés à être vendus et renouvelés rapidement, dans le cadre du cycle d'exploitation.",
                incorrect: "Incorrect. Un stock de marchandises appartient à l'Actif Circulant. Les bâtiments, logiciels et machines sont des biens durables, donc de l'Actif Immobilisé."
            }
        },
        {
            question: "Un FRNG positif signifie que les ressources stables sont suffisantes pour financer les emplois stables.",
            type: "tf",
            options: ["Vrai", "Faux"],
            correctAnswer: 0,
            hint: "Le FRNG est calculé par : Ressources Stables - Emplois Stables.",
            feedback: {
                correct: "Exact ! Un FRNG positif indique qu'après avoir financé tous ses investissements à long terme, il reste à l'entreprise un excédent de ressources stables pour financer son cycle d'exploitation. C'est une marge de sécurité.",
                incorrect: "Incorrect. La définition est juste. Un FRNG positif est le signe que les ressources à long terme (capitaux propres, dettes financières) sont supérieures aux emplois à long terme (immobilisations)."
            }
        },
        {
            question: "Pour améliorer sa trésorerie, un manager doit chercher à :",
            type: "mc",
            options: ["Augmenter le délai de paiement des clients", "Diminuer le délai de paiement aux fournisseurs", "Augmenter la rotation des stocks", "Augmenter le BFR"],
            correctAnswer: 2,
            hint: "Pour avoir plus de cash, il faut que l'argent 'dorme' le moins longtemps possible.",
            feedback: {
                correct: "Excellent ! Augmenter la rotation des stocks signifie vendre plus vite. L'argent investi dans la marchandise est ainsi récupéré plus rapidement, ce qui améliore directement la trésorerie.",
                incorrect: "Attention. Pour améliorer la trésorerie, il faut accélérer les rentrées d'argent et ralentir les sorties. La bonne action est donc d'augmenter la rotation des stocks (vendre plus vite)."
            }
        },
        {
            question: "Le bilan fonctionnel reclasse les éléments du bilan par cycle économique (investissement, financement, exploitation).",
            type: "tf",
            options: ["Vrai", "Faux"],
            correctAnswer: 0,
            hint: "Le bilan fonctionnel s'intéresse à la 'fonction' de chaque poste pour l'entreprise.",
            feedback: {
                correct: "C'est exact. Contrairement au bilan comptable (vision patrimoniale), le bilan fonctionnel adopte une vision économique pour analyser comment l'entreprise finance ses différents cycles.",
                incorrect: "C'est pourtant bien sa définition. Le bilan fonctionnel réorganise le bilan comptable pour faire apparaître les grands cycles et calculer le FRNG et le BFR."
            }
        },
        {
            question: "Une entreprise a un FRNG de 50 000 € et un BFR de 65 000 €. Quelle est sa situation ?",
            type: "mc",
            options: ["Trésorerie excédentaire de 15 000 €", "Trésorerie déficitaire de 15 000 €", "Trésorerie à l'équilibre", "Impossible à dire"],
            correctAnswer: 1,
            hint: "Appliquez la formule TN = FRNG - BFR.",
            feedback: {
                correct: "Bien joué ! Avec TN = 50 000 - 65 000 = -15 000 €, la trésorerie est déficitaire. La marge de sécurité (FRNG) est insuffisante pour couvrir le besoin de l'exploitation (BFR).",
                incorrect: "Le calcul est TN = FRNG - BFR, soit 50 000 € - 65 000 € = -15 000 €. La trésorerie est donc déficitaire. La marge de sécurité est trop faible."
            }
        },
        {
            question: "Les Dettes Fournisseurs sont une ressource de financement pour l'entreprise.",
            type: "tf",
            options: ["Vrai", "Faux"],
            correctAnswer: 0,
            hint: "Quand un fournisseur vous accorde un délai de paiement, il vous fait en quelque sorte un 'crédit' gratuit.",
            feedback: {
                correct: "Parfaitement vrai. Le délai de paiement accordé par les fournisseurs est une forme de crédit à court terme, sans intérêt, qui aide à financer le cycle d'exploitation de l'entreprise.",
                incorrect: "C'est pourtant vrai. En vous autorisant à payer plus tard, votre fournisseur vous permet d'utiliser cet argent pour autre chose en attendant. C'est donc bien une ressource."
            }
        },
        {
            question: "Le Ratio d'Indépendance Financière (Dettes / Capitaux Propres) doit idéalement être :",
            type: "mc",
            options: ["Le plus élevé possible", "Supérieur à 2", "Inférieur à 1", "Négatif"],
            correctAnswer: 2,
            hint: "Ce ratio mesure la dépendance aux banques. Moins on est dépendant, mieux c'est.",
            feedback: {
                correct: "Exact. Un ratio inférieur à 1 signifie que l'entreprise possède plus de capitaux propres que de dettes. Elle est donc financée majoritairement par ses fonds propres, ce qui est un signe de solidité.",
                incorrect: "Non, un ratio élevé serait un signe de dépendance forte vis-à-vis des banques. Un ratio inférieur à 1 est un objectif sain, car il signifie que les capitaux propres sont supérieurs aux dettes."
            }
        },
        {
            question: "Une forte croissance des ventes peut entraîner des difficultés de trésorerie.",
            type: "tf",
            options: ["Vrai", "Faux"],
            correctAnswer: 0,
            hint: "Qui dit plus de ventes dit souvent plus de stocks à financer et plus de créances clients qui augmentent.",
            feedback: {
                correct: "C'est un paradoxe classique, et c'est tout à fait vrai. Une forte croissance augmente mécaniquement le BFR (plus de stocks, plus de créances). Si ce BFR n'est pas financé par un FRNG suffisant, la trésorerie peut devenir négative.",
                incorrect: "Attention, c'est vrai. C'est le cas typique de la 'croissance non financée'. Vendre plus nécessite de financer plus de stocks et d'attendre le paiement de plus de clients. Si on n'a pas la marge de sécurité (FRNG), la trésorerie plonge."
            }
        },
        {
            question: "Dans le bilan fonctionnel, les amortissements sont considérés comme :",
            type: "mc",
            options: ["Une dette à court terme", "Une ressource stable", "Un emploi stable", "Une charge de trésorerie"],
            correctAnswer: 1,
            hint: "L'amortissement est une charge 'non décaissée'. L'argent ne sort pas, il reste dans l'entreprise.",
            feedback: {
                correct: "Très juste ! C'est un point clé. Les amortissements sont une charge qui ne génère pas de sortie de cash. Cet 'argent mis de côté' est donc considéré comme une ressource d'autofinancement, qui vient renforcer les ressources stables.",
                incorrect: "Incorrect. C'est une notion subtile mais essentielle. L'amortissement est une charge comptable, mais pas une sortie d'argent. Il est donc considéré comme une ressource stable (autofinancement) dans l'analyse fonctionnelle."
            }
        }
    ];

    // --- LOGIC ---
    const navigation = document.getElementById('navigation');
    const moduleContainer = document.getElementById('module-container');
    const modal = document.getElementById('definitionModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalContent = document.getElementById('modalContent');
    let activeModule = courseData.modules[0].id;
    
    // Quiz state
    let currentQuestionIndex = 0;
    let score = 0;
    let userAnswers = [];

    // --- Functions ---
    
    function renderNavigation() {
        navigation.innerHTML = '';
        courseData.modules.forEach(module => {
            const link = document.createElement('a');
            link.href = '#';
            link.textContent = module.title;
            link.dataset.moduleId = module.id;
            const isActive = module.id === activeModule;
            link.className = `px-4 py-2 rounded-md transition hover:bg-gray-700 ${isActive ? 'bg-teal-600 font-semibold' : ''}`;
            link.onclick = (e) => {
                e.preventDefault();
                setActiveModule(module.id);
            };
            navigation.appendChild(link);
        });
    }

    function renderModuleContent() {
        moduleContainer.innerHTML = courseData.content[activeModule] || '';
        if (activeModule === 'simulateur') initSimulator();
        if (activeModule === 'ratios') {
            calculateIndependance();
            calculateRotationStock();
        }
        if (activeModule === 'quiz') initQuiz();
    }

    function setActiveModule(moduleId) {
        activeModule = moduleId;
        renderNavigation();
        renderModuleContent();
    }

    function showDefinition(title, content) {
        modalTitle.textContent = title;
        modalContent.innerHTML = content;
        modal.classList.remove('hidden');
    }

    function closeModal() {
        modal.classList.add('hidden');
    }

    function calculateIndependance() { 
        const dettes = parseFloat(document.getElementById('dettes_fin').value) || 0;
        const capitaux = parseFloat(document.getElementById('capitaux').value) || 1; // Use 1 to prevent division by zero
        const result = (dettes / capitaux);
        const resultSpan = document.getElementById('result_independance');
        const interpP = document.getElementById('interp_independance');

        if (resultSpan) resultSpan.textContent = result.toFixed(2);
        
        if (interpP) {
            if (result < 1) {
                interpP.textContent = "Situation saine. Les capitaux propres sont supérieurs aux dettes financières.";
                interpP.className = "text-sm mt-1 text-green-600";
            } else if (result >= 1 && result <= 1.5) {
                 interpP.textContent = "Zone de vigilance. L'endettement est significatif.";
                interpP.className = "text-sm mt-1 text-yellow-600";
            } else {
                interpP.textContent = "Risque élevé. Les banques 'possèdent' une plus grande partie de l'entreprise que les actionnaires.";
                interpP.className = "text-sm mt-1 text-red-600";
            }
        }
    }

    function calculateRotationStock() { 
        const stock = parseFloat(document.getElementById('stock_moyen').value) || 0;
        const achats = parseFloat(document.getElementById('achats_ht').value) || 1; // Use 1 to prevent division by zero
        const result = ((stock / achats) * 360);
        const resultSpan = document.getElementById('result_stock');
        const interpP = document.getElementById('interp_stock');

        if (resultSpan) resultSpan.textContent = `${result.toFixed(1)} jours`;
        
        if (interpP) {
            if (result < 45) {
                interpP.textContent = "Rotation rapide. Les stocks sont bien gérés et l'argent est rapidement converti en ventes.";
                interpP.className = "text-sm mt-1 text-green-600";
            } else if (result >= 45 && result <= 90) {
                interpP.textContent = "Rotation correcte, mais pourrait être optimisée. Surveiller les stocks à faible rotation.";
                interpP.className = "text-sm mt-1 text-yellow-600";
            } else {
                interpP.textContent = "Attention, rotation lente. Risque d'invendus, de dépréciation et d'immobilisation excessive de trésorerie.";
                interpP.className = "text-sm mt-1 text-red-600";
            }
        }
    }

    function initSimulator() { /* ... function code ... */ }
    function updateSimulator() { /* ... function code ... */ }

    // --- Quiz Functions ---
    function initQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        userAnswers = [];
        const quizContainer = document.getElementById('quiz-container');
        quizContainer.innerHTML = `
            <div class="text-center">
                <button id="start-quiz-btn" class="cta-button bg-teal-600 hover:bg-teal-700 text-lg px-8 py-3">Commencer le quiz</button>
            </div>
        `;
        document.getElementById('start-quiz-btn').addEventListener('click', displayQuestion);
    }

    function displayQuestion() {
        const quizContainer = document.getElementById('quiz-container');
        const question = quizData[currentQuestionIndex];
        const progress = ((currentQuestionIndex) / quizData.length) * 100;

        quizContainer.innerHTML = `
            <!-- Progress Bar -->
            <div>
                <div class="flex justify-between mb-1">
                    <span class="text-base font-medium text-gray-700">Progression</span>
                    <span class="text-sm font-medium text-gray-700">Question ${currentQuestionIndex + 1} / ${quizData.length}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="bg-teal-600 h-2.5 rounded-full" style="width: ${progress}%"></div>
                </div>
            </div>

            <!-- Question -->
            <div class="mt-8 bg-gray-50 p-6 rounded-lg">
                <div class="flex justify-between items-start">
                    <p class="text-lg font-semibold">${question.question}</p>
                    <button id="hint-btn" class="text-gray-500 hover:text-teal-600 transition">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10s10-4.47 10-10S17.53 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                    </button>
                </div>
                <div id="hint-box" class="hidden mt-2 p-3 bg-yellow-100 border-l-4 border-yellow-400 text-yellow-700 text-sm">
                    ${question.hint}
                </div>
                <div id="options-container" class="mt-4">
                    ${question.options.map((option, index) => `
                        <label class="quiz-option" data-index="${index}">
                            <input type="radio" name="quiz-option" class="hidden">
                            <span>${option}</span>
                        </label>
                    `).join('')}
                </div>
            </div>
            
            <!-- Feedback and Navigation -->
            <div id="feedback-container" class="mt-4"></div>
            <div class="mt-6 flex justify-end">
                <button id="submit-btn" class="cta-button" disabled>Valider</button>
                <button id="next-btn" class="cta-button hidden">Question Suivante</button>
            </div>
        `;

        document.getElementById('hint-btn').addEventListener('click', () => {
            document.getElementById('hint-box').classList.toggle('hidden');
        });

        const options = document.querySelectorAll('.quiz-option');
        let selectedOption = null;
        options.forEach(option => {
            option.addEventListener('click', () => {
                if (option.classList.contains('disabled')) return;
                options.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedOption = option;
                document.getElementById('submit-btn').disabled = false;
            });
        });

        document.getElementById('submit-btn').addEventListener('click', () => checkAnswer(selectedOption));
        document.getElementById('next-btn').addEventListener('click', nextQuestion);
    }
    
    function checkAnswer(selectedOption) {
        if (!selectedOption) return;
        const question = quizData[currentQuestionIndex];
        const selectedIndex = parseInt(selectedOption.dataset.index);
        const isCorrect = selectedIndex === question.correctAnswer;
        const feedbackContainer = document.getElementById('feedback-container');

        if (isCorrect) {
            score++;
            selectedOption.classList.add('correct');
            feedbackContainer.innerHTML = `<div class="p-4 bg-green-100 border-l-4 border-green-500 text-green-700">${question.feedback.correct}</div>`;
        } else {
            selectedOption.classList.add('incorrect');
            document.querySelectorAll('.quiz-option')[question.correctAnswer].classList.add('correct');
             feedbackContainer.innerHTML = `<div class="p-4 bg-red-100 border-l-4 border-red-500 text-red-700">${question.feedback.incorrect}</div>`;
        }

        document.querySelectorAll('.quiz-option').forEach(opt => opt.classList.add('disabled'));
        document.getElementById('submit-btn').classList.add('hidden');
        document.getElementById('next-btn').classList.remove('hidden');
        
        // Update final progress bar
        const progress = ((currentQuestionIndex + 1) / quizData.length) * 100;
        document.querySelector('.bg-teal-600.h-2\\.5.rounded-full').style.width = `${progress}%`
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < quizData.length) {
            displayQuestion();
        } else {
            showResults();
        }
    }

    function showResults() {
        const quizContainer = document.getElementById('quiz-container');
        const finalScore = (score / quizData.length) * 100;
        const success = finalScore >= 75;

        quizContainer.innerHTML = `
            <div class="text-center p-6 bg-gray-50 rounded-lg">
                 <h3 class="text-2xl font-bold">${success ? 'Félicitations, vous avez réussi !' : 'Continuez vos efforts !'}</h3>
                 <p class="mt-2 text-lg">Votre score :</p>
                 <p class="text-5xl font-bold my-4 ${success ? 'text-green-600' : 'text-red-600'}">${finalScore.toFixed(0)}%</p>
                 <p class="text-gray-600">Vous avez répondu correctement à ${score} question(s) sur ${quizData.length}.</p>
                 <p class="mt-4">${success ? 'Vous avez une solide compréhension des concepts clés de l\'analyse financière.' : 'N\'hésitez pas à revoir les modules pour renforcer vos connaissances avant de retenter.'}</p>
                 <button id="restart-quiz-btn" class="cta-button mt-6 bg-teal-600 hover:bg-teal-700">Recommencer le quiz</button>
            </div>
        `;
        document.getElementById('restart-quiz-btn').addEventListener('click', initQuiz);
    }
    
    // --- Initial Load ---
    document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const openMenuBtn = document.getElementById('open-menu-btn');
        const navigationLinks = document.getElementById('navigation');

        function toggleMenu() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        openMenuBtn.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);
        
        // Close menu when a nav link is clicked on mobile
        navigationLinks.addEventListener('click', (e) => {
            if (e.target.tagName === 'A' && window.innerWidth < 768) {
                toggleMenu();
            }
        });
        
        setActiveModule(courseData.modules[0].id);
        
        // --- Dummy function fills for brevity ---
        // calculateIndependance = () => { if(document.getElementById('result_independance')) document.getElementById('result_independance').textContent = '0.91'; if(document.getElementById('interp_independance')) {document.getElementById('interp_independance').textContent = "Situation saine."; document.getElementById('interp_independance').className = "text-sm mt-1 text-green-600"} };
        // calculateRotationStock = () => { if(document.getElementById('result_stock')) document.getElementById('result_stock').textContent = '39.1 jours'; if(document.getElementById('interp_stock')) {document.getElementById('interp_stock').textContent = "Rotation rapide."; document.getElementById('interp_stock').className = "text-sm mt-1 text-green-600"}};
        initSimulator = () => { if(document.getElementById('frng_slider')) { document.getElementById('frng_slider').addEventListener('input', updateSimulator); document.getElementById('bfr_slider').addEventListener('input', updateSimulator); updateSimulator();}};
        updateSimulator = () => { if(document.getElementById('frng_value')) {
             const frng = parseInt(document.getElementById('frng_slider').value);
             const bfr = parseInt(document.getElementById('bfr_slider').value);
             const tn = frng - bfr;
             document.getElementById('frng_value').textContent = frng;
             document.getElementById('bfr_value').textContent = bfr;
             if(document.getElementById('diagnostic_text')) {document.getElementById('diagnostic_text').textContent = '...';}

             const frngBar = document.getElementById('frng_bar');
             const bfrBar = document.getElementById('bfr_bar');
             const tnBar = document.getElementById('tn_bar');
             if(frngBar && bfrBar && tnBar) {
                const sliderMax = 100000;
                const tnRangeMax = 150000;
                document.getElementById('frng_bar_value').textContent = `${frng.toLocaleString('fr-FR')} €`;
                document.getElementById('bfr_bar_value').textContent = `${bfr.toLocaleString('fr-FR')} €`;
                document.getElementById('tn_bar_value').textContent = `${tn.toLocaleString('fr-FR')} €`;
                frngBar.style.width = `${(Math.max(0, frng) / sliderMax) * 100}%`;
                frngBar.style.backgroundColor = frng < 0 ? '#ef4444' : '#3b82f6';
                bfrBar.style.width = `${(Math.max(0, bfr) / sliderMax) * 100}%`;
                bfrBar.style.backgroundColor = bfr < 0 ? '#14b8a6' : '#f97316';
                tnBar.classList.add('absolute');
                const tnPercentOfRange = (Math.abs(tn) / tnRangeMax) * 50;
                 if (tn >= 0) { tnBar.style.left = '50%'; tnBar.style.width = `${tnPercentOfRange}%`; tnBar.style.backgroundColor = '#22c55e';} 
                 else { tnBar.style.left = `${50 - tnPercentOfRange}%`; tnBar.style.width = `${tnPercentOfRange}%`; tnBar.style.backgroundColor = '#ef4444';}
                 
                if (frng > 0 && bfr >= 0 && tn >= 0) { document.getElementById('diagnostic_box').className = 'p-4 rounded-md text-center text-white font-medium bg-green-600'; document.getElementById('diagnostic_text').textContent = "Situation 1 : Équilibre financier sain.";} 
                else if (frng > 0 && bfr > 0 && tn < 0) { document.getElementById('diagnostic_box').className = 'p-4 rounded-md text-center text-white font-medium bg-yellow-500 text-yellow-900'; document.getElementById('diagnostic_text').textContent = "Situation 2 : Équilibre précaire.";} 
                else if (frng < 0 && bfr > 0 && tn < 0) { document.getElementById('diagnostic_box').className = 'p-4 rounded-md text-center text-white font-medium bg-red-600'; document.getElementById('diagnostic_text').textContent = "Situation 3 : Déséquilibre financier grave.";} 
                else if (bfr < 0) { document.getElementById('diagnostic_box').className = 'p-4 rounded-md text-center text-white font-medium bg-cyan-600'; document.getElementById('diagnostic_text').textContent = "Situation 4 : Modèle économique spécifique.";} 
                else { document.getElementById('diagnostic_box').className = 'p-4 rounded-md text-center text-white font-medium bg-gray-500'; document.getElementById('diagnostic_text').textContent = "Situation intermédiaire."; }
             }
        }};
    });

</script>

</body>
</html>