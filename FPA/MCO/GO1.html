<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observer les Op√©rations Courantes de l'Unit√© Commerciale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: L'application est structur√©e en quatre modules th√©matiques interactifs plut√¥t qu'en chapitres lin√©aires. 1) Une comparaison c√¥te √† c√¥te des 3 cycles fondamentaux pour une distinction claire. 2) Un s√©lecteur d'activit√© dynamique qui met √† jour un diagramme et un graphique pour visualiser les variations du cycle d'exploitation. 3) Une chronologie interactive du flux de transaction, du devis √† la facture, avec une facture "cliquable" pour explorer les mentions l√©gales. 4) Un calculateur de BFR interactif pour que l'utilisateur puisse manipuler les variables et voir l'impact sur la tr√©sorerie. Cette structure a √©t√© choisie pour transformer la lecture passive en une exploration active et pratique, facilitant la compr√©hension de concepts complexes comme le BFR par la simulation. -->
    <!-- Visualization & Content Choices: 1. Comparaison des cycles -> Cartes HTML/Tailwind -> Interaction au survol -> Clart√© et comparaison directe. 2. Variation des cycles par activit√© -> Diagramme HTML/Flexbox et graphique √† barres Chart.js -> Interaction via boutons -> Visualisation dynamique des diff√©rences de processus et d'impact financier (BFR). 3. Flux documentaire -> Chronologie HTML/CSS -> Clic pour d√©tails -> Montre la s√©quence logique et l'importance de chaque document. 4. Calcul du BFR -> Formulaire avec sliders et graphique √† barres Chart.js -> Mise √† jour en temps r√©el -> D√©mystifie une formule comptable en une exp√©rience de simulation tangible. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #383838;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Conserve pour les √©crans plus larges */
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Hauteur de base */
            min-height: 250px; /* Assure une hauteur minimale sur mobile */
            max-height: 400px;
        }
        @media (max-width: 767px) { /* Pour les petits √©crans sp√©cifiquement */
            .chart-container {
                height: 250px; /* L√©g√®rement r√©duit pour les mobiles */
                max-width: 95%; /* S'adapte mieux au viewport */
            }
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .nav-link {
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: #D97706;
            border-bottom-color: #D97706;
        }
        .btn-primary {
            background-color: #D97706;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #B45309;
        }
        .btn-secondary {
            background-color: #F3F4F6;
            color: #374151;
            transition: background-color 0.3s;
        }
        .btn-secondary.active {
            background-color: #D97706;
            color: white;
        }
        .card {
            background-color: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .flow-step {
            border-left: 3px solid #D1D5DB;
            transition: border-color 0.3s;
            cursor: pointer; /* Added cursor for clickability */
        }
        .flow-step:hover {
            border-left-color: #D97706;
        }
        /* Generic tooltip style - hidden by default */
        .tooltip {
            position: absolute;
            display: none;
            background-color: #1F2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            z-index: 10;
            white-space: pre-wrap;
            max-width: 250px; /* Use max-width for responsiveness */
            pointer-events: none; /* Prevent tooltip from intercepting mouse events */
        }

        /* Styling for the info icon */
        .info-icon {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1rem;
            height: 1rem;
            border-radius: 9999px;
            background-color: #D97706;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            line-height: 1rem; /* Center the 'i' vertically */
            vertical-align: middle; /* Align with text */
            position: relative; /* Make it a positioning context for nested tooltips */
            margin-left: 0.25rem; /* Small space after text */
        }
        /* Specific tooltip positioning for info-icons (e.g., in BFR labels and Facture) */
        .info-icon .tooltip {
            left: 100%; /* Position to the right of the icon */
            transform: translateX(0) translateY(-50%); /* Align vertically with icon */
            top: 50%;
            margin-left: 0.5rem; /* Space between icon and tooltip */
            display: none; /* Hidden by default */
        }
        /* Override for tooltips that should appear to the left (e.g., end-of-line elements) */
        .info-icon.tooltip-left .tooltip {
            left: auto; /* Reset left */
            right: 100%; /* Position to the left of the icon */
            margin-left: 0; /* Reset margin-left */
            margin-right: 0.5rem; /* Space between icon and tooltip */
            transform: translateX(0) translateY(-50%); /* Keep vertical alignment */
        }

        /* Show tooltip on group hover */
        .group:hover .tooltip {
            display: block;
        }


        /* Quiz specific styles */
        .quiz-option-btn {
            background-color: #F3F4F6;
            color: #374151;
            padding: 0.75rem 1.25rem;
            border-radius: 0.375rem;
            font-weight: 500;
            text-align: left;
            width: 100%;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
            border: 1px solid #E5E7EB;
        }
        .quiz-option-btn:hover:not(:disabled) {
            background-color: #E5E7EB;
        }
        .quiz-option-btn.selected {
            background-color: #FDFBF8;
            border-color: #D97706;
            color: #D97706;
        }
        .quiz-option-btn.correct {
            background-color: #D1FAE5; /* green-100 */
            border-color: #10B981; /* green-500 */
            color: #065F46; /* green-900 */
        }
        .quiz-option-btn.incorrect {
            background-color: #FEE2E2; /* red-100 */
            border-color: #EF4444; /* red-500 */
            color: #991B1B; /* red-900 */
        }
        .quiz-option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.05);
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }
        @media (max-width: 500px) { /* Pour les tr√®s petits √©crans, r√©duire la largeur max */
            .modal-content {
                width: 95%; /* Un peu plus de marge */
                padding: 1.5rem; /* R√©duire le padding */
            }
        }
        .modal.open .modal-content {
            transform: translateY(0);
        }
        /* Assurer le word-break pour le contenu de la modale */
        .modal-content p, .modal-content li {
            word-break: break-word;
            overflow-wrap: break-word; /* Standard plus r√©cent */
        }

        /* Ensure fact-item is relative for tooltip positioning */
        .fact-item {
            position: relative;
            display: inline-block; /* Allow proper sizing for tooltips */
        }

        /* Labels des sliders du BFR */
        .bfr-slider-label {
            display: flex; /* Utiliser flexbox */
            align-items: center; /* Centrer verticalement */
            flex-wrap: wrap; /* Permettre le retour √† la ligne */
            margin-bottom: 0.25rem; /* Ajuster l'espacement si besoin */
            font-weight: 500;
        }

        /* Styles pour les nouvelles cartes du lexique */
        .lexicon-card {
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            background-color: #FDFBF8; /* L√©g√®rement diff√©rent du fond pour les distinguer */
        }
        .lexicon-card summary {
            list-style: none; /* Supprime la fl√®che native du navigateur */
        }
        .lexicon-card summary::-webkit-details-marker { /* Pour Webkit (Chrome, Safari) */
            display: none;
        }
        .lexicon-card details[open] summary {
            border-bottom: 1px solid #E5E7EB; /* Ligne de s√©paration quand ouvert */
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-amber-700">Gestion de l'UC</h1>
            <!-- Mobile Menu Toggle Button -->
            <button id="mobile-menu-toggle" class="md:hidden p-2 rounded-md text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <!-- Desktop Navigation Links -->
            <div id="desktop-nav-links" class="hidden md:flex space-x-8">
                <a href="#video" class="nav-link pb-1">Introduction</a>
                <a href="#cycles" class="nav-link pb-1">Les Cycles</a>
                <a href="#exploitation" class="nav-link pb-1">Le Cycle d'Exploitation</a>
                <a href="#flux" class="nav-link pb-1">Flux & Documents</a>
                <a href="#bfr" class="nav-link pb-1">Tr√©sorerie & BFR</a>
                <a href="#lexique" class="nav-link pb-1">Lexique</a>
                <a href="#faq" class="nav-link pb-1">FAQ</a>
                <a href="#quiz" class="nav-link pb-1">Quiz</a>
                <a href="#synthese" class="nav-link pb-1">Synth√®se</a>
            </div>
        </nav>
        <!-- Mobile Menu Container -->
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg py-4 border-t">
            <div class="container mx-auto px-6 flex flex-col space-y-2">
                 <a href="#video" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">Introduction</a>
                 <a href="#cycles" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">Les Cycles</a>
                 <a href="#exploitation" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">Le Cycle d'Exploitation</a>
                 <a href="#flux" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">Flux & Documents</a>
                 <a href="#bfr" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">Tr√©sorerie & BFR</a>
                 <a href="#lexique" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">Lexique</a>
                 <a href="#faq" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">FAQ</a>
                 <a href="#quiz" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">Quiz</a>
                 <a href="#synthese" class="nav-link block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-md">Synth√®se</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section id="hero" class="text-center mb-20">
            <h2 class="text-4xl md:text-5xl font-bold mb-4">Observer les Op√©rations Courantes</h2>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                Une exploration interactive des cycles, flux et documents qui rythment la vie d'une unit√© commerciale. Passez de la th√©orie √† la pratique.
            </p>
        </section>

        <!-- New Video Introduction Section -->
        <section id="video" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">Introduction Vid√©o : Les Op√©rations Courantes</h3>
                <p class="text-md text-gray-500 mt-2">Pour bien commencer, cette vid√©o pr√©sente les concepts fondamentaux des op√©rations courantes, leur importance en gestion et leur application dans le cadre du BTS MCO.</p>
            </div>
            <div class="card p-2 md:p-4">
                <div style="position: relative; width: 100%; height: 0; padding-top: 56.2500%;
                 padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); overflow: hidden;
                 border-radius: 8px; will-change: transform;">
                  <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
                    src="https://www.canva.com/design/DAGzV8J1OWc/NPKOhNi9_xfuhv2314BpKA/watch?embed" allowfullscreen="allowfullscreen" allow="fullscreen">
                  </iframe>
                </div>
                <p class="text-center text-xs text-gray-500 mt-2">Design by desmond de amil</p>
            </div>
        </section>
        <!-- End New Video Introduction Section -->

        <section id="cycles" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">Les 3 Cycles Fondamentaux de l'Entreprise</h3>
                <p class="text-md text-gray-500 mt-2">Chaque op√©ration s'inscrit dans un cycle sp√©cifique. Comprendre leur distinction est essentiel pour analyser la sant√© de l'entreprise.</p>
            </div>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="card p-6 text-center">
                    <div class="text-4xl mb-4">üèóÔ∏è</div>
                    <h4 class="text-xl font-semibold mb-2">Cycle d'Investissement</h4>
                    <p class="text-gray-600 mb-4">Op√©rations √† long terme (> 1 an) qui fa√ßonnent l'outil de production.</p>
                    <ul class="text-left space-y-2 text-sm">
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> Acquisition/cession d'immobilisations.</li>
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> Engage des ressources financi√®res importantes.</li>
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> Impacte le haut du bilan (Actif immobilis√©).</li>
                    </ul>
                    <button class="text-sm text-amber-600 mt-4 hover:underline" onclick="openInfoModal('investissement')">En savoir plus</button>
                </div>
                <div class="card p-6 text-center">
                    <div class="text-4xl mb-4">üí∞</div>
                    <h4 class="text-xl font-semibold mb-2">Cycle de Financement</h4>
                    <p class="text-gray-600 mb-4">Op√©rations √† long terme visant √† se procurer les capitaux n√©cessaires.</p>
                     <ul class="text-left space-y-2 text-sm">
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> Sources : Apports, emprunts, autofinancement.</li>
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> Structure le passif de l'entreprise.</li>
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> Impacte le haut du bilan (Capitaux propres).</li>
                    </ul>
                    <button class="text-sm text-amber-600 mt-4 hover:underline" onclick="openInfoModal('financement')">En savoir plus</button>
                </div>
                <div class="card p-6 text-center">
                    <div class="text-4xl mb-4">üîÑ</div>
                    <h4 class="text-xl font-semibold mb-2">Cycle d'Exploitation</h4>
                    <p class="text-gray-600 mb-4">Activit√©s courantes et r√©currentes qui g√©n√®rent le chiffre d'affaires.</p>
                     <ul class="text-left space-y-2 text-sm">
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> Court terme (< 1 an) : Achat, production, vente.</li>
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> G√©n√®re le Besoin en Fonds de Roulement (BFR).</li>
                        <li class="flex items-start"><span class="font-bold mr-2 text-amber-600">‚úì</span> Impacte le bas du bilan (Actifs et passifs circulants).</li>
                    </ul>
                    <button class="text-sm text-amber-600 mt-4 hover:underline" onclick="openInfoModal('exploitationCycle')">En savoir plus</button>
                </div>
            </div>
        </section>

        <section id="exploitation" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">Le Cycle d'Exploitation √† la Loupe</h3>
                <p class="text-md text-gray-500 mt-2">Le cycle d'exploitation varie grandement selon le type d'activit√©. S√©lectionnez un secteur pour visualiser son processus et son impact sur le BFR.</p>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <div class="flex justify-center space-x-2 md:space-x-4 mb-8">
                    <button id="btn-indus" class="btn-secondary active px-4 py-2 rounded-md font-semibold">Industrielle</button>
                    <button id="btn-commer" class="btn-secondary px-4 py-2 rounded-md font-semibold">Commerciale</button>
                    <button id="btn-serv" class="btn-secondary px-4 py-2 rounded-md font-semibold">Services</button>
                </div>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h4 id="activity-title" class="text-2xl font-semibold mb-4">Activit√© Industrielle</h4>
                        <p id="activity-desc" class="text-gray-600 mb-6">Processus long et complexe, impliquant la transformation de mati√®res premi√®res en produits finis.</p>
                        <div id="activity-steps" class="space-y-4">
                        </div>
                    </div>
                    <div>
                        <div class="chart-container">
                            <canvas id="bfrImpactChart"></canvas>
                        </div>
                        <p id="bfr-impact-explanation" class="text-center text-sm text-gray-600 mt-4"></p>
                    </div>
                </div>
            </div>
        </section>

        <section id="flux" class="mb-20">
             <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">La Vie d'une Transaction : Flux et Documents</h3>
                <p class="text-md text-gray-500 mt-2">Chaque transaction commerciale g√©n√®re des flux physiques et financiers, mat√©rialis√©s par une cha√Æne de documents officiels. <span class="text-amber-700 font-semibold">Cliquez sur chaque √©tape</span> pour en savoir plus.</p>
            </div>
            <div class="grid md:grid-cols-2 gap-8 md:gap-12">
                <div class="space-y-8">
                    <div class="flow-step pl-6 relative" onclick="openInfoModal('devis')">
                        <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gray-300 rounded-full"></div>
                        <h4 class="font-semibold text-lg flex items-center">
                            1. Devis
                            <span class="info-icon ml-2">i</span>
                        </h4>
                        <p class="text-gray-600">Proposition commerciale formelle. Une fois sign√© "bon pour accord", il engage les deux parties et devient un contrat.</p>
                    </div>
                    <div class="flow-step pl-6 relative" onclick="openInfoModal('bonDeCommande')">
                        <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gray-300 rounded-full"></div>
                        <h4 class="font-semibold text-lg flex items-center">
                            2. Bon de Commande
                            <span class="info-icon ml-2">i</span>
                        </h4>
                        <p class="text-gray-600">Document √©mis par l'acheteur pour confirmer son achat. Il s√©curise la transaction pour le vendeur.</p>
                    </div>
                    <div class="flow-step pl-6 relative" onclick="openInfoModal('bonDeLivraison')">
                         <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gray-300 rounded-full"></div>
                        <h4 class="font-semibold text-lg flex items-center">
                            3. Bon de Livraison & Flux Physique
                            <span class="info-icon ml-2">i</span>
                        </h4>
                        <p class="text-gray-600">Accompagne la marchandise et prouve la r√©ception. C'est la mat√©rialisation du flux physique (le bien change de mains).</p>
                    </div>
                     <div class="flow-step pl-6 relative" onclick="openInfoModal('factureDoc')">
                         <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gray-300 rounded-full"></div>
                        <h4 class="font-semibold text-lg flex items-center">
                            4. Facture & Flux Financier
                            <span class="info-icon ml-2">i</span>
                        </h4>
                        <p class="text-gray-600">Document comptable et l√©gal qui √©tablit la cr√©ance du vendeur et d√©clenche la demande de paiement (le flux financier).</p>
                    </div>
                </div>
                <div class="card p-6">
                    <h4 class="font-semibold text-center text-lg mb-4">Anatomie d'une Facture Conforme</h4>
                    <p class="text-center text-sm text-gray-500 mb-4">Survolez les zones <span class="info-icon ml-1 group">i<span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 200px;">Cliquez ou survolez les √©l√©ments marqu√©s d'un 'i' pour plus de d√©tails.</span></span> pour d√©couvrir les mentions obligatoires.</p>
                    <div class="border border-gray-200 p-4 rounded-md bg-gray-50 text-sm relative">
                        <div class="flex justify-between mb-4">
                            <!-- Facture Item: VOTRE ENTREPRISE -->
                            <div class="fact-item group">
                                <strong>VOTRE ENTREPRISE</strong><span class="info-icon ml-1">i<span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 250px;">D√©nomination sociale, adresse, SIREN, RCS, forme juridique, capital social. Essentiel pour identifier l√©galement le vendeur.</span></span><br>
                                123 Rue du Commerce<br>
                                75001 Paris
                            </div>
                            <div class="text-right">
                                <strong>FACTURE N¬∞ F2025-001</strong><br>
                                <!-- Facture Item: Date - Using tooltip-left for right-aligned elements -->
                                <span class="fact-item group">
                                    Date: 18/09/2025<span class="info-icon ml-1 tooltip-left">i<span class="tooltip group-hover:block absolute right-full mr-2 top-1/2 -translate-y-1/2" style="width: 250px;">La date d'√©mission est cruciale pour le calcul des d√©lais de paiement et l'exigibilit√© de la TVA.</span></span>
                                </span>
                            </div>
                        </div>
                        <!-- Facture Item: Client -->
                        <div class="mb-4 fact-item group">
                            <strong>Client :</strong><span class="info-icon ml-1">i<span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 250px;">Identification compl√®te du client professionnel, incluant son SIREN (obligatoire depuis 2024).</span></span><br>
                            Client Pro SA<br>
                            456 Avenue des Achats<br>
                            69002 Lyon
                        </div>
                        <table class="w-full mb-4">
                           <thead class="bg-gray-200">
                                <tr>
                                    <!-- Facture Item: D√©signation -->
                                    <th class="p-2 text-left fact-item group">
                                        D√©signation<span class="info-icon ml-1">i<span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 250px;">Description pr√©cise des biens ou services vendus. Indispensable pour la validit√© commerciale et fiscale.</span></span>
                                    </th>
                                    <th class="p-2 text-right">Qt√©</th>
                                    <th class="p-2 text-right">P.U. HT</th>
                                    <th class="p-2 text-right">Total HT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b"><td class="p-2">Produit A</td><td class="p-2 text-right">2</td><td class="p-2 text-right">50.00 ‚Ç¨</td><td class="p-2 text-right">100.00 ‚Ç¨</td></tr>
                                <tr class="border-b"><td class="p-2">Service B</td><td class="p-2 text-right">1</td><td class="p-2 text-right">150.00 ‚Ç¨</td><td class="p-2 text-right">150.00 ‚Ç¨</td></tr>
                            </tbody>
                        </table>
                        <div class="flex justify-end">
                            <div class="w-1/2">
                                <!-- Facture Item: Total HT -->
                                <div class="flex justify-between"><span class="fact-item group">Total HT<span class="info-icon ml-1">i<span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 250px;">Le montant total hors taxes est la base de calcul de la TVA.</span></span></span><span>250.00 ‚Ç¨</span></div>
                                <!-- Facture Item: TVA -->
                                <div class="flex justify-between"><span class="fact-item group">TVA (20%)<span class="info-icon ml-1">i<span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 250px;">Taux et montant de TVA. Mention obligatoire pour la collecte et la d√©duction de la taxe.</span></span></span><span>50.00 ‚Ç¨</span></div>
                                <!-- Facture Item: Total TTC -->
                                <div class="flex justify-between font-bold text-base mt-2"><span class="fact-item group">Total TTC<span class="info-icon ml-1">i<span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 250px;">Le montant Toutes Taxes Comprises est la somme que le client doit effectivement payer.</span></span></span><span>300.00 ‚Ç¨</span></div>
                            </div>
                        </div>
                        <!-- Facture Item: Conditions de paiement -->
                        <div class="mt-6 pt-4 border-t fact-item group">
                           <strong>Conditions de paiement :</strong><span class="info-icon ml-1">i<span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 250px;">D√©lai de paiement, taux de p√©nalit√©s de retard, et indemnit√© forfaitaire de 40‚Ç¨ pour frais de recouvrement. Ces mentions sont l√©galement obligatoires.</span></span> Paiement √† 30 jours fin de mois.
                        </div>
                    </div>
                    <div class="mt-6 p-4 bg-red-50 border border-red-200 rounded-md text-sm text-red-800">
                        <h5 class="font-semibold mb-2">Sanctions en cas d'omission de mentions obligatoires sur la facture :</h5>
                        <ul class="list-disc list-inside space-y-1">
                            <li><span class="font-bold">Fiscales :</span> Amende de 15 ‚Ç¨ par mention manquante/inexacte (plafonn√©e √† 25% du montant de la facture). Risque de remise en cause du droit √† d√©duction de la TVA pour le client.</li>
                            <li><span class="font-bold">P√©nales/Administratives :</span> Amende administrative jusqu'√† 75 000 ‚Ç¨ (personne physique) / 375 000 ‚Ç¨ (personne morale), doubl√©e en cas de r√©cidive ou de factures fictives.</li>
                            <li><span class="font-bold">Civiles/Commerciales :</span> Affaiblit la position du vendeur en cas de litige, le d√©biteur pouvant contester la validit√© de la cr√©ance.</li>
                        </ul>
                        <p class="mt-2 text-xs text-red-700">La conservation des factures est obligatoire pendant 10 ans.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="bfr" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">Piloter sa Tr√©sorerie : le R√¥le Cl√© du BFR</h3>
                <p class="text-md text-gray-500 mt-2">Le Besoin en Fonds de Roulement (BFR) mesure le d√©calage de tr√©sorerie cr√©√© par le cycle d'exploitation. Utilisez ce simulateur pour comprendre son fonctionnement.</p>
            </div>
            <div class="card p-8">
                <div class="grid md:grid-cols-2 gap-8 items-center">
                     <div>
                        <h4 class="text-2xl font-semibold mb-4">Simulateur de BFR</h4>
                        <p class="text-gray-600 mb-6">Modifiez les dur√©es moyennes pour voir leur impact direct sur le besoin de financement de votre cycle d'exploitation.</p>
                        <div class="space-y-6">
                            <div>
                                <!-- BFR Slider: Dur√©e de stockage -->
                                <label for="stock" class="bfr-slider-label relative group">
                                    Dur√©e de stockage (jours)
                                    <span class="info-icon ml-2">i
                                        <span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 300px;">
                                            Plus la dur√©e de stockage des marchandises ou mati√®res premi√®res est longue, plus l'entreprise immobilise de la tr√©sorerie. Cela augmente son Besoin en Fonds de Roulement (BFR), car l'argent est bloqu√© et non disponible pour d'autres usages.
                                        </span>
                                    </span>
                                </label>
                                <input type="range" id="stock" min="0" max="120" value="45" class="w-full">
                                <div class="text-right font-semibold"><span id="stock-value">45</span> jours</div>
                            </div>
                            <div>
                                <!-- BFR Slider: D√©lai de paiement clients -->
                                <label for="clients" class="bfr-slider-label relative group">
                                    D√©lai de paiement clients (jours)
                                    <span class="info-icon ml-2">i
                                        <span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 300px;">
                                            Plus le d√©lai accord√© aux clients pour r√©gler leurs achats est long, plus l'entreprise doit 'avancer' l'argent correspondant. Cela augmente les Cr√©ances Clients et donc le BFR, car les fonds ne sont encaiss√©s que plus tard.
                                        </span>
                                    </span>
                                </label>
                                <input type="range" id="clients" min="0" max="90" value="60" class="w-full">
                                 <div class="text-right font-semibold"><span id="clients-value">60</span> jours</div>
                            </div>
                            <div>
                                <!-- BFR Slider: D√©lai de paiement fournisseurs -->
                                <label for="fournisseurs" class="bfr-slider-label relative group">
                                    D√©lai de paiement fournisseurs (jours)
                                    <span class="info-icon ml-2">i
                                        <span class="tooltip group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2" style="width: 300px;">
                                            Plus le d√©lai de paiement obtenu des fournisseurs est long, plus ces derniers financent une partie de l'activit√© de l'entreprise. Cela augmente les Dettes Fournisseurs et r√©duit le BFR, car l'entreprise conserve sa tr√©sorerie plus longtemps.
                                        </span>
                                    </span>
                                </label>
                                <input type="range" id="fournisseurs" min="0" max="90" value="30" class="w-full">
                                 <div class="text-right font-semibold"><span id="fournisseurs-value">30</span> jours</div>
                            </div>
                            <div>
                                <label for="ca" class="block mb-1 font-medium">Chiffre d'Affaires Annuel HT</label>
                                <input type="number" id="ca" value="500000" class="w-full p-2 border rounded-md">
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="text-center mb-4">
                            <p class="text-gray-600">Besoin en Fonds de Roulement (BFR)</p>
                            <p id="bfr-result" class="text-4xl font-bold text-amber-700">0 ‚Ç¨</p>
                            <p id="bfr-type-explanation" class="text-sm text-gray-600 mt-2"></p>
                        </div>
                        <div class="chart-container h-[250px] md:h-[300px]">
                            <canvas id="bfrChart"></canvas>
                        </div>
                        <div class="text-center text-xs text-gray-500 mt-2">
                            <p class="mb-1">BFR = Stocks + Cr√©ances Clients - Dettes Fournisseurs</p>
                            <p class="font-bold text-gray-700 mt-2">Formules de calcul d√©taill√©es du simulateur :</p>
                            <p class="font-mono text-gray-600 text-left px-4 text-sm">
                                Stocks = (CA Annuel HT / 360) √ó Dur√©e de stockage (jours)<br>
                                Cr√©ances Clients = (CA Annuel TTC / 360) √ó D√©lai de paiement clients (jours)<br>
                                Dettes Fournisseurs = (Achats Annuels HT / 360) √ó D√©lai de paiement fournisseurs (jours)
                            </p>
                            <p class="text-xs text-gray-500 mt-2 text-left px-4">
                                *Hypoth√®ses simplificatrices du simulateur :<br>
                                - CA Annuel TTC = CA Annuel HT √ó 1,20 (pour une TVA √† 20%)<br>
                                - Achats Annuels HT = CA Annuel HT √ó 0,60 (estimation)
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="lexique" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">Lexique des Op√©rations Courantes</h3>
                <p class="text-md text-gray-500 mt-2">Cliquez sur chaque terme pour afficher sa d√©finition.</p>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Besoin en Fonds de Roulement (BFR)
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Montant que l'entreprise doit financer en permanence pour couvrir les d√©calages de tr√©sorerie de son cycle d'exploitation (d√©caissements avant encaissements).</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Bon de Commande (BDC)
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Document √©mis par l'acheteur pour confirmer son intention d'acheter des biens ou services aux conditions propos√©es par le vendeur. Il devient un contrat si accept√© par le vendeur.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Bon de Livraison (BL)
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Document accompagnant la marchandise livr√©e, attestant du flux physique et de la r√©ception des biens par le client une fois sign√©.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Cycle d'Exploitation
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Ensemble des op√©rations courantes et r√©currentes d'une entreprise (achats, production, ventes) qui g√©n√®rent le chiffre d'affaires. Sa dur√©e est g√©n√©ralement inf√©rieure √† un an.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Cycle de Financement
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Op√©rations √† long terme visant √† se procurer les capitaux n√©cessaires √† l'entreprise (apports, emprunts, autofinancement).</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Cycle d'Investissement
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Op√©rations √† long terme (> 1 an) concernant l'acquisition ou la cession d'immobilisations (biens durables) qui fa√ßonnent l'outil de production de l'entreprise.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Dette Fournisseur
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Somme due par l'entreprise √† ses fournisseurs pour des achats de biens ou services, dont le paiement est diff√©r√©.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Devis
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Proposition commerciale formelle du vendeur, d√©taillant les biens/services et leur prix. Il n'engage le client qu'apr√®s signature "bon pour accord".</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Facture
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Document comptable et l√©gal √©mis par le vendeur qui √©tablit sa cr√©ance et demande le paiement pour les biens vendus ou services rendus.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Flux Financiers (ou Mon√©taires)
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Mouvements de tr√©sorerie (d√©caissements et encaissements) qui sont la contrepartie mon√©taire des flux physiques.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Flux Physiques (ou R√©els)
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Mouvements concrets de biens et de services (ex: livraison de marchandises, r√©alisation d'une prestation).</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            Ressource en Fonds de Roulement (RFR)
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Situation o√π les encaissements du cycle d'exploitation pr√©c√®dent les d√©caissements, g√©n√©rant un exc√©dent de tr√©sorerie disponible pour l'entreprise.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            R√®glement au comptant
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Paiement effectu√© imm√©diatement, le jour de la transaction ou de l'√©mission de la facture.</p>
                    </details>

                    <details class="lexicon-card p-4 group">
                        <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-amber-700 hover:text-amber-800">
                            R√®glement √† cr√©dit (ou √† terme diff√©r√©)
                            <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                        </summary>
                        <p class="mt-2 text-gray-700 border-t pt-2 mt-2 border-gray-200">Paiement pour lequel un d√©lai est accord√© au d√©biteur (client ou entreprise) par le cr√©ancier (entreprise ou fournisseur).</p>
                    </details>
                </div>
            </div>
        </section>

        <section id="faq" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">Foire Aux Questions (FAQ)</h3>
                <p class="text-md text-gray-500 mt-2">Des r√©ponses rapides √† vos interrogations fr√©quentes sur les op√©rations courantes.</p>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-md space-y-4">
                <details class="group bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
                    <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-gray-800 hover:text-amber-700">
                        Quelles sont les diff√©rences entre les trois cycles fondamentaux de l'entreprise ?
                        <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                    </summary>
                    <p class="mt-2 text-gray-700">Les trois cycles sont : le Cycle d'Investissement (op√©rations √† long terme pour l'outil de production), le Cycle de Financement (op√©rations √† long terme pour les capitaux n√©cessaires) et le Cycle d'Exploitation (op√©rations courantes et r√©currentes de production/vente, √† court terme).</p>
                </details>

                <details class="group bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
                    <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-gray-800 hover:text-amber-700">
                        Comment le cycle d'exploitation varie-t-il selon l'activit√© de l'entreprise ?
                        <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                    </summary>
                    <p class="mt-2 text-gray-700">La dur√©e et le nombre d'√©tapes varient : l'activit√© industrielle est longue (approvisionnement, stockage MP, production, stockage PF, vente), l'activit√© commerciale est moyenne (achat, stockage Mses, vente), et les prestations de services sont tr√®s courtes (pr√©paration, r√©alisation, encaissement), voire instantan√©es.</p>
                </details>

                <details class="group bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
                    <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-gray-800 hover:text-amber-700">
                        Quelle est la diff√©rence entre un flux physique et un flux financier ?
                        <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                    </summary>
                    <p class="mt-2 text-gray-700">Un flux physique repr√©sente le mouvement concret de biens ou la r√©alisation de services (ex: livraison de marchandises). Un flux financier est la contrepartie mon√©taire de ce flux (ex: paiement d'une facture, encaissement d'une vente).</p>
                </details>

                <details class="group bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
                    <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-gray-800 hover:text-amber-700">
                        Pourquoi la facture est-elle un document commercial si important ?
                        <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                    </summary>
                    <p class="mt-2 text-gray-700">La facture est le document le plus r√©glement√© car elle a un triple r√¥le : commercial (preuve de vente), comptable (base d'enregistrement) et fiscal (d√©claration de TVA). Elle √©tablit l√©galement la cr√©ance du vendeur.</p>
                </details>

                <details class="group bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
                    <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-gray-800 hover:text-amber-700">
                        Quelles sont les sanctions en cas de facture non conforme ?
                        <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                    </summary>
                    <p class="mt-2 text-gray-700">Les sanctions peuvent √™tre fiscales (amendes, remise en cause de la d√©duction de TVA), p√©nales/administratives (amendes importantes) et civiles/commerciales (affaiblissement de la position du vendeur en cas de litige). La conservation est obligatoire pendant 10 ans.</p>
                </details>

                <details class="group bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
                    <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-gray-800 hover:text-amber-700">
                        Qu'est-ce que le Besoin en Fonds de Roulement (BFR) et comment l'optimiser ?
                        <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                    </summary>
                    <p class="mt-2 text-gray-700">Le BFR repr√©sente le d√©calage de tr√©sorerie g√©n√©r√© par le cycle d'exploitation. Un BFR positif indique un besoin de financement. On l'optimise en r√©duisant les stocks, en acc√©l√©rant les encaissements clients (r√©duire le d√©lai de paiement client) et en allongeant les d√©lais de paiement fournisseurs.</p>
                </details>

                <details class="group bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
                    <summary class="flex justify-between items-center font-semibold cursor-pointer text-lg text-gray-800 hover:text-amber-700">
                        Qu'est-ce qu'une Ressource en Fonds de Roulement (RFR) ?
                        <span class="ml-2 transform transition-transform group-open:rotate-180">‚ñº</span>
                    </summary>
                    <p class="mt-2 text-gray-700">Une RFR (ou BFR n√©gatif) se produit lorsque les encaissements du cycle d'exploitation pr√©c√®dent les d√©caissements. L'entreprise dispose alors d'un exc√©dent de tr√©sorerie g√©n√©r√© par son activit√©, qui peut financer d'autres besoins.</p>
                </details>
            </div>
        </section>

        <section id="quiz" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">Testez vos connaissances !</h3>
                <p class="text-md text-gray-500 mt-2">Un quiz interactif pour v√©rifier votre compr√©hension des op√©rations courantes de l'unit√© commerciale.</p>
            </div>

            <!-- Quiz Intro Screen -->
            <div id="quiz-intro" class="card p-8 text-center">
                <h4 class="text-2xl font-semibold mb-4">Pr√™t √† relever le d√©fi ?</h4>
                <p class="text-gray-600 mb-6">Ce quiz contient 15 questions pour √©valuer votre ma√Ætrise des cycles, flux et documents de l'unit√© commerciale.</p>
                <button id="start-quiz-btn" class="btn-primary px-8 py-3 rounded-md font-semibold text-lg">D√©marrer le Quiz</button>
            </div>

            <!-- Quiz Container -->
            <div id="quiz-container" class="card p-8 hidden">
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                    <div id="quiz-progress-bar" class="bg-amber-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <p id="quiz-question" class="text-xl font-semibold mb-6"></p>
                <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Options will be dynamically generated here -->
                </div>
                
                <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0 md:space-x-4">
                    <button id="quiz-hint-btn" class="btn-secondary px-6 py-3 rounded-md font-semibold w-full md:w-auto">Indice</button>
                    <button id="quiz-submit-btn" class="btn-primary px-6 py-3 rounded-md font-semibold w-full md:w-auto" disabled>Valider</button>
                    <button id="quiz-next-btn" class="btn-primary px-6 py-3 rounded-md font-semibold w-full md:w-auto hidden">Question Suivante</button>
                </div>

                <div id="quiz-feedback" class="mt-8 p-4 rounded-md hidden">
                    <p id="quiz-feedback-text" class="text-gray-700"></p>
                </div>
            </div>

            <!-- Quiz Results Screen -->
            <div id="quiz-results" class="card p-8 hidden">
                <h3 class="text-3xl font-bold mb-4">R√©sultats du Quiz</h3>
                <p class="text-lg text-gray-600 mb-4">Votre score : <span id="final-score" class="font-bold text-amber-700">0</span> / <span id="total-questions" class="font-bold">0</span></p>
                <p id="results-message" class="text-xl font-semibold mb-6"></p>
                <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4">
                    <button id="quiz-restart-btn" class="btn-primary px-6 py-3 rounded-md font-semibold">Recommencer le Quiz</button>
                    <button id="quiz-view-synthesis-btn" class="btn-secondary px-6 py-3 rounded-md font-semibold">Voir la Synth√®se</button>
                </div>
            </div>
        </section>

        <!-- New Synthesis Section -->
        <section id="synthese" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold">Synth√®se - Carte Mentale</h3>
                <p class="text-md text-gray-500 mt-2">Cette carte mentale interactive r√©sume les points essentiels des op√©rations courantes. Naviguez √† travers les diff√©rentes branches pour r√©viser les d√©finitions, les concepts et les liens entre eux.</p>
            </div>
            <div class="card p-2 md:p-4">
                <div class="w-full h-[600px] md:h-[750px] border border-gray-200 rounded-lg overflow-hidden">
                     <iframe class="w-full h-full" src='https://www.xmind.app/embed/AWgAw6/' frameborder='0' scrolling='no' allowfullscreen="true"></iframe>
                </div>
            </div>
        </section>
        <!-- End New Synthesis Section -->
    </main>

    <footer class="bg-white border-t mt-12">
        <div class="container mx-auto px-6 py-4 text-center text-gray-500">
            <p>&copy; 2025 - Outil P√©dagogique pour BTS MCO.</p>
        </div>
    </footer>

    <!-- Info Modal Structure -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <h5 id="modalTitle" class="text-2xl font-bold text-amber-700 mb-4"></h5>
            <p id="modalContent" class="text-gray-700 mb-4"></p>
            <ul id="modalList" class="text-left space-y-2 text-sm text-gray-600"></ul>
            <button onclick="closeInfoModal()" class="btn-primary mt-6 px-4 py-2 rounded-md">Fermer</button>
        </div>
    </div>
    
    <script>
        // --- Global Scope Declarations (variables are declared but not assigned yet) ---
        let infoModal, modalTitle, modalContent, modalList;

        // Functions for Info Modal (global scope, will use the globally declared variables)
        function openInfoModal(type, titleOverride = null, contentOverride = null, listOverride = null) {
            let data;
            if (type in cycleInfo) {
                data = cycleInfo[type];
            } else if (type in flowStepInfo) {
                data = flowStepInfo[type];
            } else {
                console.error("Unknown info type:", type);
                return;
            }

            modalTitle.textContent = titleOverride || data.title;
            modalContent.innerHTML = contentOverride || data.content;
            
            modalList.innerHTML = '';
            const items = listOverride || data.list;
            if (items && items.length > 0) {
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'flex items-start';
                    li.innerHTML = `<span class="font-bold mr-2 text-amber-600">‚úì</span>${item}`;
                    modalList.appendChild(li);
                });
                modalList.style.display = 'block';
            } else {
                modalList.style.display = 'none';
            }

            infoModal.classList.add('open');
        }

        function closeInfoModal() {
            infoModal.classList.remove('open');
        }

        // --- Cycle Info Data (global scope) ---
        const cycleInfo = {
            investissement: {
                title: "Cycle d'Investissement",
                content: "Le cycle d'investissement concerne les op√©rations √† long terme (> 1 an) qui fa√ßonnent l'outil de production de l'entreprise. Il engage des ressources financi√®res importantes et conditionne sa capacit√© future.",
                list: [
                    "<strong>Horizon :</strong> Long terme (> 1 an).",
                    "<strong>Op√©rations :</strong> Acquisition et cession des immobilisations (biens durables comme les machines, les locaux, les brevets).",
                    "<strong>R√¥le :</strong> Engage des ressources financi√®res importantes et fa√ßonne l'outil de production.",
                    "<strong>Bilan :</strong> Impacte le haut du bilan (Actif immobilis√©).",
                    "<strong>Tr√©sorerie :</strong> Entra√Æne une consommation de tr√©sorerie lourde et ponctuelle."
                ]
            },
            financement: {
                title: "Cycle de Financement",
                content: "Le cycle de financement regroupe les op√©rations √† long terme visant √† se procurer les capitaux n√©cessaires pour financer les investissements et le cycle d'exploitation.",
                list: [
                    "<strong>Horizon :</strong> Long terme.",
                    "<strong>Op√©rations :</strong> Sources internes (autofinancement) ou externes (augmentations de capital, emprunts bancaires).",
                    "<strong>R√¥le :</strong> Structure le passif du bilan et d√©termine l'ind√©pendance financi√®re.",
                    "<strong>Bilan :</strong> Impacte le haut du bilan (Capitaux propres, Dettes financi√®res).",
                    "<strong>Tr√©sorerie :</strong> G√©n√®re un apport initial ou ponctuel de ressources."
                ]
            },
            exploitationCycle: {
                title: "Cycle d'Exploitation",
                content: "Le cycle d'exploitation regroupe toutes les op√©rations courantes et r√©currentes, de l'approvisionnement √† l'encaissement des ventes, qui g√©n√®rent le chiffre d'affaires de l'entreprise.",
                list: [
                    "<strong>Horizon :</strong> Court terme (< 1 an).",
                    "<strong>Op√©rations :</strong> Achats, production (si applicable), ventes, salaires, etc.",
                    "<strong>R√¥le :</strong> G√©n√®re le Besoin en Fonds de Roulement (BFR) en raison des d√©calages de tr√©sorerie.",
                    "<strong>Bilan :</strong> Impacte le bas du bilan (Actif et Passif circulants).",
                    "<strong>Tr√©sorerie :</strong> G√©n√®re une consommation et une g√©n√©ration r√©currentes de tr√©sorerie."
                ]
            }
        };

        // --- Flux & Documents Section Data (global scope) ---
        const flowStepInfo = {
            devis: {
                title: "1. Le Devis",
                content: "Le devis est une offre commerciale formelle √©mise par le vendeur, d√©taillant les biens ou services et leur prix. Il n'engage pas le client tant qu'il n'est pas accept√©.",
                list: [
                    "<strong>R√¥le Principal :</strong> Proposition commerciale.",
                    "<strong>√âmetteur :</strong> Vendeur.",
                    "<strong>Destinataire :</strong> Acheteur.",
                    "<strong>Valeur Juridique (si sign√©) :</strong> Devient un contrat (offre accept√©e) et engage les deux parties."
                ]
            },
            bonDeCommande: {
                title: "2. Le Bon de Commande (BDC)",
                content: "Le bon de commande est un document √©mis par l'acheteur pour confirmer sa volont√© d'acheter aux conditions propos√©es par le vendeur. Il s√©curise la transaction pour le vendeur.",
                list: [
                    "<strong>R√¥le Principal :</strong> Confirmation d'achat.",
                    "<strong>√âmetteur :</strong> Acheteur.",
                    "<strong>Destinataire :</strong> Vendeur.",
                    "<strong>Valeur Juridique (si accept√©) :</strong> Devient un contrat (commande accept√©e). Le vendeur est tenu de livrer, l'acheteur de payer."
                ]
            },
            bonDeLivraison: {
                title: "3. Le Bon de Livraison (BL) & Flux Physique",
                content: "Le bon de livraison accompagne la marchandise et atteste de la r√©alisation du flux physique (le bien change de mains). Sa signature par le client prouve la r√©ception des biens.",
                list: [
                    "<strong>R√¥le Principal :</strong> Preuve de r√©ception de la marchandise.",
                    "<strong>√âmetteur :</strong> Vendeur.",
                    "<strong>Destinataire :</strong> Acheteur.",
                    "<strong>Valeur Juridique (si sign√©) :</strong> Preuve de livraison conforme, fondamentale en cas de litige sur la conformit√© de la livraison."
                ]
            },
            factureDoc: {
                title: "4. La Facture & Flux Financier",
                content: "La facture est le document comptable et l√©gal qui √©tablit la cr√©ance du vendeur, la rendant certaine, liquide et exigible. Elle d√©clenche la demande de paiement et finalise la transaction commerciale.",
                list: [
                    "<strong>R√¥le Principal :</strong> Demande de paiement et preuve de cr√©ance.",
                    "<strong>√âmetteur :</strong> Vendeur.",
                    "<strong>Destinataire :</strong> Acheteur.",
                    "<strong>Valeur Juridique :</strong> Pi√®ce obligatoire entre professionnels, base de l'enregistrement comptable et de la d√©claration de TVA."
                ]
            }
        };

        // --- QUIZ DATA (global scope) ---
        const quizData = [
            {
                id: 'q1',
                type: 'qcm',
                question: "Quel cycle regroupe les op√©rations d'achat, de production et de vente, avec un horizon temporel court (moins d'un an) ?",
                options: ["Cycle d'Investissement", "Cycle de Financement", "Cycle d'Exploitation", "Cycle de Tr√©sorerie"],
                correctAnswerIndex: 2,
                hint: "Pensez aux activit√©s quotidiennes et r√©currentes de l'entreprise.",
                feedbackCorrect: "Excellente r√©ponse ! Le cycle d'exploitation est au c≈ìur de l'activit√© quotidienne et g√©n√®re le chiffre d'affaires.",
                feedbackIncorrect: "Faux. Ce sont les op√©rations du cycle d'exploitation qui sont √† court terme et r√©currentes."
            },
            {
                id: 'q2',
                type: 'vrai_faux',
                question: "L'activit√© industrielle g√©n√®re g√©n√©ralement un Besoin en Fonds de Roulement (BFR) plus faible que l'activit√© de services.",
                options: ["VRAI", "FAUX"],
                correctAnswerIndex: 1, // FAUX
                hint: "Consid√©rez la pr√©sence et la dur√©e de stockage des mati√®res premi√®res et produits finis dans l'industrie.",
                feedbackCorrect: "C'est exact ! L'activit√© industrielle a un BFR structurellement plus √©lev√© en raison des stocks importants et des longs processus de transformation.",
                feedbackIncorrect: "Faux. L'activit√© industrielle, avec ses stocks et sa production, a un BFR plus √©lev√© que l'activit√© de services."
            },
            {
                id: 'q3',
                type: 'qcm',
                question: "Quel document commercial atteste du mouvement concret des biens et de leur r√©ception par le client ?",
                options: ["Le Devis", "Le Bon de Commande", "Le Bon de Livraison", "La Facture"],
                correctAnswerIndex: 2,
                hint: "Ce document accompagne la marchandise lors de son transport.",
                feedbackCorrect: "Bonne r√©ponse ! Le Bon de Livraison mat√©rialise le flux physique et sert de preuve de r√©ception.",
                feedbackIncorrect: "Non, ce n'est pas ce document. Le Bon de Livraison est celui qui prouve la r√©ception des biens."
            },
            {
                id: 'q4',
                type: 'vrai_faux',
                question: "Un devis sign√© 'bon pour accord' par le client n'a aucune valeur contractuelle.",
                options: ["VRAI", "FAUX"],
                correctAnswerIndex: 1, // FAUX
                hint: "La signature du client est un engagement.",
                feedbackCorrect: "C'est exact ! Un devis sign√© par le client devient un contrat et engage les deux parties.",
                feedbackIncorrect: "Faux. Un devis sign√© 'bon pour accord' acquiert une valeur contractuelle et engage les deux parties."
            },
            {
                id: 'q5',
                type: 'qcm',
                question: "Quelle mention n'est PAS obligatoire sur une facture entre professionnels ?",
                options: ["Le num√©ro de SIREN du vendeur", "Le taux de p√©nalit√©s de retard", "Le code APE de l'entreprise", "Le montant total TTC"],
                correctAnswerIndex: 2,
                hint: "Certaines informations sont utiles mais pas l√©galement exig√©es par le Code de commerce pour la facture.",
                feedbackCorrect: "Bonne r√©ponse ! Le code APE est une mention d'usage, mais pas l√©galement obligatoire sur la facture, contrairement aux autres.",
                feedbackIncorrect: "Non, cette mention est obligatoire. Le code APE est une mention d'usage, mais pas l√©galement obligatoire sur la facture."
            },
            {
                id: 'q6',
                type: 'vrai_faux',
                question: "Une facture non conforme aux mentions obligatoires peut entra√Æner des sanctions fiscales pour l'entreprise.",
                options: ["VRAI", "FAUX"],
                correctAnswerIndex: 0, // VRAI
                hint: "Pensez aux risques li√©s √† la TVA ou aux amendes.",
                feedbackCorrect: "C'est tout √† fait vrai. Le non-respect des obligations de facturation expose l'entreprise √† des sanctions fiscales (amendes, remise en cause de la TVA).",
                feedbackIncorrect: "Faux. Les sanctions fiscales sont bien un risque en cas de non-conformit√© de la facture."
            },
            {
                id: 'q7',
                type: 'qcm',
                question: "Quel mode de r√®glement est le plus courant pour payer les fournisseurs entre entreprises (B2B) ?",
                options: ["Les esp√®ces", "Le virement bancaire SEPA", "Le ch√®que", "La carte bancaire"],
                correctAnswerIndex: 1,
                hint: "Pensez √† la s√©curit√© et la tra√ßabilit√© des transactions importantes.",
                feedbackCorrect: "Exact ! Le virement bancaire SEPA est le moyen de paiement privil√©gi√© en B2B pour sa s√©curit√© et sa tra√ßabilit√©.",
                feedbackIncorrect: "Non, ce n'est pas le mode le plus courant. Le virement bancaire SEPA est le plus utilis√© en B2B."
            },
            {
                id: 'q8',
                type: 'vrai_faux',
                question: "Le paiement au comptant signifie que le paiement est d√ª √† 30 jours fin de mois.",
                options: ["VRAI", "FAUX"],
                correctAnswerIndex: 1, // FAUX
                hint: "Que signifie 'au comptant' dans le langage courant ?",
                feedbackCorrect: "C'est correct ! Le paiement au comptant est un paiement imm√©diat, pas un paiement diff√©r√©.",
                feedbackIncorrect: "Faux. Le paiement au comptant est un paiement imm√©diat, √† la livraison ou √† la r√©alisation de la prestation."
            },
            {
                id: 'q9',
                type: 'qcm',
                question: "Un BFR (Besoin en Fonds de Roulement) n√©gatif est g√©n√©ralement synonyme de :",
                options: ["Un besoin de financement accru", "Une situation de tr√©sorerie d√©grad√©e", "Une Ressource en Fonds de Roulement (RFR)", "Un probl√®me de gestion des stocks"],
                correctAnswerIndex: 2,
                hint: "Si le BFR est n√©gatif, l'entreprise g√©n√®re de la tr√©sorerie par son cycle d'exploitation.",
                feedbackCorrect: "Tr√®s bien ! Un BFR n√©gatif signifie que l'entreprise dispose d'une Ressource en Fonds de Roulement (RFR), ce qui est une situation financi√®re favorable.",
                feedbackIncorrect: "Non, c'est l'inverse. Un BFR n√©gatif indique une Ressource en Fonds de Roulement (RFR), ce qui est positif pour la tr√©sorerie."
            },
            {
                id: 'q10',
                type: 'vrai_faux',
                question: "La dur√©e du cycle d'exploitation est calcul√©e par : Dur√©e de stockage + Dur√©e du cr√©dit client - Dur√©e du cr√©dit fournisseur.",
                options: ["VRAI", "FAUX"],
                correctAnswerIndex: 1, // FAUX
                hint: "Le cr√©dit fournisseur est une ressource qui r√©duit le besoin, pas la dur√©e du cycle elle-m√™me.",
                feedbackCorrect: "C'est exact ! La dur√©e du cycle d'exploitation est (Dur√©e de stockage + Dur√©e du cr√©dit client). Le cr√©dit fournisseur impacte le BFR, pas la dur√©e brute du cycle.",
                feedbackIncorrect: "Faux. Le cr√©dit fournisseur ne soustrait pas √† la dur√©e du cycle d'exploitation, mais r√©duit le BFR. La dur√©e du cycle d'exploitation se concentre sur les flux d'actifs circulants."
            },
            // --- NOUVELLES QUESTIONS AX√âES COMPR√âHENSION / APPLICATION ---
            {
                id: 'q11',
                type: 'qcm',
                question: "L'entreprise 'D√©lices du Vercors' ach√®te des noix (mati√®res premi√®res), les transforme en huile qu'elle conditionne, stocke et vend ensuite √† des magasins. Ce processus r√©current est principalement li√© √† quel cycle ?",
                options: ["Cycle de Financement", "Cycle d'Investissement", "Cycle d'Exploitation", "Cycle Fiscal"],
                correctAnswerIndex: 2,
                hint: "Pensez aux activit√©s principales et quotidiennes d'une entreprise de production.",
                feedbackCorrect: "Exact ! Ce sc√©nario d√©crit un processus typique d'achat, production, stockage et vente, caract√©ristique du cycle d'exploitation industriel.",
                feedbackIncorrect: "Faux. Les activit√©s d'achat, production et vente au quotidien rel√®vent du cycle d'exploitation."
            },
            {
                id: 'q12',
                type: 'qcm',
                question: "Si une entreprise d√©cide d'allonger ses d√©lais de paiement clients (accorde plus de temps √† ses clients pour payer), quel sera l'impact probable sur son Besoin en Fonds de Roulement (BFR), toutes choses √©gales par ailleurs ?",
                options: ["Le BFR diminuera", "Le BFR augmentera", "Le BFR restera inchang√©", "Le BFR deviendra n√©gatif"],
                correctAnswerIndex: 1,
                hint: "Plus les clients mettent du temps √† payer, plus l'entreprise doit avancer d'argent pour couvrir ses charges.",
                feedbackCorrect: "Correct ! Allonger les d√©lais de paiement clients signifie que l'entreprise immobilise plus de fonds plus longtemps dans ses cr√©ances, augmentant ainsi son BFR.",
                feedbackIncorrect: "Non. Des d√©lais de paiement clients plus longs augmentent les cr√©ances clients, et donc le BFR."
            },
            {
                id: 'q13',
                type: 'qcm',
                question: "Le Bon de Livraison est un document crucial car sa signature par le client valide la conformit√© de la livraison. Quelle est sa principale fonction par rapport √† la facture ?",
                options: ["Il remplace la facture", "Il d√©clenche le paiement avant la facture", "Il prouve le flux physique avant le flux financier", "Il sert uniquement √† la comptabilit√© interne"],
                correctAnswerIndex: 2,
                hint: "Pensez √† l'ordre chronologique des √©v√©nements : r√©ception des biens, puis demande de paiement.",
                feedbackCorrect: "Tr√®s bien ! Le BL mat√©rialise le transfert physique des biens, √©tape n√©cessaire avant que la facture ne demande le flux financier correspondant.",
                feedbackIncorrect: "Faux. Le Bon de Livraison prouve la r√©alisation du flux physique, tandis que la facture d√©clenche le flux financier."
            },
            {
                id: 'q14',
                type: 'qcm',
                question: "Une Ressource en Fonds de Roulement (BFR n√©gatif) est souvent observ√©e dans les entreprises qui parviennent √† :",
                options: ["Accorder de longs d√©lais de paiement √† leurs clients", "Maintenir des stocks importants", "Encaisser leurs ventes avant de payer leurs fournisseurs", "Investir massivement dans des immobilisations"],
                correctAnswerIndex: 2,
                hint: "C'est une situation o√π l'entreprise g√©n√®re de la tr√©sorerie par son cycle d'exploitation.",
                feedbackCorrect: "C'est la bonne r√©ponse ! Encaisser rapidement et payer tardivement permet de d√©gager une ressource de tr√©sorerie gr√¢ce au cycle d'exploitation.",
                feedbackIncorrect: "Non, les autres options tendent √† augmenter le BFR. Une RFR est g√©n√©r√©e par un d√©calage favorable entre encaissements et d√©caissements du cycle d'exploitation."
            },
            {
                id: 'q15',
                type: 'qcm',
                question: "Si une entreprise omet de mentionner le taux de p√©nalit√©s de retard sur une facture adress√©e √† un professionnel, quelle est une cons√©quence directe possible pour l'entreprise √©mettrice ?",
                options: ["Le client ne sera pas oblig√© de payer la facture", "L'entreprise ne pourra pas appliquer de p√©nalit√©s de retard en cas de paiement tardif", "L'entreprise devra payer une amende fixe de 40‚Ç¨", "La facture sera consid√©r√©e comme nulle et non avenue"],
                correctAnswerIndex: 1,
                hint: "La mention obligatoire des p√©nalit√©s vise √† les rendre applicables.",
                feedbackCorrect: "Exact ! Sans cette mention l√©galement obligatoire, l'entreprise perd son droit d'appliquer des p√©nalit√©s de retard m√™me si le client paie en retard.",
                feedbackIncorrect: "Faux. L'omission sp√©cifique du taux de p√©nalit√©s de retard rend ces p√©nalit√©s inapplicables pour le vendeur."
            }
        ];


        document.addEventListener('DOMContentLoaded', function() {
            // --- Assign DOM elements after the DOM is ready ---
            infoModal = document.getElementById('infoModal');
            modalTitle = document.getElementById('modalTitle');
            modalContent = document.getElementById('modalContent');
            modalList = document.getElementById('modalList');

            // --- Quiz DOM Elements ---
            const quizIntro = document.getElementById('quiz-intro');
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const quizContainer = document.getElementById('quiz-container');
            const quizProgressBar = document.getElementById('quiz-progress-bar');
            const quizQuestion = document.getElementById('quiz-question');
            const quizOptions = document.getElementById('quiz-options');
            const quizHintBtn = document.getElementById('quiz-hint-btn');
            const quizSubmitBtn = document.getElementById('quiz-submit-btn');
            const quizNextBtn = document.getElementById('quiz-next-btn');
            const quizFeedback = document.getElementById('quiz-feedback');
            const quizFeedbackText = document.getElementById('quiz-feedback-text');
            const quizResults = document.getElementById('quiz-results');
            const finalScoreSpan = document.getElementById('final-score');
            const totalQuestionsSpan = document.getElementById('total-questions');
            const resultsMessage = document.getElementById('results-message');
            const quizRestartBtn = document.getElementById('quiz-restart-btn');
            const quizViewSynthesisBtn = document.getElementById('quiz-view-synthesis-btn');


            // --- Quiz State Variables ---
            let currentQuestionIndex = 0;
            let score = 0;
            let selectedAnswer = null; // Stores the index of the selected answer
            let hintUsedForCurrentQuestion = false;

            // --- Quiz Functions ---

            function initQuiz() {
                currentQuestionIndex = 0;
                score = 0;
                selectedAnswer = null;
                hintUsedForCurrentQuestion = false;

                quizIntro.classList.remove('hidden');
                quizContainer.classList.add('hidden');
                quizResults.classList.add('hidden');
                
                // Ensure total questions displayed on results screen is correct
                totalQuestionsSpan.textContent = quizData.length;
                // Update text on intro screen for new question count
                document.querySelector('#quiz-intro p.mb-6').textContent = `Ce quiz contient ${quizData.length} questions pour √©valuer votre ma√Ætrise des cycles, flux et documents de l'unit√© commerciale.`;


                // Event listeners for quiz buttons are already set on DOMContentLoaded,
                // but if they were dynamic, they would be re-attached here.
            }

            function startQuiz() {
                quizIntro.classList.add('hidden');
                quizContainer.classList.remove('hidden');
                displayQuestion();
            }

            function displayQuestion() {
                selectedAnswer = null;
                hintUsedForCurrentQuestion = false;

                quizSubmitBtn.disabled = true;
                quizNextBtn.classList.add('hidden');
                quizHintBtn.classList.remove('hidden'); // Show hint button for new question
                quizFeedback.classList.add('hidden');
                quizFeedback.classList.remove('bg-green-100', 'border-green-500', 'bg-red-100', 'border-red-500', 'bg-blue-100', 'border-blue-500'); // Clean up feedback styling

                const question = quizData[currentQuestionIndex];
                quizQuestion.textContent = `${currentQuestionIndex + 1}. ${question.question}`;
                quizOptions.innerHTML = ''; // Clear previous options

                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('button');
                    optionElement.classList.add('quiz-option-btn');
                    optionElement.textContent = option;
                    optionElement.dataset.index = index;
                    optionElement.addEventListener('click', () => handleOptionClick(index, optionElement));
                    quizOptions.appendChild(optionElement);
                });

                updateProgressBar();
            }

            function handleOptionClick(index, element) {
                selectedAnswer = index;
                // Remove 'selected' from all options
                document.querySelectorAll('.quiz-option-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                // Add 'selected' to the clicked option
                element.classList.add('selected');
                quizSubmitBtn.disabled = false; // Enable submit button
            }

            function updateProgressBar() {
                const progress = ((currentQuestionIndex) / quizData.length) * 100;
                quizProgressBar.style.width = `${progress}%`;
            }

            function checkAnswer() {
                if (selectedAnswer === null) {
                    // This should ideally not happen if quizSubmitBtn is disabled
                    alert("Veuillez s√©lectionner une r√©ponse.");
                    return;
                }

                const question = quizData[currentQuestionIndex];
                const isCorrect = (selectedAnswer === question.correctAnswerIndex);

                // Disable all options and highlight correct/incorrect
                document.querySelectorAll('.quiz-option-btn').forEach((btn, index) => {
                    btn.disabled = true;
                    if (index === question.correctAnswerIndex) {
                        btn.classList.add('correct');
                    } else if (index === selectedAnswer && !isCorrect) {
                        btn.classList.add('incorrect');
                    }
                    btn.classList.remove('selected'); // Remove selected class
                });

                quizSubmitBtn.disabled = true; // Disable submit after checking
                quizHintBtn.classList.add('hidden'); // Hide hint button after checking
                quizNextBtn.classList.remove('hidden'); // Show next button

                if (isCorrect) {
                    score++;
                }
                showFeedback(isCorrect);
            }

            function showFeedback(isCorrect) {
                const question = quizData[currentQuestionIndex];
                quizFeedback.classList.remove('hidden');
                quizFeedback.classList.remove('bg-blue-100', 'border-blue-500'); // Clear hint styling
                if (isCorrect) {
                    quizFeedback.classList.add('bg-green-100', 'border-green-500');
                    quizFeedbackText.textContent = question.feedbackCorrect;
                } else {
                    quizFeedback.classList.add('bg-red-100', 'border-red-500');
                    quizFeedbackText.textContent = question.feedbackIncorrect;
                }
            }

            function nextQuestion() {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizData.length) {
                    displayQuestion();
                } else {
                    showResults();
                }
                // Update progress bar for the next question (or 100% if finished)
                updateProgressBar(); 
            }

            function showHint() {
                if (hintUsedForCurrentQuestion) return; // Prevent multiple hints

                const question = quizData[currentQuestionIndex];
                quizFeedback.classList.remove('hidden');
                quizFeedback.classList.remove('bg-green-100', 'border-green-500', 'bg-red-100', 'border-red-500');
                quizFeedback.classList.add('bg-blue-100', 'border-blue-500'); // Neutral color for hint
                quizFeedbackText.textContent = `Indice : ${question.hint}`;
                hintUsedForCurrentQuestion = true;
                // Optionally disable hint button after use or apply penalty
                // quizHintBtn.disabled = true;
            }

            function showResults() {
                quizContainer.classList.add('hidden');
                quizResults.classList.remove('hidden');

                finalScoreSpan.textContent = score;
                totalQuestionsSpan.textContent = quizData.length; // Ensure this is correct

                const percentage = (score / quizData.length) * 100;
                if (percentage >= 80) {
                    resultsMessage.textContent = "F√©licitations ! Excellente ma√Ætrise des concepts.";
                    resultsMessage.classList.remove('text-red-600', 'text-yellow-600');
                    resultsMessage.classList.add('text-green-600');
                } else if (percentage >= 50) {
                    resultsMessage.textContent = "Bien jou√© ! Vous avez une bonne compr√©hension, continuez √† r√©viser.";
                    resultsMessage.classList.remove('text-red-600', 'text-green-600');
                    resultsMessage.classList.add('text-yellow-600');
                } else {
                    resultsMessage.textContent = "Des efforts sont n√©cessaires. N'h√©sitez pas √† revoir les sections du cours.";
                    resultsMessage.classList.remove('text-green-600', 'text-yellow-600');
                    resultsMessage.classList.add('text-red-600');
                }
            }

            // --- Event Listeners for Quiz Buttons ---
            startQuizBtn.addEventListener('click', startQuiz);
            quizSubmitBtn.addEventListener('click', checkAnswer);
            quizNextBtn.addEventListener('click', nextQuestion);
            quizHintBtn.addEventListener('click', showHint);
            quizRestartBtn.addEventListener('click', initQuiz);
            quizViewSynthesisBtn.addEventListener('click', () => {
                document.querySelector('#synthese').scrollIntoView({ behavior: 'smooth' }); // Scrolls to synthesis section
            });


            // --- Initialise the Quiz when DOM is ready ---
            initQuiz();

            // --- Mobile Navigation Toggle ---
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuToggle.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // Close mobile menu when a link is clicked
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (!mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            });


            // --- Navigation Active State ---
            // Targeting both desktop and mobile links with the same class
            const navLinks = document.querySelectorAll('.nav-link'); 
            const sections = document.querySelectorAll('section[id]');

            const observerOptions = {
                root: null,
                rootMargin: '-50% 0px -50% 0px', // Adjusted to activate when section is roughly in the middle
                threshold: 0 // We use rootMargin to define the "active" area
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => link.classList.remove('active'));
                        // Select the link that matches the current section ID, from both desktop and mobile menus
                        const activeLink = document.querySelector(`.nav-link[href="#${entry.target.id}"]`);
                        if (activeLink) {
                            activeLink.classList.add('active');
                        }
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });

            // Close modal on outside click (this listener should be set once infoModal is assigned)
            infoModal.addEventListener('click', (e) => {
                if (e.target === infoModal) {
                    closeInfoModal();
                }
            });

            // --- Activity Cycle Data and Chart ---
            const activityData = {
                indus: {
                    title: 'Activit√© Industrielle',
                    desc: 'Processus long et complexe, impliquant la transformation de mati√®res premi√®res en produits finis.',
                    steps: [
                        'Approvisionnement (Mati√®res premi√®res)',
                        'Stockage des mati√®res premi√®res',
                        'Production / Fabrication',
                        'Stockage des produits finis',
                        'Commercialisation & Encaissement'
                    ],
                    bfr: 80,
                    bfrExplanation: "Le BFR de l'activit√© industrielle est structurellement √©lev√©. La phase de production, les multiples niveaux de stocks (mati√®res premi√®res, en-cours, produits finis) et les d√©lais de fabrication immobilisent des capitaux sur une longue dur√©e avant l'encaissement des ventes."
                },
                commer: {
                    title: 'Activit√© Commerciale',
                    desc: 'Achat de marchandises destin√©es √† √™tre revendues en l\'√©tat, sans transformation majeure.',
                    steps: [
                        'Approvisionnement (Marchandises)',
                        'Stockage des marchandises',
                        'Commercialisation & Encaissement'
                    ],
                    bfr: 50,
                    bfrExplanation: "L'activit√© commerciale a un BFR g√©n√©ralement moyen. Bien qu'il n'y ait pas de production, la gestion des stocks de marchandises et les d√©lais de paiement clients n√©cessitent un financement. Une rotation rapide des stocks est essentielle pour minimiser le BFR."
                },
                serv: {
                    title: 'Prestation de Services',
                    desc: 'Le "stock" est souvent immat√©riel (comp√©tences, flotte de v√©hicules). Le cycle peut √™tre tr√®s court, voire instantan√©.',
                    steps: [
                        'Achat de consommables / Pr√©paration',
                        'R√©alisation de la prestation',
                        'Facturation & Encaissement'
                    ],
                    bfr: 15,
                    bfrExplanation: "Le BFR de la prestation de services est souvent faible, voire n√©gatif (RFR). La notion de stock est limit√©e ou inexistante et les encaissements sont souvent rapides (paiement comptant), ce qui permet de financer les charges avant m√™me de les d√©caisser."
                }
            };
            
            const activityTitle = document.getElementById('activity-title');
            const activityDesc = document.getElementById('activity-desc');
            const activitySteps = document.getElementById('activity-steps');
            const bfrImpactExplanation = document.getElementById('bfr-impact-explanation');
            const activityButtons = { // Renamed to avoid conflict with quiz buttons
                indus: document.getElementById('btn-indus'),
                commer: document.getElementById('btn-commer'),
                serv: document.getElementById('btn-serv'),
            };

            let bfrImpactChart;

            function updateActivity(type) {
                const data = activityData[type];
                activityTitle.textContent = data.title;
                activityDesc.textContent = data.desc;
                bfrImpactExplanation.textContent = data.bfrExplanation;
                
                activitySteps.innerHTML = '';
                data.steps.forEach((step, index) => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = 'flex items-center';
                    stepDiv.innerHTML = `<div class="w-8 h-8 rounded-full bg-amber-100 text-amber-700 font-bold flex items-center justify-center mr-4">${index + 1}</div><p>${step}</p>`;
                    activitySteps.appendChild(stepDiv);
                });

                Object.values(activityButtons).forEach(btn => btn.classList.remove('active'));
                activityButtons[type].classList.add('active');
                
                updateBfrImpactChart(data.bfr);
            }

            function createBfrImpactChart() {
                const ctx = document.getElementById('bfrImpactChart').getContext('2d');
                bfrImpactChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Impact sur le BFR'],
                        datasets: [{
                            label: 'Niveau du BFR Relatif',
                            data: [0],
                            backgroundColor: ['#F59E0B'],
                            borderColor: ['#D97706'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { max: 100, beginAtZero: true, grid: { display: false }, ticks: { display: false } },
                            y: { grid: { display: false } }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false },
                            title: { display: true, text: 'Niveau Relatif du Besoin en Fonds de Roulement' }
                        }
                    }
                });
            }

            function updateBfrImpactChart(value) {
                bfrImpactChart.data.datasets[0].data[0] = value;
                bfrImpactChart.update();
            }

            activityButtons.indus.addEventListener('click', () => updateActivity('indus'));
            activityButtons.commer.addEventListener('click', () => updateActivity('commer'));
            activityButtons.serv.addEventListener('click', () => updateActivity('serv'));

            createBfrImpactChart();
            updateActivity('indus');

            // --- BFR Simulator Section ---
            const caInput = document.getElementById('ca');
            const stockSlider = document.getElementById('stock');
            const clientsSlider = document.getElementById('clients');
            const fournisseursSlider = document.getElementById('fournisseurs');
            const stockValue = document.getElementById('stock-value');
            const clientsValue = document.getElementById('clients-value');
            const fournisseursValue = document.getElementById('fournisseurs-value');
            const bfrResult = document.getElementById('bfr-result');
            const bfrTypeExplanation = document.getElementById('bfr-type-explanation');
            
            let bfrChart;

            function calculateBFR() {
                const ca = parseFloat(caInput.value) || 0;
                const stockDays = parseInt(stockSlider.value);
                const clientsDays = parseInt(clientsSlider.value);
                const fournisseursDays = parseInt(fournisseursSlider.value);

                stockValue.textContent = stockDays;
                clientsValue.textContent = clientsDays;
                fournisseursValue.textContent = fournisseursDays;
                
                // Simplified calculation for demonstration purposes
                // Stock = (CA HT / 360) * Dur√©e de stockage
                // Cr√©ances Clients = (CA TTC / 360) * D√©lai paiement clients (assuming CA is HT, add 20% VAT for TTC)
                // Dettes Fournisseurs = (Achats HT / 360) * D√©lai paiement fournisseurs (assuming Achats are 60% of CA HT)

                const stockAmount = (ca / 360) * stockDays;
                const clientsAmount = (ca * 1.2 / 360) * clientsDays; // Assuming 20% VAT
                const fournisseursAmount = (ca * 0.6 / 360) * fournisseursDays; // Assuming purchases are 60% of CA HT

                const bfr = stockAmount + clientsAmount - fournisseursAmount;

                bfrResult.textContent = `${Math.round(bfr).toLocaleString('fr-FR')} ‚Ç¨`;
                
                if (bfr > 0) {
                    bfrTypeExplanation.textContent = `L'entreprise a un besoin de financement de ${Math.round(bfr).toLocaleString('fr-FR')} ‚Ç¨ pour son cycle d'exploitation.`;
                    bfrTypeExplanation.classList.remove('text-green-600');
                    bfrTypeExplanation.classList.add('text-red-600');
                } else if (bfr < 0) {
                    bfrTypeExplanation.textContent = `L'entreprise dispose d'une ressource de ${Math.round(Math.abs(bfr)).toLocaleString('fr-FR')} ‚Ç¨ g√©n√©r√©e par son cycle d'exploitation (RFR).`;
                    bfrTypeExplanation.classList.remove('text-red-600');
                    bfrTypeExplanation.classList.add('text-green-600');
                } else {
                    bfrTypeExplanation.textContent = `Le BFR est neutre.`;
                    bfrTypeExplanation.classList.remove('text-red-600', 'text-green-600');
                }

                updateBfrChart(stockAmount, clientsAmount, -fournisseursAmount); // Suppliers are a negative amount for BFR
            }
            
            function createBfrChart() {
                 const ctx = document.getElementById('bfrChart').getContext('2d');
                 bfrChart = new Chart(ctx, {
                     type: 'bar',
                     data: {
                         labels: ['Composantes du BFR'],
                         datasets: [
                             { label: 'Stocks', data: [0], backgroundColor: '#3B82F6' },
                             { label: 'Cr√©ances Clients', data: [0], backgroundColor: '#10B981' },
                             { label: 'Dettes Fournisseurs', data: [0], backgroundColor: '#EF4444' }
                         ]
                     },
                     options: {
                         responsive: true,
                         maintainAspectRatio: false,
                         scales: {
                             x: { 
                                stacked: true, 
                                grid: { display: false },
                                ticks: { font: { size: 10 } }, /* R√©duire la taille de police sur X */
                                title: { display: true, text: 'Composantes du BFR', font: { size: 10 } } /* Titre axe X */
                             },
                             y: { 
                                stacked: true, 
                                ticks: { 
                                    callback: value => `${(value / 1000).toFixed(0)}k ‚Ç¨`, /* Formater plus court */
                                    font: { size: 10 }, /* R√©duire la taille de police sur Y */
                                    padding: 5 /* Ajouter un peu de padding */
                                },
                                title: { display: true, text: 'Montant en ‚Ç¨', font: { size: 10 } } /* Titre axe Y */
                             }
                         },
                         plugins: {
                             legend: { 
                                position: 'bottom',
                                labels: {
                                    font: { size: 10 } /* R√©duire la taille de police de la l√©gende */
                                }
                             },
                             tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(context.parsed.y);
                                        }
                                        return label;
                                    }
                                }
                             },
                             title: {
                                display: false, /* D√©sactiver le titre global car les titres d'axe sont plus pertinents ici */
                             }
                         }
                     }
                 });
            }

            function updateBfrChart(stock, clients, fournisseurs) {
                bfrChart.data.datasets[0].data[0] = stock;
                bfrChart.data.datasets[1].data[0] = clients;
                bfrChart.data.datasets[2].data[0] = fournisseurs;
                bfrChart.update();
            }

            [caInput, stockSlider, clientsSlider, fournisseursSlider].forEach(el => {
                el.addEventListener('input', calculateBFR);
            });

            createBfrChart();
            calculateBFR(); // Initial calculation on page load
            
            // --- Smooth Scroll for Nav Links ---
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

        });
    </script>
</body>
</html>